---
title: "Go Context"
date: 2022-06-18T17:35:11+09:00
draft: false
---

Golangで始めてcontextを使った。リポジトリは非公開なのであしからず。

Webスクレイピングツールを作っている。
ランディングページを見て良さげなページへのリンクを集め、それらのリンクから欲しいコンテンツを収集する、というのがメインの動き。
基本的には起動したら放置するのだが、ときどきいらないページをスキップしたくなる。このスキップ機能を追加するためにcontextを使った。

当初は`context.WithCancel`で良いかと思ったが、同じ`ctx`に複数回cancelを送信したいので良くない。
結局`context.WithValue`で受信チャンネルをもたせた。
あとはキー入力を受け付けるgoroutineを立てて、良い感じに対応する送信チャンネルから`struct{}{}`を送れば良い。

標準入出力をいろいろな部分から使っているので操作画面がとてもきたない。
とはいえ自分で使う分にはストレスなく思ったとおりに動くので道具としては満足。
