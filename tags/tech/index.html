<!doctype html><html lang=ja><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge,chrome=1"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=format-detection content="telephone=no"><title>Tech | ツイートするには長すぎる</title>
<link rel=apple-touch-icon sizes=57x57 href=/images/apple-icon-57x57.png><link rel=apple-touch-icon sizes=60x60 href=/images/apple-icon-60x60.png><link rel=apple-touch-icon sizes=72x72 href=/images/apple-icon-72x72.png><link rel=apple-touch-icon sizes=76x76 href=/images/apple-icon-76x76.png><link rel=apple-touch-icon sizes=114x114 href=/images/apple-icon-114x114.png><link rel=apple-touch-icon sizes=120x120 href=/images/apple-icon-120x120.png><link rel=apple-touch-icon sizes=144x144 href=/images/apple-icon-144x144.png><link rel=apple-touch-icon sizes=152x152 href=/images/apple-icon-152x152.png><link rel=apple-touch-icon sizes=180x180 href=/images/apple-icon-180x180.png><link rel=icon type=image/png sizes=192x192 href=/images/android-icon-192x192.png><link rel=icon type=image/png sizes=32x32 href=/images/favicon-32x32.png><link rel=icon type=image/png sizes=96x96 href=/images/favicon-96x96.png><link rel=icon type=image/png sizes=16x16 href=/images/favicon-16x16.png><link rel=manifest href=/images/manifest.json><meta name=msapplication-TileColor content="#ffffff"><meta name=msapplication-TileImage content="/images/ms-icon-144x144.png"><meta name=theme-color content="#ffffff"><meta property="og:url" content="https://blog.nfurudono.com/tags/tech/"><meta property="og:site_name" content="ツイートするには長すぎる"><meta property="og:title" content="Tech"><meta property="og:locale" content="ja"><meta property="og:type" content="website"><meta property="og:image" content="https://blog.nfurudono.com/images/thumbnail.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://blog.nfurudono.com/images/thumbnail.png"><meta name=twitter:title content="Tech"><meta name=description content="Techに関連する記事の一覧です。"><meta property="og:description" content="Techに関連する記事の一覧です。"><meta name=twitter:description content="Techに関連する記事の一覧です。"><link rel=stylesheet href=https://blog.nfurudono.com/css/main.min.4a8d45e3b44981d4f355f589434d733fbb033b6c928a19524eb16eb5f488941c.css><link rel=alternate type=application/rss+xml href=https://blog.nfurudono.com/tags/tech/index.xml title=ツイートするには長すぎる><script async src="https://www.googletagmanager.com/gtag/js?id=G-ES42FPF4D5"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-ES42FPF4D5")}</script></head><body><nav><header><div class=site-title><a href=/>ツイートするには長すぎる</a></div></header><div class=nav-menu><a class="color-link nav-link" href=/profile/>Profile</a>
<a class="color-link nav-link" href=/tags/>Tags</a>
<a class="color-link nav-link" href=/about/>about</a>
<a class="color-link nav-link" href=/tags/tech/index.xml target=_blank rel=noopener type=application/rss+xml>RSS</a></div><footer class=footer><div class=social-icons><a class=social-icon href=https://twitter.com/furudono2 target=_blank rel=noopener title=Twitter><svg width="28" height="28" viewBox="0 0 28 28" fill="#ababab" xmlns:xlink="https://www.w3.org/1999/xlink"><path d="M8.991284 24.971612c10.189152.0 15.761088-8.441388 15.761088-15.761088C24.752372 8.970656 24.747512 8.731868 24.736496 8.494376 25.818008 7.712564 26.758256 6.737 27.5 5.62622c-.992628.440856-2.060748.738072-3.181248.871992 1.14372-.685584 2.02176-1.770768 2.435832-3.064176-1.070496.6345-2.25558 1.095984-3.517344 1.344492-1.010772-1.076652-2.450412-1.75014-4.043412-1.75014-3.059424.0-5.540292 2.480868-5.540292 5.539104.0.434808.0487079999999995.857412.14364 1.26306C9.19346 9.599108 5.11106 7.39472 2.3792 4.04294c-.476172.818424-.750168 1.769688-.750168 2.784132.0 1.921968.97794 3.61854 2.464992 4.61106C3.185528 11.41016 2.331788 11.160464 1.585184 10.745096 1.583888 10.768208 1.583888 10.791428 1.583888 10.815728c0 2.683152 1.909764 4.922856 4.4442 5.43078C5.562932 16.373084 5.07326 16.44134 4.56782 16.44134 4.210988 16.44134 3.863876 16.406024 3.526484 16.34144c.70524 2.200824 2.750112 3.802356 5.174928 3.8475-1.896264 1.485756-4.284576 2.37114-6.879924 2.37114C1.374476 22.56008.93362 22.534592.5 22.4834c2.451708 1.571076 5.362524 2.488212 8.491284 2.488212"/></svg>
</a><a class=social-icon href=https://www.instagram.com/donofuru/ target=_blank rel=noopener title=Instagram><svg width="28" height="28" viewBox="0 0 28 28" fill="#ababab" xmlns:xlink="https://www.w3.org/1999/xlink"><path d="M14.0000238 2.00378571c3.2579524.0 3.6664762.0138095300000001 4.946.0721904800000002C20.222881 2.13421429 21.0949286 2.33702381 21.8579762 2.63359524 22.6468333 2.94011905 23.3158333 3.35030952 23.9827857 4.01721429 24.6496905 4.68416667 25.059881 5.35316667 25.3664524 6.14202381 25.6629762 6.90507143 25.8657857 7.77711905 25.9240238 9.05397619 25.9824048 10.3335 25.9962143 10.7420238 25.9962143 14.0000238 25.9962143 17.2579762 25.9824048 17.6665 25.9240238 18.9460238 25.8657857 20.222881 25.6629762 21.0949286 25.3664524 21.8579762 25.059881 22.6468333 24.6496905 23.3158333 23.9827857 23.9827857 23.3158333 24.6496905 22.6468333 25.059881 21.8579762 25.3664524 21.0949286 25.6629762 20.222881 25.8657857 18.9460238 25.9240238 17.6665 25.9824048 17.2579762 25.9962143 14.0000238 25.9962143 10.7420238 25.9962143 10.3335 25.9824048 9.05397619 25.9240238 7.77711905 25.8657857 6.90507143 25.6629762 6.14202381 25.3664524 5.35316667 25.059881 4.68416667 24.6496905 4.01721429 23.9827857c-.66690477-.6669524-1.07709524-1.3359524-1.38361905-2.1248095-.29657143-.7630476-.49938095-1.6350952-.55761905-2.9119524C2.01759524 17.6665 2.00378571 17.2579762 2.00378571 14.0000238 2.00378571 10.7420238 2.01759524 10.3335 2.07597619 9.05397619 2.13421429 7.77711905 2.33702381 6.90507143 2.63359524 6.14202381c.30652381-.78885714.71671428-1.45785714 1.38361905-2.12480952.66695238-.66690477 1.33595238-1.07709524 2.12480952-1.38361905C6.90507143 2.33702381 7.77711905 2.13421429 9.05397619 2.07597619 10.3335 2.01759524 10.7420238 2.00378571 14.0000238 2.00378571zm0 2.16147619C10.796881 4.1652619 10.4174524 4.1775 9.1525 4.23521429 7.98288095 4.28854762 7.34769048 4.48397619 6.92497619 4.6482619 6.36502381 4.86588095 5.96540476 5.12583333 5.54564286 5.54564286c-.41980953.4197619-.67976191.81938095-.89738096 1.37933333-.16428571.42271429-.35971428 1.05790476-.41304761 2.22752381C4.1775 10.4174524 4.1652619 10.796881 4.1652619 14.0000238 4.1652619 17.203119 4.1775 17.5825476 4.23521429 18.8475 4.28854762 20.017119 4.48397619 20.6523095 4.6482619 21.0750238 4.86588095 21.6349762 5.12588095 22.0345952 5.54564286 22.4543571 5.96540476 22.8741667 6.36502381 23.134119 6.92497619 23.3517381 7.34769048 23.5160238 7.98288095 23.7114524 9.1525 23.7647857 10.4173095 23.8225 10.7966429 23.8347381 14.0000238 23.8347381 17.2033571 23.8347381 17.5827381 23.8225 18.8475 23.7647857 20.017119 23.7114524 20.6523095 23.5160238 21.0750238 23.3517381 21.6349762 23.134119 22.0345952 22.8741667 22.4543571 22.4543571 22.8741667 22.0345952 23.134119 21.6349762 23.3517381 21.0750238 23.5160238 20.6523095 23.7114524 20.017119 23.7647857 18.8475 23.8225 17.5825476 23.8347381 17.203119 23.8347381 14.0000238 23.8347381 10.796881 23.8225 10.4174524 23.7647857 9.1525 23.7114524 7.98288095 23.5160238 7.34769048 23.3517381 6.92497619 23.134119 6.36502381 22.8741667 5.96540476 22.4543571 5.54564286 22.0345952 5.12583333 21.6349762 4.86588095 21.0750238 4.6482619 20.6523095 4.48397619 20.017119 4.28854762 18.8475 4.23521429 17.5825476 4.1775 17.203119 4.1652619 14.0000238 4.1652619zm0 13.8334762c2.2084286.0 3.9987143-1.7902857 3.9987143-3.9987143.0-2.2084762-1.7902857-3.9987619-3.9987143-3.9987619-2.2084762.0-3.9987619 1.7902857-3.9987619 3.9987619.0 2.2084286 1.7902857 3.9987143 3.9987619 3.9987143zm0-10.15895239c3.4021905.0 6.1601905 2.75799999 6.1601905 6.16023809.0 3.4021905-2.758 6.1601905-6.1601905 6.1601905-3.4022381.0-6.16023809-2.758-6.16023809-6.1601905.0-3.4022381 2.75799999-6.16023809 6.16023809-6.16023809zm7.8431429-.24338095c0 .79504762-.644523800000002 1.43952381-1.4395715 1.43952381C19.6085952 9.03592857 18.9640714 8.39145238 18.9640714 7.59640476S19.6085952 6.15683333 20.4035952 6.15683333c.795047699999998.0 1.4395715.64452381 1.4395715 1.43957143z"/></svg>
</a><a class=social-icon href=https://www.linkedin.com/in/naoya-furudono target=_blank rel=noopener title=LinkedIn><svg width="28" height="28" viewBox="0 0 28 28" fill="#ababab" xmlns:xlink="https://www.w3.org/1999/xlink"><path d="M2 3.654102c0-.95502059.79442509-1.73012354 1.77383592-1.73012354H24.2261641C25.2058917 1.92397846 26 2.69908141 26 3.654102V24.3462148C26 25.3015521 25.2058917 26.0760215 24.2261641 26.0760215H3.77383592C2.79442509 26.0760215 2 25.3015521 2 24.3465315V3.65378524 3.654102zM9.27526132 22.1415901V11.2356668H5.65030092V22.1415901H9.27557808 9.27526132zM7.46341463 9.74691162c1.2638581.0 2.05068103-.83750395 2.05068103-1.88406715C9.49033893 6.79252455 8.72727273 5.97846056 7.48748812 5.97846056c-1.24073487.0-2.05099778.81406399-2.05099778 1.88438391.0 1.0465632.78650618 1.88406715 2.00316756 1.88406715h.02343998H7.46341463zM11.2815965 22.1415901h3.6246436v-6.089642C14.9062401 15.7263225 14.9299968 15.4000634 15.0256573 15.1675641c.261957499999999-.6515679.8584099-1.3259423 1.8599936-1.3259423 1.3113716.0 1.836237 1 1.836237 2.4662654v5.8337029h3.6246436V15.8885017c0-3.349699-1.7880899-4.9084574-4.172949-4.9084574-1.9553373.0-2.814064 1.0928097-3.2910991 1.8371872H14.9065569v-1.581248H11.2819132C11.3291099 12.2591067 11.2815965 22.1419069 11.2815965 22.1419069V22.1415901z"/></svg>
</a><a class=social-icon href=https://github.com/naoyafurudono target=_blank rel=noopener title=GitHub><svg width="28" height="28" viewBox="0 0 28 28" fill="#ababab" xmlns:xlink="https://www.w3.org/1999/xlink"><path d="M13.9988029 1.32087331C6.82105037 1.32087331 1 7.14112562 1 14.3212723c0 5.7436386 3.72454649 10.6157955 8.89038951 12.3348169C10.5408085 26.7757983 10.7778323 26.374374 10.7778323 26.0296121 10.7778323 25.7215609 10.7666595 24.9035493 10.760275 23.8189856 7.14426471 24.6042767 6.38131925 22.0760223 6.38131925 22.0760223c-.59136253-1.5019491-1.44369072-1.9017772-1.44369072-1.9017772C3.75729765 19.3682044 5.02701126 19.3841656 5.02701126 19.3841656 6.33183953 19.4759425 7.01817121 20.7241085 7.01817121 20.7241085c1.15958133 1.9863716 3.04300319 1.4125664 3.78360289 1.0797753.1181129-.8395592.4540962-1.4125663.8251942-1.7373768C8.74038491 19.7385043 5.70536235 18.6228163 5.70536235 13.6413251c0-1.4189508.50676816-2.5801283 1.33834679-3.4883207C6.90963504 9.82420367 6.46351945 8.50181809 7.17139875 6.71256734c0 0 1.09094816-.34955032 3.57451115 1.33276037C11.78259 7.75642995 12.8950858 7.61277914 14.000399 7.60719272 15.1049142 7.61277914 16.2166119 7.75642995 17.2548881 8.04532771c2.4819669-1.68231069 3.571319-1.33276037 3.571319-1.33276037C21.5356825 8.50181809 21.0895669 9.82420367 20.9562909 10.1530044 21.7894656 11.0611968 22.2922435 12.2223743 22.2922435 13.6413251c0 4.9942601-3.039811 6.0931889-5.935173 6.4148071.4660671.401424200000001.8818564 1.194696.8818564 2.4077473C17.2389269 24.2012564 17.2229657 25.603448 17.2229657 26.0296121 17.2229657 26.3775663 17.4575954 26.7821827 18.116793 26.6552912 23.2786458 24.9322794 27 20.0633148 27 14.3212723 27 7.14112562 21.1789496 1.32087331 13.9988029 1.32087331"/></svg></a></div><p><a href=https://github.com/naoyafurudono/naoyafurudono.github.io target=_blank rel=noopener>source of this site</a></p><p><a href=https://gohugo.io target=_blank rel=noopener></a></p><p>©2025 Naoya Furudono</p><script src=https://blog.nfurudono.com/js/main.min.a7205ef73b078c8daed6fe1b0826e8ba229ffabbb69d299d9446cf41f2c7d8aa.js integrity="sha256-pyBe9zsHjI2u1v4bCCbouiKf+ru2nSmdlEbPQfLH2Ko=" crossorigin=anonymous></script><a target=_blank rel="noopener noreferrer" href=https://github.com/naoyafurudono/naoyafurudono.github.io/actions><img src=https://github.com/naoyafurudono/naoyafurudono.github.io/actions/workflows/gh-pages.yml/badge.svg alt="github pages deploy status" style=max-width:100%></a><p><a href="https://www.amazon.jp/hz/wishlist/ls/1JBRXP4JZZ21T?ref_=wl_share">欲しい本リスト</a></p><p><a href="https://www.amazon.jp/hz/wishlist/ls/3TT5GR81VZPHP?ref_=wl_share">欲しいものリスト</a></p></footer></nav><div id=content class=content-container><h1>"tech"</h1><article><h2><a href=https://blog.nfurudono.com/posts/avoid-23-59-59/>23:59:59という時刻を扱うのはやめよう</a></h2><div><p><p>この記事は生成AIを使って書いた記事です。ほとんど生成したものですが、レビューしてありますし加筆修正を人間が行なっています。</p><hr><p>プログラミングやシステム設計において、しばしば「23:59:59」という時刻が“終端”（end of day）として扱われます。しかし、このアプローチには多くの落とし穴（pitfalls）や混乱が潜んでいます。本稿では、なぜ23:59:59のような終端時刻を避けるべきかを整理し、より堅牢で明快な代替手法をご紹介します。</p><h2><a href=#%e8%aa%b2%e9%a1%8c id=課題 class=anchor aria-hidden=true>課題</a></h2><h3><a href=#1-%e5%a2%83%e7%95%8c%e5%80%a4boundary-value%e3%81%ae%e5%95%8f%e9%a1%8c id=1-境界値boundary-valueの問題 class=anchor aria-hidden=true>1. 境界値（Boundary Value）の問題</a></h3><ul><li><strong>オフバイワンエラー（Off-by-one Error）</strong>
23:59:59を終了時刻として設定すると、しばしば「23:59:60」や「24:00:00」をどう扱うかで混乱が生じます。特に、うるう秒（leap second）の挿入時には「23:59:60」が発生し、想定外のバグを誘発することがあります。</li><li><strong>不明瞭な閉区間（Closed Interval）と開区間（Half-open Interval）</strong>
23:59:59を含むか否か、すなわち区間を[00:00:00, 23:59:59]（閉区間）で扱うのか、[00:00:00, 23:59:59)（半開区間）で扱うのかが曖昧になり、仕様書（specification）と実装に齟齬が生じがちです。</li></ul><h3><a href=#2-%e6%97%a5%e4%bb%98%e5%a4%89%e6%9b%b4%e3%81%a8%e3%81%ae%e9%bd%9f%e9%bd%ac id=2-日付変更との齟齬 class=anchor aria-hidden=true>2. 日付変更との齟齬</a></h3><ul><li><strong>日次バッチ（Daily Batch）とカレンダー表示</strong>
例えば、日次バッチ処理を「23:59:59までのデータを集計」と定義すると、処理が終わるわずかな遅延で翌日の00:00:00以降のデータが取りこぼされたり、重複集計されたりする恐れがあります。</li><li><strong>ユーザーインターフェース（UI）の混乱</strong>
ユーザーに「23:59:59表示」を強いると直感的ではなく、かえって誤操作を招くことがあります。多くの人にとって「23:59:59」はピンと来にくく、特にミリ秒（milliseconds）やタイムゾーン（time zone）をまたぐ場合の理解が難しくなります。</li></ul><h3><a href=#3-%e3%82%b7%e3%82%b9%e3%83%86%e3%83%a0%e5%ae%9f%e8%a3%85%e3%81%ae%e8%a4%87%e9%9b%91%e5%8c%96 id=3-システム実装の複雑化 class=anchor aria-hidden=true>3. システム実装の複雑化</a></h3><ul><li><strong>データベース（Database）のクエリ</strong>
<code>WHERE timestamp &lt;= '2025-04-30 23:59:59'</code> といった条件は、ミリ秒精度のタイムスタンプやタイムゾーンが絡むと正確性を欠きやすいです。</li><li><strong>テスト（Testing）とモック（Mock）の難易度</strong>
テスト時に23:59:59を意図的に生成・モックするのは手間がかかり、テストケースの網羅性を落とす原因となります。</li></ul><h2><a href=#%e8%a7%a3%e9%87%88%e3%82%92%e5%a4%89%e3%81%88%e3%81%a6000000240000%e3%82%92%e6%89%b1%e3%81%86 id=解釈を変えて000000240000を扱う class=anchor aria-hidden=true>解釈を変えて00:00:00(24:00:00)を扱う</a></h2><p>23:59:59を扱いたいときは、きっと何かの期間の終わりを表すことを目的としているでしょう。「終わりの時刻まで」、と捉える代わりに終わりの時刻の直前までと捉えることで、23:59:59ではなく00:00:00を扱えば済むようになってすっきりします。具体的には以下の通りです。</p><h3><a href=#%e5%8d%8a%e9%96%8b%e5%8c%ba%e9%96%93half-open-interval%e3%82%92%e4%bd%bf%e3%81%86 id=半開区間half-open-intervalを使う class=anchor aria-hidden=true>半開区間（Half-open Interval）を使う</a></h3><ul><li><strong>[開始, 終了) の形式</strong>
例：[2025-04-01 00:00:00, 2025-05-01 00:00:00)<ul><li>「2025-04-01 00:00:00以上かつ2025-05-01 00:00:00未満」という明確な条件設定が可能。</li><li>オフバイワンエラーを防ぎ、うるう秒も意識不要。</li></ul></li></ul><h3><a href=#iso-8601%e3%81%ae2400%e3%82%92%e6%b4%bb%e7%94%a8%e3%81%99%e3%82%8b id=iso-8601の2400を活用する class=anchor aria-hidden=true>ISO 8601の24:00を活用する</a></h3><ul><li><strong>「24:00」表記</strong><ul><li>同日23:59:59の次に位置づけられるため、論理的な終端（end-of-day）を明示できます。</li><li>例：<code>2025-04-30T24:00:00</code> は <code>2025-05-01T00:00:00</code> と同一視されます。</li><li>ただし、すべてのライブラリがサポートしているわけではない点に注意。</li></ul></li></ul><hr><p>23:59:59を終端時刻として安易に扱うのは、多くの境界値エラーや実装・運用の混乱を招く原因となります。代わりに、半開区間（half-open interval）[開始, 終了)やISO 8601の24:00表記を採用し、仕様（spec）から実装（implementation）、テスト（testing）まで一貫して明確な時刻管理を行いましょう。これにより、バグの減少と運用コストの削減が期待できます。</p><hr><p><strong>参考情報</strong></p><ul><li>ISO 8601: 日付及び時刻のデータ要素と交換形式</li><li>ソフトウェアテストにおける境界値分析（Boundary Value Analysis）</li><li>半開区間について過去に調べた記事: <a href=https://dev.nfurudono.com/posts/semi-open-interval/>https://dev.nfurudono.com/posts/semi-open-interval/</a></li></ul><p>以上を踏まえ、次回からは「23:59:59」という時刻を見直し、より堅牢な方法で時刻管理（time management）を実践してみてはいかがでしょうか。</p></p></div><div class=post-footer><time>April 30, 2025</time></div></article><article><h2><a href=https://blog.nfurudono.com/posts/read-a-philosophy-of-softfare-design/>A Philosophy of Software Designの読書メモ</a></h2><div><p><p>各章のまとめをする。随時僕の思ったことを差し込む。なのでこのドキュメントを読んであの本を読んだ気になってはいけないし、あの本と同じくらいに信頼してはいけない。</p><h2><a href=#preface id=preface class=anchor aria-hidden=true>Preface</a></h2><h3><a href=#%e3%82%bd%e3%83%95%e3%83%88%e3%82%a6%e3%82%a7%e3%82%a2%e3%81%ae%e8%a8%ad%e8%a8%88%e3%81%a8%e3%81%8b%e8%89%af%e3%81%84%e3%82%bd%e3%83%95%e3%83%88%e3%82%a6%e3%82%a7%e3%82%a2%e3%81%8c%e4%bd%95%e3%81%8b%e3%81%a8%e3%81%8b%e3%81%ae%e8%ad%b0%e8%ab%96%e3%81%8c%e6%9c%aa%e7%86%9f%e3%81%a7%e3%81%82%e3%82%8b id=ソフトウェアの設計とか良いソフトウェアが何かとかの議論が未熟である class=anchor aria-hidden=true>ソフトウェアの設計とか、良いソフトウェアが何かとかの議論が未熟である</a></h3><ul><li>以下のような事項については議論がされている<ul><li>開発プロセス</li><li>開発ツール</li><li>プログラミングテクニック<ul><li>OOP</li><li>functional</li></ul></li><li>デザインパターンとかアルゴリズム</li></ul></li><li>設計については1971の &ldquo;On the Criteria to be used in Decomposing Systems into Modules&rdquo; から発展がない</li></ul><h3><a href=#%e8%a8%ad%e8%a8%88%e6%8a%80%e6%b3%95%e3%82%92%e4%bd%93%e7%b3%bb%e7%9a%84%e3%81%ab%e8%ba%ab%e3%81%ab%e3%81%a4%e3%81%91%e3%81%a6%e8%a4%87%e9%9b%91%e3%81%95%e3%82%92%e6%b8%9b%e3%82%89%e3%81%9b%e3%82%8b%e3%82%88%e3%81%86%e3%81%ab%e3%81%99%e3%82%8b%e3%81%93%e3%81%a8%e3%82%92%e7%9b%ae%e6%8c%87%e3%81%99 id=設計技法を体系的に身につけて複雑さを減らせるようにすることを目指す class=anchor aria-hidden=true>設計技法を体系的に身につけて複雑さを減らせるようにすることを目指す</a></h3><ul><li>分割統治が大きな関心ごとだが、そのための教育はされていない<ul><li>どのように問題を分割するか</li><li>問題の分割を決めることは設計のでかいタスクの一つ</li></ul></li><li>プログラマの品質とか生産性にはそれなりにばらつきがある<ul><li>能力には才能ではなくて良い練習が効くのは一般的に言われているらしい</li></ul></li><li>設計のスキルがプログラマのすごい・普通を分けるだろうと仮定して、学部一年生に対して講義を始めた<ul><li>原理・原則を座学で伝える</li><li>ソフトウェア開発のプロジェクトもやって、それらを活かす練習をする<ul><li>学生はたくさんコードを書いて講師にレビューを受けて改善する</li></ul></li></ul></li><li>その講義で伝えた設計の原則を集めたのがこの本</li><li>この本を書いた人はスタンフォードの教授で色々ソフトウェアを作ってきた</li><li>複雑さを減らすことがどの原則よりも大切</li></ul><h2><a href=#chapter-1-introduction-its-all-about-complexity id=chapter-1-introduction-its-all-about-complexity class=anchor aria-hidden=true>Chapter 1. Introduction (It&rsquo;s all about complexity)</a></h2><h3><a href=#%e8%89%af%e3%81%84%e3%82%bd%e3%83%95%e3%83%88%e3%82%a6%e3%82%a7%e3%82%a2%e3%82%92%e3%81%84%e3%81%84%e6%84%9f%e3%81%98%e3%81%ab%e4%bd%9c%e3%82%8b%e3%81%9f%e3%82%81%e3%81%ab%e3%81%af%e8%a4%87%e9%9b%91%e3%81%95%e3%81%ab%e5%af%be%e5%87%a6%e3%81%99%e3%82%8b%e3%81%93%e3%81%a8%e3%81%8c%e5%bf%85%e8%a6%81 id=良いソフトウェアをいい感じに作るためには複雑さに対処することが必要 class=anchor aria-hidden=true>良いソフトウェアをいい感じに作るためには複雑さに対処することが必要</a></h3><ul><li>ソフトウェアはそれがどんなものであるかを表現できれば作れたも同然である。例えば筋肉がなくても作れる</li><li>そのためソフトウェアを書くのを律速する能力は、作っているシステムがどんなものであるかを理解する能力である</li><li>残念なことにプログラムを成長させていくに連れて複雑さは増していく。</li><li>複雑さを増すとそのソフトウェアを理解することは難しくなり、成長させる速度やコストは増す。バグも入る</li><li>開発ツールで複雑さに対処することはできるし、そうしてきた<ul><li>コード生成とかバージョン管理とかプログラミング言語とかはその例</li></ul></li><li>ツールの力だけでなんとかしきることは、とはいえ無理</li><li>ソフトウェアを簡単に作れるようになって、もっとすごいシステムを安価に作れるようになるためにはソフトウェアをシンプルに保つことが必要</li><li>まあ複雑さはどう頑張っても増えるものではあるのだけど、設計をシンプルにしておけばソフトウェアがでかく強力になってもまだ耐えられるようにできる</li></ul><h3><a href=#%e8%a4%87%e9%9b%91%e3%81%95%e3%82%92%e6%b8%9b%e3%82%89%e3%81%99%e3%81%9f%e3%82%81%e3%81%ab%e3%81%af%e4%ba%8c%e3%81%a4%e3%81%ae%e3%82%a2%e3%83%97%e3%83%ad%e3%83%bc%e3%83%81%e3%81%8c%e3%81%82%e3%82%8b id=複雑さを減らすためには二つのアプローチがある class=anchor aria-hidden=true>複雑さを減らすためには二つのアプローチがある</a></h3><ul><li>コードをシンプルで明らかにすること: こっちはまあそうでしょう、と思える<ul><li>名前の付け方に一貫性を持たせる</li><li>特別扱いを減らす</li></ul></li><li>複雑性をカプセル化する。(moduler designと呼ぶらしい)<ul><li>分割統治をするということ</li><li>丁寧に説明すると、でかい問題を解決するために部分問題の証明を忘れられるようにすること</li></ul></li></ul><h3><a href=#%e9%96%8b%e7%99%ba%e8%80%85%e3%81%af%e3%82%bd%e3%83%95%e3%83%88%e3%82%a6%e3%82%a7%e3%82%a2%e3%81%ae%e8%a4%87%e9%9b%91%e3%81%95%e3%81%ab%e5%af%be%e5%87%a6%e3%81%97%e7%b6%9a%e3%81%91%e3%82%8b%e5%bf%85%e8%a6%81%e3%81%8c%e3%81%82%e3%82%8b id=開発者はソフトウェアの複雑さに対処し続ける必要がある class=anchor aria-hidden=true>開発者はソフトウェアの複雑さに対処し続ける必要がある</a></h3><p>橋とかのデザインと違って、ソフトウェアはずっと設計を変え続けるもの。この考え方に足していないのがウォーターフォールな開発で、一度に全体を設計したらそれを開発の過程で変更することはなく、もし微妙なところが出ても書く開発対象の範囲内で対処する。</p><p>アジャイル開発は設計を変え続けるアプローチに即している。将来的に開発したいでかいものは見据えつつ全体の設計は後回しにして欲しいソフトウェアのサブセットをまずは設計して開発する。開発の段階でまずそうとわかった設計は、次の開発の前に変更してまずさを潰す。こうすることで設計の問題が小さいうちに課題を発見し解決できる見込みが増える。</p><p>こういうイテレーティブな開発では設計が終わることはない。開発者は常に設計に気をかける必要があるし再設計する必要がある。改善するために小さく刻んで開発しているのだからそれはそう。設計を改善できないのならば、アジャイルに開発する意味がない。</p><p>今日ではアジャイルな開発をしているわけで、開発者常に設計の課題について考える必要がある。設計のことに常に気をかけないということは、常に複雑さに対処しなければならないということ。</p><h3><a href=#%e3%81%93%e3%81%ae%e6%9c%ac%e3%81%ae%e7%9b%ae%e7%9a%84 id=この本の目的 class=anchor aria-hidden=true>この本の目的</a></h3><p>二つある</p><ol><li>ソフトウェアの複雑さを理解すること</li></ol><ul><li>複雑さとは何か</li><li>複雑さは何が問題なのか</li><li>不必要な複雑さを持っていることにどのようにして気がつくか</li></ul><ol><li>ソフトウェア開発にあたって、複雑さを最小化するための個別なテクニックを習得すること</li></ol><h2><a href=#chapter-2-the-nature-of-complexity id=chapter-2-the-nature-of-complexity class=anchor aria-hidden=true>Chapter 2. The Nature of Complexity</a></h2><p>この章では複雑さとは何かや、どのようにシステムが不必要に複雑であるかを見分けるかを議論する。設計がシンプルかを見分けるだけでは設計をシンプルに作ることはできないが、その判断をもとにシンプルに作るためのアプローチをできる。</p><p>設計方針を色々試してみれば良くて、その結果いい感じになるやつを使えば良い。そのいい感じになるかの評価をできるようにすることがこの章の目的である。</p><h3><a href=#%e8%a4%87%e9%9b%91%e3%81%95%e3%81%ae%e5%ae%9a%e7%be%a9 id=複雑さの定義 class=anchor aria-hidden=true>複雑さの定義</a></h3><p>この本で議論を進めるために以下のように複雑さを定義する: 複雑さはソフトウェアシステムの構造に関するもののうち、システムの理解や修正を難しくするものである。</p><p>例えば以下のような例がある</p><ul><li>コード片がどのように動作しているか理解できない</li><li>システムのどこを修正して良いかわからない</li><li>他に影響を与えずにバグ修正をするのがむずい</li></ul><p>要するに、理解と修正が難しければそのソフトウェアシステムは複雑であるということ。それが簡単だったらシンプル。</p><p>システムの複雑さは、コンポーネントの複雑さをその変更頻度で重み付けした上での総和であると思える。</p><p>また、読み手にとっての複雑さと書き手にとっての複雑さは異なる。書き手にとってシンプルであっても読み手にとって複雑であればそれは複雑である。自分がそういうコードの書き手であったら、その分断が起きた理由を探ると良いだろう。そのギャップを埋める必要がこの仕事にはあるのだから。</p><h3><a href=#%e8%a4%87%e9%9b%91%e3%81%95%e3%81%ae%e7%97%87%e7%8a%b6 id=複雑さの症状 class=anchor aria-hidden=true>複雑さの症状</a></h3><p>一般的に三つの兆しがあって、開発を辛くする</p><ul><li>変更範囲の拡大: 簡単にできそうな変更が思ったより大変なパターン。メンタルモデルとその実現方法があっていないときに生じる。メンタルモデルを表現する力が足りていない</li><li>認知負荷: うまく使うためにやらないといけないことが多いことが原因</li><li>unknow unknown: 変更する必要性に気がつけなくなっていること</li></ul><p>unknown unknownが特に辛い。変更範囲が広いのはめんどいのは間違い無いのだけど、全部対処すれば自信を持って変更を完遂できる。一方でunknown unknownは自信を持つために全てのコードを読む必要があって辛い。システムがでかいとそもそも無理。</p><p>設計の目標の一つにシステムを明らかにすることがある。認知負荷とunknown unknownを減らすことにつながる。理解もコーディングもシュッとできるのがいい。何かを考えてそれが実際に通じるかの判断も簡単になる。</p><h3><a href=#%e8%a4%87%e9%9b%91%e3%81%95%e3%81%ae%e5%8e%9f%e5%9b%a0 id=複雑さの原因 class=anchor aria-hidden=true>複雑さの原因</a></h3><p>複雑さの症状をざっと見て、なんでソフトウェア開発が辛くなるのかを議論した。次に複雑さの原因を議論してシステムに問題が入らないように設計できるようになりたい。</p><p>複雑さは依存と不明瞭さによって生じる。ここではそれらをざっくり語って、後の章では細々とした設計での意思決定がどのようにそれらと関係するかをみる。</p><h4><a href=#%e4%be%9d%e5%ad%98 id=依存 class=anchor aria-hidden=true>依存</a></h4><p>扱う対象がそれ単体では理解できない、変更できないときに一緒に変更するやつに依存するという。頻繁に変更するコンポーネントが他のコンポーネントに依存していると、依存されているコンポーネントまで頻繁に変更するハメになる。そこで以下のシステムの複雑さの定義の言い換えを思い出す。</p><blockquote><p>システムの複雑さは、コンポーネントの複雑さをその変更頻度で重み付けした上での総和であると思える。</p></blockquote><p>依存が多いシステムではたくさんのコンポーネントの変更頻度が上がるため、システムの複雑さも大きい。</p><p>特に複雑なコンポーネントを他の変更が多いコンポーネントから依存させないことがシステム全体の複雑さを抑えるために効く。</p><h4><a href=#%e4%b8%8d%e6%98%8e%e7%9e%ad%e3%81%95 id=不明瞭さ class=anchor aria-hidden=true>不明瞭さ</a></h4><p>大事な要素が明らかになっていないことを指す。例えば数値の単位がわからないとか、名前がなんの意味も表してないとか。あるいは依存が存在することが明らかじゃ無いのもそう。一貫性のなさもこの要因で、同じ名前が異なる用途に使われているとやばい。</p><p>ドキュメントがやばいことが多くの原因で、コメントをちゃんと書けばよかったりする。デザインが良ければそもそも明らかであってドキュメントを不要にすることもできる。</p><p>めっちゃコメントがいるような場合はデザインがまずいことの兆しだし、明瞭さを増すためにはシステムの設計を改善するのが正攻法。</p><p>依存は変更範囲の拡大と認知負荷に作用して、不明瞭さはunknown unknownと認知負荷に作用する。依存と不明瞭さを下げる設計技法が手に入ればソフトフェアの複雑さを下げられるはずだ。</p><h3><a href=#%e8%a4%87%e9%9b%91%e3%81%95%e3%81%af%e3%82%b7%e3%82%b9%e3%83%86%e3%83%a0%e5%85%a8%e4%bd%93%e3%81%ae%e3%82%82%e3%81%ae id=複雑さはシステム全体のもの class=anchor aria-hidden=true>複雑さはシステム全体のもの</a></h3><p>一個一個の細かい要因が全体を壊すほどの複雑さ単独で生むわけではなくて、複数が重なり合って首が回らなくなるもの。対処するためには &ldquo;zero tolerance&rdquo; philosophy に従うべきらしい。</p><p>複雑さは既存のコードベースを修正することを難しく、またリスキーにする。</p><h2><a href=#chapter-3-working-code-isnt-enough-strategic-vs-tactical-programming id=chapter-3-working-code-isnt-enough-strategic-vs-tactical-programming class=anchor aria-hidden=true>Chapter 3. Working Code Isn&rsquo;t Enough (Strategic vs. Tactical Programming)</a></h2><p>プログラミングタスクに際してのマインドセットは良いソフトウェア設計のために大事な要素である。</p><p>良いデザインを得るためには、すぐにコードが動くことを至上とするするtacticalなマインドセットではなくて、綺麗なデザインのために時間をかけた上で問題点を修正する方針が必要だ。</p><p>この章ではなんで戦略的なアプローチが良い設計を生むのか、そして戦略的なアプローチの方が結果的には安いことを主張する。</p><h3><a href=#tactical-programming%e3%81%a8%e3%81%af%e3%81%a9%e3%82%93%e3%81%aa%e3%81%8b id=tactical-programmingとはどんなか class=anchor aria-hidden=true>Tactical Programmingとはどんなか</a></h3><p>多くの開発ではtacticalな手法が取られる。例えばバグを治すためにその場しのぎの対症療法をするようなこと。確かにそのときは早いのだけど、良いシステムの設計が得られることはないだろう。そういうときに、少しずつ不必要な複雑さがシステムに入り込む。</p><p>そのうちしんどさに気がついてリファクタリングとかをしたくなるのだけれど、仕事には期限があって新しい機能を追加しないといけないからやはり複雑さは残ったままになる。今見えている問題にはすぐに効くパッチだけ当てて、全体をよくすることはない。</p><p>そのうちマジでヤバくなるのだけど、その頃には全体を治すのが大変になっていて、当然そんな時間を取ることはできないので諦めてずっとその場しのぎの変更を入れ続けることになる。</p><p>一回tacticalな道に足を踏み入れるとそこから抜け出すことは容易ではないのだ。</p><h3><a href=#storategic-programming%e3%81%a8%e3%81%af%e3%81%a9%e3%82%93%e3%81%aa%e3%81%8b id=storategic-programmingとはどんなか class=anchor aria-hidden=true>Storategic Programmingとはどんなか</a></h3><p>まともなソフトウェア設計者になるための第一歩は動くだけのコードでは不十分であることに気が付くことだ。タスクを早く終わらせるために不必要な複雑さをコードに入れることは許されない。コードは既存のものに追加されていくものなので、今書かれているコードを将来誰かが編集することにもなる。なので今書くコードは動くだけでなく素晴らしい設計を体現することを目標にしないといけない（もちろん動く必要はあるけど）。</p><p>Strategic programmingには投資の心構えが必要で、例えばよく考えることに時間を投資するとか、いくつか設計してみて一番綺麗なやつを選ぶとかする。変更の可能性をいくつか想定してみてまあいけそうだと思えることを検証する。良いドキュメントを書くこともその一環である。
colliraryとして、良い設計をするためにはソフトウェアを変更する能力が効く、が主張できる。ソフトウェアを変更する能力がないひとは変更に強いことを主張できないが、変更する能力がある人はその設計がどこまでの変更をどのくらいの大変さで実施できるかを評価できる。他にも、設計がまずいことに気がついたときに目を瞑るのではなくちょっと時間をかけてよくする必要がある。</p><h3><a href=#%e3%81%a9%e3%82%8c%e3%81%8f%e3%82%89%e3%81%84%e6%8a%95%e8%b3%87%e3%81%99%e3%82%8b%e3%81%b9%e3%81%8d%e3%81%8b id=どれくらい投資するべきか class=anchor aria-hidden=true>どれくらい投資するべきか</a></h3><p>最初に全部設計するのは効果的ではなさそう。理想的な設計は作りながらわかっていくものなので、少しずつのたくさんの投資を基礎の上で行うこと。
1-2割の時間を設計にかけることをここでは提案している。スケジュールを破壊するほどは長くはないし、利益を産むために十分な時間でもあるはず。</p><h3><a href=#%e3%82%b9%e3%82%bf%e3%83%bc%e3%83%88%e3%82%a2%e3%83%83%e3%83%97%e3%81%a0%e3%81%8b%e3%82%89%e3%81%bf%e3%81%9f%e3%81%84%e3%81%aa%e8%a8%80%e3%81%84%e8%a8%b3%e3%81%af%e9%80%9a%e3%81%98%e3%81%aa%e3%81%95%e3%81%9d%e3%81%86 id=スタートアップだからみたいな言い訳は通じなさそう class=anchor aria-hidden=true>スタートアップだから、みたいな言い訳は通じなさそう</a></h3><p>Facebook, Google, VMWareを引き合いに出してstorategicにやった方が良さそうですよ、と主張している。意味的に新しいことはここでは特に言ってなさそう。よくある（本当によくある）tactical programmingの正当化への反論をここではしている。</p><h3><a href=#%e6%95%99%e8%a8%93 id=教訓 class=anchor aria-hidden=true>教訓</a></h3><ul><li>storategic programmingをしろ、効果は思ったよりもすぐに現れる</li><li>明日ではなく今日やるもの</li><li>全てのエンジニアが良い設計への投資をすることが効果的</li></ul><h2><a href=#chapter-4-modules-should-be-deep id=chapter-4-modules-should-be-deep class=anchor aria-hidden=true>Chapter 4. Modules Should Be Deep</a></h2><p>開発者がシステム全体ではなく一部の複雑さだけに対処すれば良い方にすることを目的とするソフトウェア設計着本がある。
Modular designと呼ばれていて、ソフトウェアの複雑さをなんとかするためにすごく大切。</p><p>この章ではこの基本的な原則を解説する。</p><h3><a href=#modular-design%e3%81%a8%e3%81%af%e4%bd%95%e3%81%8b id=modular-designとは何か class=anchor aria-hidden=true>Modular designとは何か</a></h3><p>ソフトウェアシステムを複数の（それなりに独立した）モジュールに分解する。ここでいうモジュールはクラスかもしれないし、サブシステムかもしれないし、サービスかもしれない。理想的にはそれぞれのモジュールは他には全く依存しないで欲しい、つまり開発者はそれぞのれモジュールを他のモジュールのことを完全に忘れて開発できるようになっていて欲しい。そういう理想的な世界では、ソフトウェアシステムの複雑さはそれを構成するモジュールたちの複雑さの中で一番複雑なやつの複雑さである（あれ、そういう定義だったか。まあ気持ちはわかる）。</p><p>現実世界ではそうは問屋が卸さなくて、あるモジュールは他のモジュールの関数とかを呼ぶ必要があって、多かれ少なかれ他のモジュールを知っておく必要がある。モジュールの間いに依存が生じることもあるはず（つまりあるモジュールを変更したら、他のモジュールを変更する必要が出てくるかもしれないということ）。
Modular designの目的はモジュール間の依存を最小化すること。</p><p>依存を管理するためにはモジュールを二つの要素、インターフェースと実装に分けて捉えると良いだろう。モジュールを外から使うために知っておくべきものがインターフェースで、そのモジュールが何をするかを表す。それをどのように実現するかは表さないのが典型的。実装はインターフェースを満たすためのもの。あるモジュールで仕事をする開発者は、他のモジュールのインターフェース、そのモジュールのインタフェース、そのモジュールの実装を頭に入れて働くことになる。他のモジュールの実装を頭に入れる必要はないし、そうしないべきである。</p><p>ここでいうインターフェースはプログラミング言語の意味論で強制されるものに限らなくて、自然言語でドキュメントとして記述されることもある。そのモジュールを使うために開発者が知るべき情報は全てインターフェースの一部である。形式的でない部分はコメントとして書くしかなくて、それが正しいことをプログラミング言語が保証することはできない。そして残念なことにそういう形式的でない部分は複雑でより多い傾向にある。</p><p>明瞭に書かれたインターフェースは開発者がそのモジュールを使うために知る必要のあることを占めることであって、unknown unknownを減らす。</p><h3><a href=#%e6%8a%bd%e8%b1%a1%e5%8c%96 id=抽象化 class=anchor aria-hidden=true>抽象化</a></h3><p>Modular designと関係する概念。抽象化は対象を単純化した見方のことで、重要でない詳細を捨てたもの。複雑なことをしなくてもそれを扱えるようになるので抽象化は便利。</p><p>モジュラなプログラミングではモジュールがインターフェースによってその抽象化を提供することになる。インターフェースはモジュールの単純化された機能を説明することになるということ。モジュールを使うためには重要でない詳細を捨ててそのモジュールを理解すれば済むので嬉しい。</p><p>捨てているのが重要でない部分であるのが大切。抽象化のミスり方には二つある。</p><ol><li>重要でない詳細を抽象化に含めること: 抽象化を複雑にする点でよくない</li><li>重要な詳細を抽象化に含めないこと: 不明瞭なシステムになるのが良くない。抽象化だけをみている開発者はその抽象化を正しく使うために必要な情報を見落とすことになる</li></ol><p>後者のことをfalse abstractionと呼ぶ。一見シンプルだけど実はそうでもないやつ。抽象化を設計するためにはどんな情報が大切かと、どのように大切な情報を減らすかが鍵。</p><h3><a href=#deepshallow-modules-classiti id=deepshallow-modules-classiti class=anchor aria-hidden=true>Deep/shallow modules, classiti</a></h3><p>機能的でシンプルなインターフェースを持つモジュールが最高のモジュールということになりそう。抽象化がうまくいったやつがいい。そういうモジュールのことをdeepなモジュールと呼んでいる。</p><p>反対にインターフェースが複雑な割に大した機能を提供してないものはshallowなモジュール。</p><p>我々はモジュールをdeepにすることを目指すべきであって、そのインターフェースの絶対的なサイズは問題ではない。</p><h3><a href=#%e3%81%be%e3%81%a8%e3%82%81 id=まとめ class=anchor aria-hidden=true>まとめ</a></h3><ul><li>モジュールをインターフェースと実装に分けて捉えることで、その複雑さをシステムの他の部分から隠せる</li><li>そのモジュールを使う側はそのインターフェースだけに気をかければ良い</li><li>大事なことはモジュールが深くなるように設計すること。そうすれば隠蔽できる複雑さを最大化できてシステム全体の複雑さを抑えることに貢献できる</li></ul></p></div><div class=post-footer><time>April 29, 2025</time></div></article><article><h2><a href=https://blog.nfurudono.com/daily/2025-04-27/>2025-04-27</a></h2><div><p><p>学生の頃に数学の先生が図書館で本読むとインターネットとかで調べるのと違って周りの本とかにも目がいって視野が広がっていいぞ、みたいなことを話していた。いらないことを言わないで聞いたことに対して察して回答をしてくれるAIがついているので、視野が以前に増して広がりにくくなっているだろう、と考えられる。実際にそうかの判断はまだ下せないと思うけど。脱線とか下手くそな質問によって見えていなかったものが見えることもあるし、そもそも今までは答えに辿り着けなかった疑問に対しても今なら到達しやすくなったと思う。速度が上がればもっと遠くに行ける気もする。なので視野が広がる力が働いているとも思える。</p><p>AIも検索も読書もすればいい</p></p></div><div class=post-footer><time>April 27, 2025</time></div></article><article><h2><a href=https://blog.nfurudono.com/daily/2025-04-07/>2025-04-07</a></h2><div><p><p>cursorのagent modeと比べてdevinの方が使い勝手よく感じる</p><p>自分とは別の知能なので手元で動かれても困る（マイクロマネジメントするの疲れるので目を離したい）
エディタでシュッと修正できるのは嬉しいとかローカルの力で操作できる嬉しさはあるかもしれないが、そこはdevinを強くすることで解決するのが正攻法な気がする</p><p>エディタには何をやらせたいだろうかとか、AIエージェントのインターフェースはどんなものであって欲しいだろうかが気になる。</p></p></div><div class=post-footer><time>April 7, 2025</time></div></article><article><h2><a href=https://blog.nfurudono.com/daily/2025-03-31/>2025-03-31</a></h2><div><p><p>設定はすぐに編集・反映できると嬉しい。編集するためにはスニペットを用意すればいいし、反映をすぐにするためにはホットリロードに対応していて欲しい。</p><p>開発にREPLがあると嬉しとか、テスト駆動開発が楽しいとかと一緒。</p></p></div><div class=post-footer><time>March 31, 2025</time></div></article><article><h2><a href=https://blog.nfurudono.com/daily/2025-03-25/>2025-03-25</a></h2><div><p><ul><li><input disabled type=checkbox> 以下の三つについて紹介しつつ、ぼくの信じる主張をする<ul><li>how to design programs</li><li>a philosophy of software design</li><li>di: これについては良い書籍を思いつかなかった、気持ちは以下からえている<ul><li>インターフェース設計</li><li>unixというかパイプ、gatherじゃないけどあのschemeの書籍に書いてあったアレみたいな原則</li><li>mock</li><li>逆数学</li><li>取り回しやすい、仮説と結論の関連付けをする含意</li><li>effect system</li><li>type class</li></ul></li></ul></li></ul><h2><a href=#%e8%a8%ad%e5%ae%9a%e3%83%95%e3%82%a1%e3%82%a4%e3%83%ab%e3%82%92%e4%b8%80%e7%99%ba%e3%81%a7%e9%96%8b%e3%81%8f%e3%82%b3%e3%83%9e%e3%83%b3%e3%83%89 id=設定ファイルを一発で開くコマンド class=anchor aria-hidden=true>設定ファイルを一発で開くコマンド</a></h2><p>fishで設定ファイルを一発で開くコマンドを書いた。導入したてのツールだとこまめに設定ファイルを編集したい。わざわざ.confgまで行ってあれこれするのが面倒なので、このコマンドを使うと幸せ。</p><pre><code class=language-fish>function conf  --description 'この関数にハードコードした設定ファイル一覧からをfzfで選択してEDITORで開く'
    set -q EDITOR; or set EDITOR vim

    # パスはfishの組み込みによって解釈される
    # 相対パスに解釈される場合はXDG_CONFIG_HOMEを常に基点として扱う
    set -l configs \
        'fish/config.fish' \
        'fish/functions/conf.fish' \
        '~/.local/fish/init.fish.secret' \
        'ghostty/config' \
        'git/config' \
        'nvim/init.lua'

    # 名前一覧をfzfで表示
    set -l selected_path (
        printf '%s\n' $configs | fzf --prompt=&quot;Edit config&gt; &quot;
    )

    test -n &quot;$selected_path&quot;; or return

    # パス展開（~など対応）
    # https://fishshell.com/docs/current/cmds/path.html#normalize-subcommand
    set selected_path (path normalize &quot;$selected_path&quot;)

    # 絶対パスでないならXDG_CONFIG_HOMEを前置
    if not string match -q --regex '^/' $selected_path
        set selected_path &quot;$XDG_CONFIG_HOME/$selected_path&quot;
    end

    # ファイルの存在確認をしてエディターを起動
    if test -f &quot;$selected_path&quot;
        $EDITOR &quot;$selected_path&quot;
    else
        echo &quot;Config file not found: $selected_path&quot;
        return 1
    end
end
</code></pre></p></div><div class=post-footer><time>March 25, 2025</time></div></article><article><h2><a href=https://blog.nfurudono.com/daily/2025-02-18/>2025-02-18</a></h2><div><p><h2><a href=#%e7%94%9f%e6%88%90ai%e3%81%ab%e5%90%a6%e5%ae%9a%e3%81%97%e3%81%a6%e3%82%82%e3%82%89%e3%81%a3%e3%81%a6%e6%96%87%e5%8f%a5%e3%81%ae%e3%81%a4%e3%81%91%e3%82%88%e3%81%86%e3%81%8c%e3%81%aa%e3%81%84%e4%b8%bb%e5%bc%b5%e3%82%92%e4%bd%9c%e3%82%8b id=生成aiに否定してもらって文句のつけようがない主張を作る class=anchor aria-hidden=true>生成AIに否定してもらって文句のつけようがない主張を作る</a></h2><p>生成AIを壁にして議論することが不毛に感じる。自分で思考することを放棄して生成AIに言わせたいことを言わせるゲームになるのが不毛であるように感じる。あいつはぼくに質問をしてこなくて、なされるがままに僕の願いを叶えるようにチューニングされている。ぼくは議論を通じて思考を深めて問題領域の理解を深めたいが、そのための思考をあいつに渡してしまうことになる。俺が論じるからお前は俺の考えをできるだけ簡潔に論破しろ、とか言えばいいのだろうか。</p><p>試したらいい感じだが、体力が必要。</p><h3><a href=#%e8%bf%bd%e8%a8%98 id=追記 class=anchor aria-hidden=true>追記</a></h3><p>文句のつけようがない主張をすると、へりくつ捏ねる子になっちゃった。難しい。</p><h2><a href=#%e3%82%a4%e3%83%99%e3%83%b3%e3%83%88%e3%81%ae%e3%81%82%e3%82%8c%e3%81%93%e3%82%8c id=イベントのあれこれ class=anchor aria-hidden=true>イベントのあれこれ</a></h2><p>去年のどこか暗いからTwitterの僕のTLとかその周りでWebアプリケーションのバックエンドのロールを作るためにイベントの概念にフォーカスすることが流行っているように感じる。</p><p>以下のようなバズワードが飛び交っている。</p><ul><li>イベントストーミング</li><li>イベントベースなドメイン駆動設計</li><li>イベントソーシング</li><li>EDA (イベント駆動アーキテクチャ)</li><li>CQRS</li><li>非同期処理</li></ul><p>それぞれがどのレイヤ（プログラミングの工程）で使われる言葉なのかを分類すると以下のようになると思う。</p><ul><li>問題領域のモデリング<ul><li>イベントストーミング</li></ul></li><li>問題を解決するためのシステム設計（システムのモデル作成）<ul><li>イベントベースなドメイン駆動設計?</li></ul></li><li>永続化する際のデータ表現とその解釈<ul><li>イベントソーシング</li><li>イベントベースなドメイン駆動設計?</li><li>CQRS?</li><li>非同期処理</li></ul></li><li>コンポーネント間での通信方式<ul><li>EDA</li><li>CQRS?</li><li>非同期処理</li></ul></li></ul><h3><a href=#todos id=todos class=anchor aria-hidden=true>todos</a></h3><ul><li><input disabled type=checkbox> ソースはどこだよ！って感じなので文章をあさって明記したい。</li><li><input disabled type=checkbox> 有効性は？<ul><li>これらの考え方、開発手法、アーキテクチャはどんなときに有効で、どんなときにもっと普通で良い解決方法があるだろうか。</li></ul></li></ul><h3><a href=#%e3%83%a1%e3%83%a2 id=メモ class=anchor aria-hidden=true>メモ</a></h3><p>イベントを永続化して、それを発展させるための手法を紹介する書籍として、<a href=https://leanpub.com/esversioning>Versioning in an Event Sourced System</a>がある。</p><h2><a href=#%e5%ae%a3%e4%bc%9d id=宣伝 class=anchor aria-hidden=true>宣伝</a></h2><p>エンジニアのフォロイーがTwitterで増えてきたように感じるので、RSSからTwitterに投稿するのをやっても良いかも。</p><p>以下の記事を参考にできそう。</p><p><a href=https://efcl.info/2023/05/28/rss-to-twitter/>https://efcl.info/2023/05/28/rss-to-twitter/</a></p><p>僕はブログを</p><ul><li>長めで</li><li>自分の資産として管理可能な</li><li>編集可能な</li></ul><p>ツイートだと思っている。なのでTwitterrで宣伝するのはターゲットが合致して良いだろう。</p></p></div><div class=post-footer><time>February 18, 2025</time></div></article><article><h2><a href=https://blog.nfurudono.com/daily/2025-02-11/>2025-02-11</a></h2><div><p><h2><a href=#zed%e3%81%a7ghes%e3%81%ae%e3%83%91%e3%83%bc%e3%83%9e%e3%83%aa%e3%83%b3%e3%82%af%e3%82%92%e5%8f%96%e5%be%97%e3%81%a7%e3%81%8d%e3%82%8b%e3%82%88%e3%81%86%e3%81%ab%e3%81%97%e3%81%9f%e3%81%84 id=zedでghesのパーマリンクを取得できるようにしたい class=anchor aria-hidden=true>ZedでGHESのパーマリンクを取得できるようにしたい</a></h2><h3><a href=#%e8%aa%bf%e6%9f%bb id=調査 class=anchor aria-hidden=true>調査</a></h3><p>普通のGitHubのリポジトリのコードではパーマリンクをコマンドから取得できるのだが、GHESだと何かがうまくいかない。エラーメッセージは以下。</p><blockquote><p>Failed to copy permalink: failed to parse Git remote URL</p></blockquote><p>おそらくremoteのドメイン名がハードコードされているとかだろう。</p><p>該当のエラーメッセージを出力しているのはここみたい。</p><p><a href=https://github.com/zed-industries/zed/blob/2e7bb11b7d5de6a79bef2491fa5ce8ecfd2bca15/crates/project/src/buffer_store.rs#L1673-L1675>https://github.com/zed-industries/zed/blob/2e7bb11b7d5de6a79bef2491fa5ce8ecfd2bca15/crates/project/src/buffer_store.rs#L1673-L1675</a></p><p>そしてそこで呼ばれているのがこれ</p><p><a href=https://github.com/zed-industries/zed/blob/2e7bb11b7d5de6a79bef2491fa5ce8ecfd2bca15/crates/git/src/hosting_provider.rs#L168-L184>https://github.com/zed-industries/zed/blob/2e7bb11b7d5de6a79bef2491fa5ce8ecfd2bca15/crates/git/src/hosting_provider.rs#L168-L184</a></p><pre><code class=language-rust>pub fn parse_git_remote_url(
    provider_registry: Arc&lt;GitHostingProviderRegistry&gt;,
    url: &amp;str,
) -&gt; Option&lt;(
    Arc&lt;dyn GitHostingProvider + Send + Sync + 'static&gt;,
    ParsedGitRemote,
)&gt; {
    provider_registry
        .list_hosting_providers()
        .into_iter()
        .find_map(|provider| {
            provider
                .parse_remote_url(url)
                .map(|parsed_remote| (provider, parsed_remote))
        })
}
</code></pre><p>正しくURLをパースできるhosting providerが存在しないのでエラーになっていそう。Hosting providerは以下で設定されている。</p><p><a href=https://github.com/zed-industries/zed/blob/2e7bb11b7d5de6a79bef2491fa5ce8ecfd2bca15/crates/git_hosting_providers/src/git_hosting_providers.rs#L11-L38>https://github.com/zed-industries/zed/blob/2e7bb11b7d5de6a79bef2491fa5ce8ecfd2bca15/crates/git_hosting_providers/src/git_hosting_providers.rs#L11-L38</a></p><pre><code class=language-rust>/// Initializes the Git hosting providers.
pub fn init(cx: &amp;App) {
    let provider_registry = GitHostingProviderRegistry::global(cx);
    provider_registry.register_hosting_provider(Arc::new(Bitbucket));
    provider_registry.register_hosting_provider(Arc::new(Codeberg));
    provider_registry.register_hosting_provider(Arc::new(Gitee));
    provider_registry.register_hosting_provider(Arc::new(Github));
    provider_registry.register_hosting_provider(Arc::new(Gitlab::new()));
    provider_registry.register_hosting_provider(Arc::new(Sourcehut));
}

/// Registers additional Git hosting providers.
///
/// These require information from the Git repository to construct, so their
/// registration is deferred until we have a Git repository initialized.
pub fn register_additional_providers(
    provider_registry: Arc&lt;GitHostingProviderRegistry&gt;,
    repository: Arc&lt;dyn GitRepository&gt;,
) {
    let Some(origin_url) = repository.remote_url(&quot;origin&quot;) else {
        return;
    };

    if let Ok(gitlab_self_hosted) = Gitlab::from_remote_url(&amp;origin_url) {
        provider_registry.register_hosting_provider(Arc::new(gitlab_self_hosted));
    }
}
</code></pre><p>ここでgithub.com以外の処理を諦めている。</p><p><a href=https://github.com/zed-industries/zed/blob/2e7bb11b7d5de6a79bef2491fa5ce8ecfd2bca15/crates/git_hosting_providers/src/providers/github.rs#L111-L128>https://github.com/zed-industries/zed/blob/2e7bb11b7d5de6a79bef2491fa5ce8ecfd2bca15/crates/git_hosting_providers/src/providers/github.rs#L111-L128</a></p><h3><a href=#%e6%89%80%e6%84%9f id=所感 class=anchor aria-hidden=true>所感</a></h3><p>現在のプロジェクトがどのGitHostingProviderを使っているかを誰も管理していない（？）ぽくて、外部からそれに依存した操作をする際は、GitHostingProviderRegistryに登録されたもの全てを試してうまくいった結果を使う、としているのがよくなさそう。以下のように作りを変えると良いだろう。</p><ul><li>まずはプロジェクトに対してGitHostingProviderを対応づけること</li><li>外部からGit関連の操作をするときはRegistryを経由しないでプロジェクトをに登録されているGitHostingProviderを使うこと</li><li>必要に応じて手動で対応づけや設定をできるようにすること</li></ul><p>あるいは拡張機能としてねじ込むのが正解か？GitHubとGitHub Enterprise Serverの違いがどんなものか次第でもあるので、そちらの調査もしたい。</p><h2><a href=#zed%e3%81%ae%e6%8b%a1%e5%bc%b5%e6%a9%9f%e8%83%bd%e3%82%92%e4%bd%9c%e3%82%8b id=zedの拡張機能を作る class=anchor aria-hidden=true>Zedの拡張機能を作る</a></h2><p>LSPサーバがある前提で、そのクライアントをZedに追加する。PythonのLSPクライアントの実装があるので、それを参考にbuf LSPを使えるようにする。</p><p><a href=https://github.com/rgbkrk/python-lsp-zed-extension/blob/main/src/python_lsp.rs>https://github.com/rgbkrk/python-lsp-zed-extension/blob/main/src/python_lsp.rs</a></p><p>何も理解してないけどローカルでクライアントをビルドして定義ジャンプを実行するところまではできた。次は何が起きているかを調べていい感じにする。
zedにマージするまでがゴール。</p><p>Zed extensionを理解して、gitのアレをextensionとして実現できないか判断したい。</p></p></div><div class=post-footer><time>February 11, 2025</time></div></article><article><h2><a href=https://blog.nfurudono.com/daily/2025-02-07/>吉祥寺.pmとBurikaigiに登壇参加した</a></h2><div><p><p>1/31に吉祥寺.pmのLT、2/1にBuriKaigiのセッションで発表しました。カレンダー上で予定かぶっていないことだけしか確認せず勢いで楽しそうなカンファレンスの楽しそうな枠に申し込んだところ、発表の間の時間が12時間くらいしかなくて大変でした。とはいえそれぞれの発表に対して準備をして知見を得られたし、聴衆と意思疎通できたとも思っています。登壇できてよかった。</p><p>主催者のかた、参加者のかた、ありがとうございました！</p><p>この記事では発表したことにフォーカスして感想をメモしますが、参加者として発表を聴いたり懇親したりするのもとても楽しかったし刺さるセッションがいくつもありました。本当に参加できてよかった。</p><h2><a href=#%e5%90%89%e7%a5%a5%e5%af%bapm id=吉祥寺pm class=anchor aria-hidden=true>吉祥寺.pm</a></h2><p>waiwai-aiを入社2ヶ月の エンジニア3人と作るための さいきょうのアーキテクチャ<a href=https://speakerdeck.com/naoyafurudono/waiwai-aiworu-she-2keyue-no-ensinia3ren-tozuo-rutameno-saikiyounoakitekutiya>（スライド）</a>では、昨年5月に新卒研修の一環（自分はメンター）で参加したお産合宿について話しました。</p><p>逆コンウェイの話をツイッターで指摘していただいたり、ブログで記事を参照していただいたりと反応を頂けて嬉しいです。</p><p>お産合宿は業務での開発が佳境な時期に参加しており、直前まで本当に参加できるかも怪しかったことを思い出します。翌日のBuriKaigiでwaiwai-aiを発展させたデモを3人の新卒エンジニアのうちの一人がしており、意外と長生きだなと思います。</p><h2><a href=#burikaigi id=burikaigi class=anchor aria-hidden=true>BuriKaigi</a></h2><p>CLIツール開発をProtocol Buffers スキーマで駆動する<a href=https://speakerdeck.com/naoyafurudono/cliturukai-fa-woprotocol-buffers-sukimadequ-dong-suru>（スライド）</a>ではHow to Design Programsを引用して、上手なプログラミングはどのように行うものであるかを主張しました。そこでは関数を実装するための上手いやり方を主張しており、それをWeb API開発やCLI開発に応用する（より大きな粒度のエンジニアリングに適用する）ために、具体的に何をすれば良いのかや、どのような障壁がありそれらはどう取り除けるのかを主張しました。</p><p>スキーマ駆動のこととCLIについての話をすることだけ先に決めており、How to Design Programsやそのアイデアを引用すると良いことに発表直前の月曜日に気がついたため準備が忙しかったです。今回の最大の収穫はその気づきを得たことだと考えています。学生の頃に取り入れた知見がまさかこんな形で役に立っていたとは思わずすっきりした気持ちになりました。</p><p>セッション直後に余った時間で2,3名の方から質問を頂けた（しかも芯を喰っていた！）し、ツイッターやブログでも感想をいただけたので主張は伝わったのだろうと感じています。嬉しい。</p><p>鰤しゃぶを初めて食べたのですがとてもおいしかったです。また食べたい。</p><h2><a href=#%e8%a3%8f%e3%83%86%e3%83%bc%e3%83%9e-%e4%b8%8a%e6%89%8b%e3%81%ab%e7%99%ba%e8%a1%a8%e6%ba%96%e5%82%99%e3%81%99%e3%82%8b id=裏テーマ-上手に発表準備する class=anchor aria-hidden=true>裏テーマ: 上手に発表準備する</a></h2><p>また今回は資料作りについて裏テーマを二つ設けていて、それらがうまくいったのも嬉しかったポイント。</p><ol><li>スライドデッキの構成を決めてからスライドをつくる。スライド作成での手戻りを極力減らす</li><li>図を上手につくる</li></ol><p>発表の準備に時間がかかること、疲れることがこれまでの課題だった。考えることに時間と体力を使いたい、思考の速度で準備したいのがモチベーション。今まではスライドデッキを作ってから「この主張をここでしてもしょうがないな」とか「この図はいらないな」が多少あった。それらを排除して不要なスライドを作成するのに労力を割かないようにするのが1個目の目標。</p><p>CfPがあるタイプのセッションだったので、発表内容が完成する前にタイトルとセッションの内容を決める必要があったのが効いたと思う。考えているうちにそれが本題ではなくなってしまったのだが、うまく話を構成するためにだいぶ主張と構成を練ることに繋がった。あと、時間が本当になかったのと完成度に対する欲求があったので、この目標を達成することが満足のいく発表をするための必要条件でもあったのだ。切羽詰まった結果実現できたパターンでもあったということ。</p><p>Google Slideの作図機能はそこまでリッチなわけではないし、どんなに頑張っても限界がある、表現力もそんなにという具合で、サクッと数分で準備をするには良いが気合いを入れるときに使うものではないと感じていた。出来上がる図も綺麗でもなければ図自体がわかりやすくなることはなかったと思う。全体的にいい感じに仕上げることは何度かできたけど。</p><p><a href=https://www.drawio.com/>draw.io</a>を試しもしたが、字が小さいとか矢印の扱いが難しいとかでしっくりきておらず他のツールをなんとなく探していたのだった。そんな中、発表直前の木曜日に自席に遊びにきていたデザイナの同僚から紹介された<a href=https://www.figma.com/ja-jp/figjam/>FigJam</a>がいい感じ。初めて紙で書くより上手に図を書けている。矢印が本当にいい感じになるし色んな微調整もしやすい。</p><p>学生の頃はこのあたりのテクニックなしで、発表の数日前からギリギリの顔をして資料作成にフルコミットすることで乗り越えていたが、今回は日中は仕事をしつつ準備を終えることができた。成長。</p></p></div><div class=post-footer><time>February 7, 2025</time></div></article><article><h2><a href=https://blog.nfurudono.com/daily/2025-01-26/>2025-01-26</a></h2><div><p><h2><a href=#etchosts-%e3%81%a7%e3%83%84%e3%82%a4%e3%83%83%e3%82%bf%e3%83%bc%e3%82%92%e5%b0%81%e5%8d%b0 id=etchosts-でツイッターを封印 class=anchor aria-hidden=true>/etc/hosts でツイッターを封印</a></h2><p><code>/etc/hosts</code> で以下のようにしてツイッターを封印している。</p><pre><code>127.0.0.1     twitter.com
127.0.0.1     x.com
</code></pre><p>次の週末にある登壇資料を作っている。インターネットにある情報を拾う必要のあるケースもあるので、インターネットには繋がりたいが、ツイッターを開いた瞬間に全てが終わる。そんなぼくをがツイッターに吸い込まれるのを防ぐために、DNS問い合わせを潰している。だいぶ助けられている。</p><h2><a href=#%e7%99%ba%e8%a1%a8%e6%ba%96%e5%82%99 id=発表準備 class=anchor aria-hidden=true>発表準備</a></h2><p><a href=https://www.graco.c.u-tokyo.ac.jp/labs/morihata/presentation_memo.htm#o-enumerate>https://www.graco.c.u-tokyo.ac.jp/labs/morihata/presentation_memo.htm#o-enumerate</a> これを読みながらやっている。学生の頃からチラチラ見ていたが、だんだん染み付いてきた。</p></p></div><div class=post-footer><time>January 26, 2025</time></div></article><article><h2><a href=https://blog.nfurudono.com/posts/go-time-format/>Goの時刻をフォーマットするときに見るページ</a></h2><div><p><pre><code class=language-go>	DateTime   = &quot;2006-01-02 15:04:05&quot;
</code></pre><p><a href=https://pkg.go.dev/time#pkg-constants>https://pkg.go.dev/time#pkg-constants</a></p></p></div><div class=post-footer><time>January 20, 2025</time></div></article><article><h2><a href=https://blog.nfurudono.com/daily/2025-01-17/>2025-01-17</a></h2><div><p><ul><li><input disabled type=checkbox> <a href=https://google.aip.dev/>API Improvement Proposals</a>を全部読む</li></ul></p></div><div class=post-footer><time>January 17, 2025</time></div></article><article><h2><a href=https://blog.nfurudono.com/daily/2025-01-16/>2025-01-16</a></h2><div><p><h2><a href=#%e3%82%bd%e3%83%95%e3%83%88%e3%82%a6%e3%82%a7%e3%82%a2%e3%81%ae%e8%a8%ad%e8%a8%88 id=ソフトウェアの設計 class=anchor aria-hidden=true>ソフトウェアの設計</a></h2><p>今日はたくさん設計をしたので満足。</p><p>今週は電車で<a href=https://amzn.asia/d/7BGeiUR>A Philosophy of Software Design</a>を読んでいる。
2023年3月8日にAmazonで注文したらしいので、入社前の時期に現実逃避で読んだのだろう。当時はあまりプログラミングをしたり、ずっと動き続けるシステムを設計したりする経験がなかった。なので実感を伴った教訓とは思えず、知識としてさらう感じだった。それはそれで良かったし生きてきたのだけど。
2024年の年初に配属されてソフトウェアをいろんな人と長く作ってきたことでいろんな辛みを体感できた。なので今読むアドバイスは経験を思い出しながら読む観点でも面白いし、まさに今考えていることへの一つの意見としても面白い。</p><p>だんだん意見を通すのが簡単になってきたので、自分が思う良いことを主張して取り入れて、楽しいプログラミングを布教しようと思う。</p><p>そして当時に比べてペーパーバックの値段が1.5倍になっていて驚き。</p><p>コードレビューとか設計レビューで直感的によくなさそう、こうしたい、と思うケースはもしかしたらこの本から得た知見なのかもしれないと読み返していて思う。</p><p>何かの魔法で一緒に働くエンジニアが熱中して僕の選んだ本を一冊読んでくれるなら、これを読んでほしい。</p><h2><a href=#%e6%b0%97%e3%81%ab%e3%81%aa%e3%82%8b%e6%9c%ac id=気になる本 class=anchor aria-hidden=true>気になる本</a></h2><p><a href=https://www.diamond.co.jp/book/9784478117620.html>いい音がする文章</a>が気になる。僕の小説の好みは文体に左右されると感じているので。なので作者が好きなら大体のその人の作品が好き、みたいなことがよくある。</p></p></div><div class=post-footer><time>January 16, 2025</time></div></article><article><h2><a href=https://blog.nfurudono.com/daily/2025-01-13/>2025-01-13</a></h2><div><p><h2><a href=#%e3%83%93%e3%83%bc%e3%83%ab%e5%b7%a5%e5%a0%b4%e8%a6%8b%e5%ad%a6 id=ビール工場見学 class=anchor aria-hidden=true>ビール工場見学</a></h2><p>昨日は友達とキリンビール工場に行ってきた。500円のツアーがあってビール作りの概要を教えてもらいつつビールを飲ませてもらえる。だいぶ楽しかった。あの体験は優しさで成立していると思う。</p><p>原料となる麦やホップを食べさせてもらえたほか、ビール製造の中間生成物である麦汁の飲み比べをさせてもらえた。何より説明してくれるお姉さんがビール好きで、1つ質問すると厳選した3つを返してくれるのが良かった。一緒に飲んで欲しい。飲ませてもらったビールもめちゃくちゃおいしいし。併設されているレストランに行けていない（リサーチ不足でご飯を食べてから行ってしまった）のと、他にも見学コースがあるみたいなのでまた行きたい。</p><p>ホップを使ったリンスを買って使ってみたら、髪からフルーティ系なビールの匂いがして最高。</p><h2><a href=#ai%e3%81%a8%e8%81%b7%e6%a5%ad%e3%82%bd%e3%83%95%e3%83%88%e3%82%a6%e3%82%a7%e3%82%a2%e3%82%a8%e3%83%b3%e3%82%b8%e3%83%8b%e3%82%a2%e3%83%aa%e3%83%b3%e3%82%b0 id=aiと職業ソフトウェアエンジニアリング class=anchor aria-hidden=true>AIと職業ソフトウェアエンジニアリング</a></h2><p>AIに仕事を奪われることはないだろう。とはいえ単に作業をするだけの労働はAIに奪われる。コードを単に書くのは作業であって、仕様からコードを生み出すだけならAIでやった方が早いし（今の相場なら）安いから。</p><p>とはいえそんな単純作業が仕事であることはなくて、将来のこととか仕様の考慮に入っていなかったことをコードを書きながら調整して主体として責任を持って成果を出すことは、社会がまだAIに対して認めていないように感じる。</p><p>誰もが優秀な部下を持つようになったが、人々は誰かに責任を持った主張をして欲しくいのだろう。ポジションをとって主張をし、ダメだったときは失落したり挽回することを人格に求めている。信頼をして仕事を任せる相手は人間じゃないと嫌だと社会が思っている。</p><h3><a href=#%e4%ba%ba%e9%96%93%e3%81%8b%e3%82%89%e3%81%ae%e5%bd%b9%e5%89%b2%e6%9c%9f%e5%be%85%e3%81%8c%e7%94%9f%e6%88%90ai%e3%82%92%e5%be%8b%e9%80%9f%e3%81%99%e3%82%8b id=人間からの役割期待が生成aiを律速する class=anchor aria-hidden=true>人間からの役割期待が生成AIを律速する</a></h3><p>そういうわけで人間は労働力としての生成AIを手に入れただけであって、人間社会で主体として認められたあらたな人格を手に入れたわけではない（今のところは）。成果を出すためには社会が理解できるポジションを取ることが必要で、そのロールモデルの振る舞いとして社会と交流しないといけない。どんな振る舞いをするのが良いか決めるために生成AIを駆使する仕事の仕方が増えるだろう。ロールモデルには矛盾なくとりうるアトミックな行動があって（思想とか哲学みたいなもの）、それを組み合わせることでその人らしい振る舞いが形成される。思想とか哲学とかに一貫性がないと社会から信頼してもらえない。一方で外部から同じ要求がなん度もくることはないため、それに応じた異なる振る舞いをする必要はある。思想や哲学から外部刺激に対して振る舞うことにはエネルギーとか思考とかが必要で面倒だから生成AIを使うと便利だろう。</p><p>これはプログラミングにも応用できる。アプリケーションのコアなロジックのインターフェースは綺麗に設計されてクライアントから受け入れてもらう必要がある。そこがブレると利用するのがそもそも大変だし、見出した価値がすぐに失われてしまうだろう。一方で、それを活用して振る舞いを追加したり修正することは生成AIがこなすだけで十分なのではないだろうか。振る舞いを追加することは、そのアプリケーションのコアな部分のインターフェースと世の中によく知られた技術要素のインターフェースを組み合わせて表現できるだろう。</p><h3><a href=#%e5%bd%b9%e5%89%b2%e6%9c%9f%e5%be%85%e3%81%ae%e5%a4%89%e5%8c%96%e3%81%ab%e3%81%af%e3%82%af%e3%83%a9%e3%82%a4%e3%82%a2%e3%83%b3%e3%83%88%e3%81%ae%e5%a4%89%e5%8c%96%e3%81%8c%e5%bf%85%e8%a6%81 id=役割期待の変化にはクライアントの変化が必要 class=anchor aria-hidden=true>役割期待の変化にはクライアントの変化が必要</a></h3><p>外部からの要求に応答して振る舞いをしたりインターフェースを利用して新たな機能を提供する際に、コアな思想を見直してアップデートすることもあるだろう。とっているポジションをちょっと変えるということ。使う側からすると理解の仕方をちょっと変えないといけないのでこの変更が気に食わなかったり理解できなかったりすると嫌な感じがする。変化の速度が早すぎて理解が追いつかないとたとえ良い変化であったとしてもアンチになってしまい信頼をなくすことに繋がる。そのため人間に直接理解されるインターフェースは人間に合わせた進化をしないと社会に適合できなず、市民権を失う。</p><p>したがって生成AIはインターフェースを提供するソフトウェアエンジニアの職業を奪うことはない。一方でインターフェース設計に関与しない、定義されたインターフェースの中だけで作業をして、他人と相互作用をするインターフェースを定義しないエンジニアリングは生成AIのコストに負けて自動化されるだろう。</p><h3><a href=#%e5%bd%b9%e5%89%b2%e3%81%ae%e8%a8%ad%e8%a8%88%e3%81%af%e5%ae%89%e5%ae%9a%e3%81%97%e3%81%a6%e3%81%84%e3%82%8b%e3%81%a8%e6%80%9d%e3%81%86 id=役割の設計は安定していると思う class=anchor aria-hidden=true>役割の設計は安定していると思う</a></h3><p>次に、他人と相互作用するインターフェースのあり方が変化するかが問題になる。これまで公開されて使われていたようなインターフェースは今後も必要だろうか。インターフェースを解釈するのが生成AIだけになれば、その変化が早くても理解が追いつくためわざわざポジションをとったり人間の理解速度に変化の速度に合わせる必要がなくなる。これは作り上げるものの抽象度の違いに依存するだろう。何かを作り上げたかったらその一段下の抽象度の言葉で構成を説明してほしい。妥当性を検証するために。そこから下は信じることにして（信じられる何らかの根拠を持つことになる、ここも何か困難があるかも、今は著名なOSSだからokとか言って信用することにしている）、欲しいものの一段下のレイヤで自分で納得がいけば良いものであると判断する。</p><p>そして、人間の思考とか議論のレイヤは高々10とかにおさまっており、それが生成AIの登場で変わるとも思わない。なのでインターフェースを人間が作ってポジションをとる必要性も今後変わらないと思う。根拠はなくて直感だし、多分僕の願望も入っっている。</p><h3><a href=#%e7%8e%8b%e9%81%93%e3%81%ae%e5%bd%b9%e5%89%b2%e3%81%af%e3%81%95%e3%82%89%e3%81%ab%e5%af%a1%e5%8d%a0%e3%81%95%e3%82%8c%e3%82%8b id=王道の役割はさらに寡占される class=anchor aria-hidden=true>王道の役割はさらに寡占される</a></h3><p>良いインターフェースを定めるために、鍛錬を積む必要はあり、それは生成AIによって取って代わられる仕事でなされることが多い。生成AIを使って仕事をやる先端のインターフェース提供者と、そこから学べない後進が場所によっては生成AIがやる仕事をするローカライズされたインターフェースの提供者が並行して存在する世界になるだろう（生成AIに限らずこの状況はあるだろうが）。</p></p></div><div class=post-footer><time>January 13, 2025</time></div></article><article><h2><a href=https://blog.nfurudono.com/posts/learn-frontend-test/>wip Next.jsでのテストを自由自在に書けるようになりたい</a></h2><div><p><p>Next.jsのアプリケーションでテストを自由自在に書けるようになることが目的。</p><p>vitestを用いる。アサーションには<code>expect</code>などを使ってマッチャを指定する。
expectや使えるマッチャは<a href=https://vitest.dev/api/expect>https://vitest.dev/api/expect</a>が詳しい。</p><ul><li>テスト戦略の類型とトレードオフの把握</li><li>ユーザインタラクションの再現</li></ul></p></div><div class=post-footer><time>January 11, 2025</time></div></article><article><h2><a href=https://blog.nfurudono.com/daily/2025-01-11/>2025-01-11</a></h2><div><p><h2><a href=#wishes id=wishes class=anchor aria-hidden=true>wishes</a></h2><ul><li><input disabled type=checkbox> 日記管理CLIからhugo依存を抜きたい。Hugoはもう使わないので単にインストールの必要があり面倒になっている。テンプレファイルが好みじゃないのもある<ul><li>tools/daily を拡張する。名前も変えてフルリプレイスでも良い。仕様を決めよう。</li></ul></li><li><input checked disabled type=checkbox> ZedのAIと仲良くする機能を把握したい<ul><li>した。便利。日記全部読ませるとめちゃくちゃ面白い。</li></ul></li><li><input disabled type=checkbox> Zedにコントリビュートできるようになっておきたい<ul><li>お作法</li><li>アーキテクチャの把握</li><li>プログラミング能力</li></ul></li><li><input checked disabled type=checkbox> CLIたくさん作りたい。ただプログラミングしたい<ul><li>ちょっと作って満足した</li></ul></li><li><input disabled type=checkbox> フロントエンドのテストを完全に理解する<ul><li><a href=https://dev.nfurudono.com/posts/learn-frontend-test>https://dev.nfurudono.com/posts/learn-frontend-test</a> でやる</li></ul></li><li><input disabled type=checkbox> 構文、意味、契約みたいな学生の頃は一般的だと思っていたけど世の中ではそうじゃなさそうな概念を説明して、みんなに抑えてもれえるように主張する</li><li><input checked disabled type=checkbox> 掃除する。部屋がめちゃくちゃ汚いので</li><li><input checked disabled type=checkbox> ルンバのメンテナンスをする。なぜか秒でダスト容器がいっぱいになったと判定される<ul><li>ダスト容器のセンサーがあってそこを綺麗にしたので多分解決する。フィルタを水洗いしちゃったのでそれを乾かしてから動かしてみる</li><li>初めてだったゴミを集める周辺は簡単に分解できた</li></ul></li></ul><h2><a href=#ai%e3%82%92%e4%bd%bf%e3%81%a3%e3%81%9f%e3%82%b3%e3%83%bc%e3%83%87%e3%82%a3%e3%83%b3%e3%82%b0%e3%82%92%e8%a6%8b%e3%82%8b%e7%9b%ae%e3%81%8c%e5%a4%89%e3%82%8f%e3%81%a3%e3%81%9f id=aiを使ったコーディングを見る目が変わった class=anchor aria-hidden=true>aiを使ったコーディングを見る目が変わった</a></h2><p>Zedの機能を把握したことでAIを使ったコーディング能力が上がった。全体的なリファクタリングを受け入れるのはきついので、ロバストなコンポーネントを作り上げる必要がある。それらを全て把握して、気合いで組み立てる体験が最高。モデリング・抽象化・契約が効いてくるのではないだろうか。</p><p><a href=https://zed.dev/blog/zed-ai>https://zed.dev/blog/zed-ai</a> これが読み途中。</p></p></div><div class=post-footer><time>January 11, 2025</time></div></article><article><h2><a href=https://blog.nfurudono.com/posts/go-errors-stacktrace/>漏れなくスタックトレースをGoで取りたい！</a></h2><div><p><p><a href=https://github.com/k1LoW/errors>k1LoW/errors</a> でスタックトレースをエラーにつけられるようになる。便利なのだがトレースをプログラマが明示的に指示しないといけない。設定をコードベースで一回やれば終わりではなく、エラーの発生源で書かないといけない点が気になっている。書くこと自体は許容しているが、漏れがないように人間が頑張るのは許容したくない。漏れをなくすための仕組みを主張する。</p><h2><a href=#k1lowerrors%e3%81%ae%e8%aa%ac%e6%98%8e id=k1lowerrorsの説明 class=anchor aria-hidden=true>k1LoW/errorsの説明</a></h2><p>ライブラリとして使うためにはreadmeの説明で十分だと思うが、議論のためにここでも説明する。以下のように用いる。</p><p><a href=https://go.dev/play/p/Cwp4n-vZONv>https://go.dev/play/p/Cwp4n-vZONv</a></p><pre><code class=language-go>package main

import (
	&quot;encoding/json&quot;

	&quot;github.com/k1LoW/errors&quot;
)

func f() error {
	// このようにWithStackを呼び出した箇所でのスタックトレースがerrorオブジェクトに記録される
	return errors.WithStack(errors.New(&quot;ouch!&quot;)) // ここは11行目
}

func main() {
	err := f()
	// スタックトレースを含んだエラー内容をフォーマットする
	s := errors.StackTraces(err)
	b, _ := json.Marshal(s)
	println(string(b))
}
</code></pre><p>実行すると以下のような出力が得られる。見やすさのために jq にかませてフォーマットした。</p><pre><code class=language-json>[
  {
    &quot;error&quot;: &quot;ouch!&quot;,
    &quot;frames&quot;: [
      {
        &quot;name&quot;: &quot;main.f&quot;,
        &quot;file&quot;: &quot;/tmp/sandbox123757503/prog.go&quot;,
        &quot;line&quot;: 11
      },
      {
        &quot;name&quot;: &quot;main.main&quot;,
        &quot;file&quot;: &quot;/tmp/sandbox123757503/prog.go&quot;,
        &quot;line&quot;: 15
      },
      {
        &quot;name&quot;: &quot;runtime.main&quot;,
        &quot;file&quot;: &quot;/usr/local/go-faketime/src/runtime/proc.go&quot;,
        &quot;line&quot;: 272
      },
      {
        &quot;name&quot;: &quot;runtime.goexit&quot;,
        &quot;file&quot;: &quot;/usr/local/go-faketime/src/runtime/asm_amd64.s&quot;,
        &quot;line&quot;: 1700
      }
    ]
  }
]
</code></pre><p>スタックトレースの先頭 (frames配列の先頭要素) はWithStackを呼び出した位置を指す。</p><p>したがって、アプリケーションの中でのエラーの発生源をスタックトレースから漏れなく特定するためには、<strong>エラーの発生源の全てでWithStackを呼び出す必要がある</strong>。</p><p>なお、WithStackを重ねて呼び出しても問題ようになっている（深いスタックトレースを持つものが生き残るようになっているし、他のも気遣いがされている）。</p><h2><a href=#%e8%83%8c%e6%99%af%e6%97%a2%e5%ad%98%e3%81%ae%e3%82%a2%e3%82%a4%e3%83%87%e3%82%a2 id=背景既存のアイデア class=anchor aria-hidden=true>背景・既存のアイデア</a></h2><p><a href=https://k1low.hatenablog.com/entry/2024/08/13/083000>名前付き返り値とdeferを使って忘れないようにする手法も紹介されている</a>。</p><pre><code class=language-go>func f() (err error) {
	defer (func(){
		err = errors.WithStack(err)
	})()
	b := strings.Builder{}
	_, err := b.Write([]byte(&quot;hello&quot;))
	if err != nil {
		return err
	}
	// ...
}
</code></pre><p>ある程度楽をできるし、この後の議論をした上でもバランスの良い選択肢だと思うが課題も感じている。その課題と解決案を以降で議論する。</p><h2><a href=#%e8%aa%b2%e9%a1%8c id=課題 class=anchor aria-hidden=true>課題</a></h2><ol><li>deferを書くのを忘れそう<ul><li>こちらはリンターでなんとかなるだろう。ここでは深く議論しない</li></ul></li><li>deferの中でerrors.WithStackを呼ぶと、エラーの発生源から離れるため、具体的にどのreturn errで落ちたかがスタックトレースから追えない<ul><li>エラーメッセージから判断できる可能性は大きいけど</li></ul></li></ol><p>二つ目の課題の例を以下に挙げる。fではどの行で落ちたか分からないが、gではどちらのwithStackで生成したかが残る。</p><pre><code class=language-go>func f() (err error) {
	defer (func() {
		err = errors.WithStack(err)
	})()
	if err := ok(); err != nil {
		return err
	}
	if err := ng(); err != nil {
		return err
	}
	return nil
}

func g() (err error) {
	if err := ok(); err != nil {
		return errors.WithStack(err)
	}
	if err := ng(); err != nil {
		return errors.WithStack(err)
	}
	return nil
}

func ok() error { return nil }
func ng() error { return errA }
var errA = errors.New(&quot;this is error&quot;)
</code></pre><p><a href=https://go.dev/play/p/SGr1B4sDF9I>https://go.dev/play/p/SGr1B4sDF9I</a> で動かせる。</p><h2><a href=#%e8%a7%a3%e6%b1%ba%e6%a1%88-%e5%9e%8b%e3%81%a7%e9%a0%91%e5%bc%b5%e3%82%8b id=解決案-型で頑張る class=anchor aria-hidden=true>解決案: 型で頑張る</a></h2><p>k1low/errorsでは、errors.WithStackは<code>func(error) error</code> 型を持つ。それを <code>func(error) errors.T</code> とする。ここでTは以下のようなerrorをStackTraceメソッドで拡張したようなインターフェース。</p><pre><code class=language-go>package errors

type T interface {
	error
	StackTraces() stackTraces // 戻り値型には議論の余地があるが、ここでは重要ではない。
}

// 唯一のT型のコンストラクタ
func WithStack(err error) T { ... }
</code></pre><p>スタックトレースを取りたいアプリケーションでは、すべての関数定義で返すエラー型を標準の errorではなく errors.Tとする。そうすると、すべてのreturnされるエラーオブジェクトからスタックトレースを取得できることが保証される。</p><p>以下の二点が嬉しい。</p><ol><li>errors.Tを返す関数しか呼ばない関数は繰り返しerrors.WithStackを呼ぶ必要がなくなる</li><li>errors.WithStackをエラーが発生するたびに (deferの中ではない！) 呼び出すように保証できるので、スタックトレースがちゃんと深くなる</li></ol><p>この方法の問題は以下。人によっては許容できるだろう（ぼくはありだと思っている）。</p><ol><li>すべての関数定義で返すエラー型をerrors.Tに統一する方法が定まっていないこと</li><li>errors.WithStackをたくさん呼ばないといけないこと</li><li>独自のエラーインターフェースを定義していて気持ち悪いこと</li></ol><p>一つ目はリンターを書けば良い。error型を返す関数を定義したら怒るだけなので簡単。deferでちゃんと書くことを保証するよりも難易度は低いはず。</p><p>二つ目は諦めるしかない。生成AIに頑張ってもらいたい。手書きするのは嫌だけど、補完があるならギリギリ許容できる気持ちがある。</p><p>三つは対処を思いつかない。これも諦めて受け入れるしかないだろう。標準のエラーとは別物として扱おうとしているのだから型は真っ当に手法を表現している。解決手法がGoぽくないのだろう。</p><h2><a href=#%e7%b5%90%e8%ab%96 id=結論 class=anchor aria-hidden=true>結論</a></h2><ul><li>deferを使う手法ではスタックトレースがちょっと足りない<ul><li>とはいえエラーメッセージが適切に設定されていれば問題ではない</li><li>込み入ったこともしないでいいし簡単</li></ul></li><li>とはいえ設定もれが怖い気持ちや、スタックトレースをもう一段深く取りたい気持ちもある<ul><li>そのときは今回提案した型で頑張る手法をとれば良いと思う</li></ul></li></ul></p></div><div class=post-footer><time>January 8, 2025</time></div></article><article><h2><a href=https://blog.nfurudono.com/daily/2025-01-04/>2025-01-04</a></h2><div><p><h2><a href=#rust%e3%81%ae%e3%82%8f%e3%81%8b%e3%82%89%e3%82%93%e3%83%9d%e3%82%a4%e3%83%b3%e3%83%88 id=rustのわからんポイント class=anchor aria-hidden=true>Rustのわからんポイント</a></h2><p>過去に何個か一人でCLIツールを作ったことがある。そのときに雰囲気で乗り越えてしまいストレスの少ない綺麗な書き方を知りたかった概念をあげる。</p><ul><li>エラーハンドリング</li><li>参照周りの型変換<ul><li>特にパターンマッチやforループ、関数定義で <code>&</code> 記号を書く構文特有の意味があるときがよくわからない</li></ul></li><li>ライフタイム<ul><li>実用的に我々はどんな塩梅で書くのが良いかとか、誰が所有するのが良いかを判断するためのベストプラクティスを持っていない</li></ul></li><li>トレイトの勘所<ul><li>ユーザ定義型に機能を実装するときに、どういうインターフェースを持たせるか迷う。どのようなトレイトを実装するかを決められない。クライアントとしての標準を知らないのでサーバとして何を提供するか、常識をもとに判断できない</li></ul></li></ul><h2><a href=#%e6%b7%b1%e5%a4%9c%e3%81%abai%e3%81%ab%e4%bb%95%e4%ba%8b%e3%82%92%e3%81%a9%e3%82%8c%e3%81%8f%e3%82%89%e3%81%84%e5%a5%aa%e3%82%8f%e3%82%8c%e3%82%8b%e3%81%8b%e8%80%83%e3%81%88%e3%81%9f%e3%81%a8%e3%81%8d%e3%81%ae%e3%83%a1%e3%83%a2 id=深夜にaiに仕事をどれくらい奪われるか考えたときのメモ class=anchor aria-hidden=true>深夜にAIに仕事をどれくらい奪われるか考えたときのメモ</a></h2><p>要件を定めてそれを保証する仕事がソフトウェアエンジニアの仕事になるだろう。それだと単発の仕事か。進み方を把握して、それを促進する作りにする必要はあるはず。</p><p>プログラムの開発（状態や環境に反応するソフトウェアの開発）自体は生成AIによって簡単になった。要求や要件を実現することしかまだ生成AIのブラックボックスに入れられていない。要求や要件の整理の道具として生成AIを利用してはいるが、</p><p>これからは生成したプログラムに対して保証された機能の制限が大事になってくるだろう。プロダクション環境で動くプログラムを見る人間は減り、その代わりにソフトウェア検証、パーミッションの制限で安全性を保証したり、デモで振る舞いを確認する未来がくるだろう。ソフトウェアを実装するコストが低くなり、つまりソースコードに向き合う機会が減り、コードの振る舞いを静的に理解しなくなっていく。あるいは言語を高級にするだろうか。言語にどんな性質があると幸せ？</p><p>生成して良い言語に良い性質を持たせることはありそうなアプローチ。</p><h2><a href=#%e7%b6%9a%e3%81%8d id=続き class=anchor aria-hidden=true>続き</a></h2><p>仕事は確かにたくさん奪われそうだけど、契約をデザインして（うまくそれを表現することを含む！）プログラムを作り上げる営みは楽しいからずっと続けると思う。</p></p></div><div class=post-footer><time>January 4, 2025</time></div></article><article><h2><a href=https://blog.nfurudono.com/daily/2025-01-03/>2025-01-03</a></h2><div><p><h2><a href=#go%e3%81%a7%e3%82%a8%e3%83%a9%e3%83%bc%e3%81%ab%e3%82%b9%e3%82%bf%e3%83%83%e3%82%af%e3%83%88%e3%83%ac%e3%83%bc%e3%82%b9%e5%85%a5%e3%82%8c%e3%82%8b%e8%a9%b1 id=goでエラーにスタックトレース入れる話 class=anchor aria-hidden=true>Goでエラーにスタックトレース入れる話</a></h2><p><a href=https://dev.nfurudono.com/posts/go-errors-stacktrace>https://dev.nfurudono.com/posts/go-errors-stacktrace</a> に移転しました。</p><h2><a href=#%e6%8e%83%e9%99%a4 id=掃除 class=anchor aria-hidden=true>掃除</a></h2><p>大掃除は年末にしたのだけど、コーヒーグラインダーを掃除し忘れていたのでやった。結構な量の粉が中から出てきて驚いた。豆を砕く場所と粉が出てくる穴の間に傾斜した通路があってそこに溜まっていた。</p><h2><a href=#%e6%96%99%e7%90%86 id=料理 class=anchor aria-hidden=true>料理</a></h2><p>今日も餃子を作った。昨日たねを作りすぎたので。ちょうど買い足した餃子の皮を消費できた。蒸しと焼きの両方やって昨日と同じ感想だった。たねを作るときに白菜の水分を抜く工程を入れていたが次回は外してみようと思う。</p><p>明日は鮭のホイル焼きをしようと思う。衛宮さんちの今日のご飯に感化された。</p><ul><li>鮭・玉ねぎ・にんじん・しめじを適切に処理する<ul><li>鮭には酒と塩を振って5-10min放置してから拭き取る</li><li>その後酒に塩胡椒を振る</li></ul></li><li>玉ねぎ・にんじんを敷いて、その上にコンソメをかける</li><li>全てを載せつつバターも添えてホイルに包む</li><li>加熱する</li><li>パセリか何かをかけるらしい</li><li>わさびマヨがあっても良いとか</li></ul><p><del>朝は納豆とかかな。卵も食べよう。</del>
朝はサンドウィッチにする。ほうれん草、卵、ベーコンを入れたい。卵しかないので買い出しが必要。パンもない。</p></p></div><div class=post-footer><time>January 3, 2025</time></div></article><article><h2><a href=https://blog.nfurudono.com/daily/2024-12-25/>2024-12-25</a></h2><div><p><h2><a href=#%e5%a5%91%e7%b4%84%e3%83%97%e3%83%ad%e3%82%b0%e3%83%a9%e3%83%9f%e3%83%b3%e3%82%b0%e4%b9%b1%e6%96%87%e3%81%a7%e3%81%99 id=契約プログラミング乱文です class=anchor aria-hidden=true>契約プログラミング（乱文です）</a></h2><p>関数の引数はそれぞれ何で、どんな性質を期待するかや、そのほかの事前条件を満たした上でこの関数を呼び出すと、その結果としてどんな返り値が得られてそれ以外にどんな副作用があるかを表明するのが関数の契約。文章を用いるのが簡単だし、伝えやすくするには図を用いても良いし、型とかバリデーションのための式で表現しても良い。何にしても契約を表明すると楽しくプログラミングできる。</p><p>この関数の呼び出し側はどんなふうにこの関数を使って処理を実現するだろうかとか、この関数を実装するときはどんなふうに作ろうかと考えるのがまず楽しい。みんなが幸せになれる契約をデザインするのが楽しい。ソフトウェアのテストは契約を守っていることを検証することだと思う。型を用いた表現は契約の表明で、型検査が検証（それも厳密な）である。</p><p>このように良い契約をデザインするのがプログラミングでまずやることだと思う。その次に自動で検証するためのコードを書くのがTDDの人だし、関数型の怖い人は型で契約を表現しようとするかもしれない。そのためにすごい表現力を持つ型システムを考えて勉強して使う印象がある。</p><p>TDDで最初から完成版のテストを書かないことからわかるように、契約を最初から詳細まで書く必要はない。そんな契約を満たす実装を書けるだろうかと思うこともある。なので最初はふんわり「ユーザの情報を返すAPI」とか決めておいて、IDが欲しいとか、シャーディングしてるから作成日時も欲しい、みたいな事前要件を足したり、ユーザ情報全部返すのはきついし呼び出しがわも幸せじゃないから、名前とメルアドだけ返すことにする、みたいな調整も入るだろう。課金が滞っているユーザに対しては普通の結果は返さない、代わりにエラーを返す、みたいな変更も実装したり呼び出しているうちにしたくなるはず。</p><p>結局のところ普通のプログラミングをしようと言っているだけなのだが、僕が強調したいのは契約と実装を分けて考えようということ。契約が先にあってそれに実装を合わせる（合ってない状態はバグってる状態）考え方でいたいし、僕と契約を共有する人には（その共有する契約のレイヤで）いて欲しいと思う。</p><p>僕はmac osのコードがどうなっているかを気にすることはなくて、普通にパソコンが動けば満足するし、実際動いているので不満はない。キーボード叩いたら文字が出るという契約を守ってくれている。でもosのapiを叩く友達はそもそもドキュメントが公開されてなくて辛い、みたいなことを言っていた。このように、自分が関心のあるレイヤの契約が問題になるのだと思う。</p><p>契約はプログラミングの細かいレベルだと変数の名前とか、改行の置き方によって表明されるもので、大きいレベルだとサービスやロールの責務として表現されると思う。サービスのAPIは代表的な契約だと思う。APIという言葉は契約と同じような意味だと思うけど、エンドポイントみたいな意味でも使われているし責務みたいな概念には適用されないと思っていて使わない。</p><p>僕たちが欲しいものは何かを表明しよう、というのが契約を表明しようということだと言い換えられる。使う側からしたらその実現方法は関係ないし、提供する側からしたら契約さえ満たせば何をやっても良い。
getterとsetterを提供するからと言ってそういうフィールドをよく知られた方法で提供しないといけないわけではないし、バッファリングとか遅延実行をしても良い。</p><p>未定義な状況とか意図しない状況はある。今と昔では状況が変わって、その頃は妥当に思えた契約が時代に合わなくなることもある。契約がないと実装が良くないで話が終わってしまうが、契約があれば仮定が違ったのだと結論づけられる。人の記憶があればその人の心に契約があって仮定が違ったと判断できるだろう。記憶を失ったりその人が失われたりする場合は契約を表明しておくべきだろう。</p><p>型はデータ構造やその不変条件を表現したりそれらに名前をつけることで、契約を表現する。そして型を用いて表明された契約は普通型検査によって契約が満たされていることを検証する。正しい場合には正しいと判定するし、正しくない場合には正しくないと判定する。さらに、ある程度ちゃんとした型検査器は、どのように契約が満たされなかったかを説明してくれる。</p><p>テストは契約を検証するためのコードで、そのテストが契約のどんな部分を検証するか、テストケースの名前として表明される。その表明を満たすようにテストコードが実装されて、テストランナーに呼ばれる。契約のどんな側面をそれぞれのテストケースで検証するか、検証すると幸せか（誰にとって？）を決めるのはテスト実装者のスキルに依存するだろう。契約の中で脆いところを普通は検証するのだろう。明らかに正しそうなやつは手を抜いてしまえるはず。</p><p>バリデーションも契約を表現する手段の一つ。契約を検証処理として実装して表明するのがバリデーション。型と同じようにすべての実行について契約が満たされるかを検証する。一方でテストと同じように実際に動くものに対して検証を行う。</p><p>実際に動かして試すのは何だろう。契約とはあまり関係なさそう。実装したやつがどんな感じになってるか微妙なので試して動作を観察するのがとりあえず動かしてみる目的。これは脇道だったな。ただし、あまりによくわからなくなっているときは分割統治をするときだと思う。自分の手の中にある対象をコンポーネントに分割して、それぞれに対して契約をデザインする。その契約を満たすように実装しつつ、その契約を期待して組み合わせて元々の目的を達成すれば良い。わからない部分が新しい契約の内側にはいれば小さくなった簡単な契約を満たすことに問題は帰着できたし、それらの契約を組み合わせることに課題があるなら詳細を忘れて便利な道具を手に入れられたのだからやはり問題は簡単になっているはず。うまく契約を設計することが難しいなら、それは楽しいから問題ない。ずっと取り組んでいればいい。</p><p>何にしても契約を表明することが何より先にくる。これだけでプログラミングが楽しくなる。その後に型、テスト、バリデーションを書いたり実装をしたりする。</p><p>そういう考え方が how to design programsにデザインレシピとして書いてあるのでよかったら読んでみてください。</p><p>プログラミング言語はこの辺りが優秀で、型システムの研究とかで契約を表明して保証する方法を検討しているし実際に生かされている。なので言語に守られているうちは割と安心できる。あとは怠慢にならなければいいだけ。</p><p>プログラミング言語に閉じられなくなるとき、例えばWeb APIを提供するときは急に難易度が上がる。Web APIでも契約を表明して検証するためにスキーマ駆動開発がある。契約を書き下すことを支援するのはもちろん、型とかバリデーションで表明することも支援する。テストツールの支援もある。</p><p>僕たちが求めているのは以下である。</p><ul><li>契約を表明すること</li><li>契約を洗練すること</li><li>契約を犯せないようにすること</li><li>契約を犯しかけたらなるはやで誰かに教えてほしい</li><li>これらを簡単に実現できること</li></ul><p>最初のやつは設計しようぜ！という話。次が設計技法とか良い設計みたいな話。三つ目は型とかバリデーション、テストの話。次もそう。最後のやつはそれら全てを支援するエンジニアリングの話。</p><h2><a href=#%e3%83%97%e3%83%ad%e3%82%b0%e3%83%a9%e3%83%9f%e3%83%b3%e3%82%b0%e3%83%91%e3%83%a9%e3%83%80%e3%82%a4%e3%83%a0 id=プログラミングパラダイム class=anchor aria-hidden=true>プログラミングパラダイム</a></h2><p>契約の話をしたのでパラダイムの話をしたい。オブジェクト指向と普通のやつの話。どっちでもいいけど、契約を表明しやすいパラダイムが良いと思う。</p><p>オブジェクト指向な考え方だと、内部状態を持つオブジェクトがメソッドを受信してその結果内部状態を変えたり返信したりする。そういうふうに契約を表明して守っていくならオブジェクト指向を使えばいい。</p><p>関数型みたいな普通のやつは、仮定が与えられた状況で関数を呼ぶと結果を出す。そういう契約の書き方をするなら関数型みたいに書けばいい。</p><p>どちらも相互に変換可能だから力まず表現しやすい言葉遣いを使えば良いだろうと思う。</p><h2><a href=#%e6%84%9f%e6%83%b3 id=感想 class=anchor aria-hidden=true>感想</a></h2><p>割と思いの丈をダンプした。これは就職したからできたことのように思う。学生の頃に培った理想が現実世界では必ずしも簡単に実現しないことを体験できた。自明だと思っていた領域の非自明な部分に気がついて思うところが出てきた。</p><h2><a href=#%e5%a5%91%e7%b4%84%e3%82%92%e8%a8%ad%e8%a8%88%e3%81%99%e3%82%8b%e6%a5%bd%e3%81%97%e3%81%95 id=契約を設計する楽しさ class=anchor aria-hidden=true>契約を設計する楽しさ</a></h2><p>プログラミングの楽しいところは、ロールを分けてうまく契約群を設計することにあると思う。フレームワークを作るのはそういう契約の集まりを定義することだから楽しい。一方でフレームワークを使うと契約を設計する機会を奪われる分楽しくないかもしれない。</p><p>その分他のレイヤに注力すればいいのだろうが。</p><p>自分が自由に設計したいレイヤで他人に契約を決められるとストレスだろう。本当につまらない。反対に自分が関心なくて誰かにうまくやって欲しいときには良い契約を強い人に決めて欲しいと思う。そういうレイヤを担当するフレームワークを使って欲しいし、技術を選定したい。</p><p>アーキテクチャ設計についても言及できそう。アーキテクチャは中長期的には変遷するものだが、短期的には変わらない。アーキテクチャに乗っかってここのコンポーネントを作り込む。ここのコンポーネントをストレスなく作り込みやすくするアーキテクチャが良いアーキテクチャなのだろう。</p></p></div><div class=post-footer><time>December 25, 2024</time></div></article><article><h2><a href=https://blog.nfurudono.com/daily/2024-12-15/>2024-12-15</a></h2><div><p><h2><a href=#filter%e3%81%abasync%e3%82%92%e6%b8%a1%e3%81%97%e3%81%a6%e3%81%af%e3%81%84%e3%81%91%e3%81%aa%e3%81%84 id=filterにasyncを渡してはいけない class=anchor aria-hidden=true>filterにasyncを渡してはいけない</a></h2><p>日記はマークダウンで書いていて、タイトルとか公開・非公開とかはフロントマターに書いている。それをパースしてよしなに処理してHTMLに落としたり、そもそも公開しないようにしている。それらの処理はTSで書いている。</p><p>ちょっと前にリファクタしたときにテストを書くのをサボったせいで公開・非公開の設定が反映されなくなっていた。コードベースは公開リポジトリに置いているのでクリティカルな問題ではないのだけど、望んだ挙動ではないので普通に嫌だった。</p><p>事故の原因は非公開な記事を処理対象から落とすfilterにasync関数を渡したことだった。async関数はpromiseを返すので、どんな処理を書こうがfilterは何もしないmapと同じ振る舞いをしていた、というオチ。
biomeを入れてたので弾いて欲しい気持ちがある（気が付かなかった僕が悪くはあるのだけど）。</p><p>mapにasync関数を渡して記事一覧を加工していたので、そのままのノリで放り込んだのが敗因。promise.Allした後の配列に対してfilterすることで修正した。</p><h2><a href=#rss%e3%81%ab%e5%af%be%e5%bf%9c%e3%81%99%e3%82%8b id=rssに対応する class=anchor aria-hidden=true>RSSに対応する？</a></h2><p>そういえばサイトマップとかRSSフィードとかに全く対応していなかった。自分がそもそも使わないのと、この日記を積極的に人に読ませようという気がないのが理由。じゃあいいか。ちゃんとしたブログエンジンを作りたいわけでもないし</p></p></div><div class=post-footer><time>December 15, 2024</time></div></article><article><h2><a href=https://blog.nfurudono.com/daily/2024-12-13/>2024-12-13</a></h2><div><p><ul><li><input disabled type=checkbox> kamakura.goの感想とかを書く</li></ul></p></div><div class=post-footer><time>December 13, 2024</time></div></article><article><h2><a href=https://blog.nfurudono.com/daily/2024-12-12/>2024-12-12</a></h2><div><p><blockquote><p>We recommend that all third-party code generators be written as plugins, as this allows all generators to provide a consistent interface and share a single parser implementation.</p></blockquote><p><a href=https://protobuf.dev/reference/other/#plugins>https://protobuf.dev/reference/other/#plugins</a></p><p>はえ〜って感じ。Goのライブラリはだいぶ使い勝手良かったのでまあ確かにと思ってる。</p></p></div><div class=post-footer><time>December 12, 2024</time></div></article><article><h2><a href=https://blog.nfurudono.com/daily/2024-12-05/>2024-12-05</a></h2><div><p><p>viperってinit使わないといけないのかな。
viperに依存性を注入するような使い方をしたい。Facadeを受け取ってCLIを返すようなCLIジェネレータを定義しようとしていて、CLIジェネレータを実装するためにviperの諸々をinitとかで終えようと思うと困る。実行時にfacadeを入れたいので。</p></p></div><div class=post-footer><time>December 5, 2024</time></div></article><article><h2><a href=https://blog.nfurudono.com/daily/2024-11-28/>2024-11-28</a></h2><div><p><p>Reactのカスタムフックの心をわかっていなかったけど、クロージャに変数をキャプチャさせて、状態をもつクロージャ（の組）を返す関数がカスタムフックぽい。組と言ったのは、getterとsetterが別々に提供されることがあるから。例えば <code>const [v, setV] = useState()</code> は <code>v</code> がgetterで <code>setV</code> がsetterと思える。</p><p>カスタムフックの呼び出しもとの再レンダリングのたびに返却する関数の実態が同じにするかしないかは、<code>useCallback</code> を用いて制御できる。例えば <code>useState</code> は <code>useCallback</code> してると思える。</p><p>このようなプログラミングテクニックを用いると、振る舞いを実現するクロージャだけが定義されていて、それが裏で扱う状態遷移がフック定義の中で隠蔽されるのが嬉しい。</p><p>カスタムフックのモチベーションは単に状態を関数型っぽいやり方で扱いたいだけなのだと理解した。</p><p><a href=https://courses.cs.cornell.edu/cs3110/2021sp/textbook/mut/ex_counter.html>OCamlでのmutable counterの実装例</a>を見つけた。鉄板の例だと思う。僕はこれをイメージして状態を保つクロージャと呼んでいた。</p></p></div><div class=post-footer><time>November 28, 2024</time></div></article><article><h2><a href=https://blog.nfurudono.com/daily/2024-11-27/>2024-11-27</a></h2><div><p><ul><li><input disabled type=checkbox> <a href=https://incepter.github.io/how-react-works/>https://incepter.github.io/how-react-works/</a> これ面白そうなので読む。定期的にくるReactの仕組みを深掘りしたくなる時期。</li><li><input disabled type=checkbox> ブログのMakefileを書く</li></ul><h2><a href=#branded-type%e3%82%92%e4%bd%bf%e3%81%a3%e3%81%a6%e3%81%bf%e3%81%9f id=branded-typeを使ってみた class=anchor aria-hidden=true>Branded typeを使ってみた</a></h2><p>Branded typeはTSでnominal typingっぽいことをするためのプログラミングテクニックの一つ。<a href=https://zenn.dev/okunokentaro/articles/01gmpkp9gzfyr1za5wvrxt0vy6#branded-types>Branded Typesを導入してみる / TypeScript一人カレンダー</a> が詳しい。</p><p>僕はこんな感じに実装に入れてみた。<a href=https://github.com/naoyafurudono/naoyafurudono.github.io/commit/778270955b4c4e7672f50600fb28dff6c12b9fa0>https://github.com/naoyafurudono/naoyafurudono.github.io/commit/778270955b4c4e7672f50600fb28dff6c12b9fa0</a></p><p>全てがstringになりがちで不安になるけど、これなら安心安全。型の名前を信用できるようになって、名前をつける意欲も湧く。嬉しい。</p><h2><a href=#makefile%e3%81%aehelp id=makefileのhelp class=anchor aria-hidden=true>Makefileのhelp</a></h2><p>makeって、ある種CLIのDSLみたいなものだが、helpを自動生成してはくれない。いい感じにやるための工夫を見つけたのでシェアする。</p><p>以下は<a href=https://github.com/connectrpc/examples-go/blob/5f010eac8870fcd366b804f2734efe80b29ae5a0/Makefile#L17-L29>connectrpcのサンプル実装リポジトリにあったmakefileの一部</a>。</p><pre><code class=language-makefile>.PHONY: help
help: ## Describe useful make targets
	@grep -E '^[a-zA-Z_-]+:.*?## .*$$' $(MAKEFILE_LIST) | sort | awk 'BEGIN {FS = &quot;:.*?## &quot;}; {printf &quot;%-30s %s\n&quot;, $$1, $$2}'


.PHONY: all
all: ## Build, test, and lint (default)
	$(MAKE) test
	$(MAKE) lint


.PHONY: clean
clean: ## Delete intermediate build artifacts
	@# -X only removes untracked files, -d recurses into directories, -f actually removes files/dirs
	git clean -Xdf
...
</code></pre><p><code>make help</code> とすると、呼び出せるmakeのtarget一覧とその説明を出力してくれる。便利。コメントのフォーマットを定めておいて、helpを呼ぶときにはawkとかでmakefile自身を処理することでヘルプを出している。</p></p></div><div class=post-footer><time>November 27, 2024</time></div></article><article><h2><a href=https://blog.nfurudono.com/daily/2024-11-26/>2024-11-26</a></h2><div><p><h2><a href=#%e3%82%a2%e3%83%bc%e3%82%ad%e3%83%86%e3%82%af%e3%83%81%e3%83%a3%e3%82%ab%e3%83%b3%e3%83%95%e3%82%a1%e3%83%ac%e3%83%b3%e3%82%b9%e3%83%a1%e3%83%a2 id=アーキテクチャカンファレンスメモ class=anchor aria-hidden=true>アーキテクチャカンファレンスメモ</a></h2><p><a href=https://architecture-con.findy-tools.io/>https://architecture-con.findy-tools.io/</a> これに来ている。</p><p><a href=https://findy-tools.io/events/archives/architecture-con-2024/1/materials>登壇資料のまとめがあるとのこと</a>。</p><p>これはあくまで僕のメモであって、発表とか僕がお話しした人がこのまま主張したわけではないです。変なところがあれば僕のせいだし、良い主張があれば彼らのおかげです。繰り返しですが僕のメモなので第三者が読んで何かに活かしたり議論の種にすることは、しない想定です。僕が便利なのでインターネットにおいておくだけ。</p><h3><a href=#%e7%99%ba%e8%a1%a8 id=発表 class=anchor aria-hidden=true>発表</a></h3><h4><a href=#%e3%82%ad%e3%83%bc%e3%83%8e%e3%83%bc%e3%83%88 id=キーノート class=anchor aria-hidden=true>キーノート</a></h4><ul><li>トレードオフ分析をすることが仕事<ul><li>最強ソリューションを出すことではない</li></ul></li><li>トレードオフは絶対にある、ないと思ったらまだ見つかってないだけ</li><li><a href="https://speakerdeck.com/findyinc/modern-trade-off-analysis?slide=15">https://speakerdeck.com/findyinc/modern-trade-off-analysis?slide=15</a><ul><li>デザインは挙動に関する議論であるがアーキテクチャは能力に関するものであるから、徐々に変えるのではなく最初からスパッとやらないといけない</li></ul></li><li>フィードバックが早いのは良い。軌道修正はできる</li><li>ex マイクロサービスの粒度<ul><li>単一の責任だけでは曖昧で無理</li><li>分ける要因と統合する要因を考えるべきだと主張</li><li>ハードパーツの本に書いてあったやつだな</li></ul></li><li>名前つけるのが難しいから、名前がつく粒度まで分解しちゃう、みたいな話が出てびっくりしてる。理にかなっている気もするがパッと受け入れられてない<ul><li>メッセージングの件</li></ul></li><li>ベストプラクティスは、状況に対して何をやれば良い、という提案。ベストなので判断の余地はない</li><li>組織の目的は考える必要がある<ul><li>絶対壊れちゃいけない v.s. 要望からリリースまでの時間の短さ</li></ul></li><li>設計を繰り返すために定性分析して、結果的に定量分析しよう</li><li>過去のベスプラが今野アンチパターンになるのはエコシステムがコンスタントに変わるから</li><li>それに追従するためにも分析を続けるのがよかろうということかな</li></ul><p>感想: トレードオフとビジネス要求、をみて決めるのだなという気持ちと、無限に時間がかかるのでタイムボックスを決めてガッと決めることなのだろうと思った。それを何回も適宜行うイメージ。</p><h4><a href=#saas id=saas class=anchor aria-hidden=true>SaaS</a></h4><p>saas: 業務のベスプラを提供するモデルテナント: 契約の提供を受ける単位のことコントロールプレーンとアプリケーションプレーンなるほど。コントロールプレーンはなるだけ作りたくないテナント、本当に必要なのか？は気になる。ここで主張されるテナントには何が含まれるのだったか。テナントの本存在するのか。</p><h4><a href=#%e3%82%b3%e3%83%ad%e3%83%97%e3%83%a9 id=コロプラ class=anchor aria-hidden=true>コロプラ</a></h4><ul><li>クライアントでブラウザを使わない、リアルタイムサーバがあるのがwebアプリとの違いっぽい</li><li>専用ゲームサーバ: DGS, dedicated game serer</li><li>DBがやばかったのはspannerを使うことでなんとかなった</li></ul><h4><a href=#bitkey id=bitkey class=anchor aria-hidden=true>bitkey</a></h4><ul><li><p>モブプロ</p></li><li><p>BDD</p></li><li><p>イベントソーシング</p></li><li><p>どんなコンポーネントがあって、どう連携するかを決める</p></li></ul><h4><a href=#%e5%a2%97%e7%94%b0%e3%81%95%e3%82%93 id=増田さん class=anchor aria-hidden=true>増田さん</a></h4><ul><li>vuca, ooda</li><li>観察とか行動とかは具体的に何をするんだろう</li><li>マイケルポーター 競争優位</li><li>ask the speaker<ul><li>競合優位性でググろう、本を読もう</li><li>エンジニアがやっていくとスムーズそう</li><li>増田さんの会社がワークショップを開催したり、本を出したりするかも</li></ul></li></ul><h4><a href=#%e3%82%b3%e3%83%b3%e3%83%91%e3%82%a6%e3%83%b3%e3%83%89 id=コンパウンド class=anchor aria-hidden=true>コンパウンド</a></h4><p>なんで全く新しく作らなかったのだろう</p><ul><li>バンブーで1日かけて設計したとのことだが、どうやって決めた？意思決定プロセスが気になる。強い人？<ul><li>強い人が決めると決めてる。領域ごとに担当者がいる。これはknowledgeworkの意思決定プロセス（口頭でシュッと聞いただけなので、書いた内容は正確ではなさそう）</li><li>もちろんレビュー依頼などはする</li><li>それだと独裁になるのがいや。なのでこの会議で決めるとしている</li><li>そこまでに議題は共有されている。異論があれば準備しておく</li><li>異論が出なければ決まる</li></ul></li></ul><p>scim: azureとかでユーザ作ったらsaasでもユーザ作るみたいなやつ</p><p>バッチとバックエンドはapi呼び出しで繋がってたのかな</p><h4><a href=#flatt id=flatt class=anchor aria-hidden=true>flatt</a></h4><p>IRでのシナリオ気になる。エンドポイントだけでなくシナリオを作ってるのかな</p><h4><a href=#%e5%af%be%e8%ab%87 id=対談 class=anchor aria-hidden=true>対談</a></h4><p>取り巻く環境の中で継続的な改善可能性をもつシステムを作る環境に合わせる話は大事変化を発見したときにちゃんとついていく。変化を捉えることは必要そう</p><ul><li>実現したいことをトッププライオリティにおく、ビジネスissueとしても重視する。それを実現する手段には拘らない。でもその分野についてのビギナーには手段が中心に見える。その目的が見えない。なんでその手段を取るかを理解するのは難しい</li><li>こうしたら良くなるの提案を頑張って説明する。自分の主張も大体間違ってると思ってドキュメントを事実ベースで論理的に書くと成功確率上がる。言語化して検証する。</li></ul><h4><a href=#%e6%84%9f%e6%83%b3 id=感想 class=anchor aria-hidden=true>感想</a></h4><ul><li>いろんなところがconnect使ってる。layerx、knowledgework、flattが確か使っているとのことだった。</li><li>アーキテクチャの話を聞きにきたはずが意思決定の進め方とか社内での役割について質問していたし勉強になることが多かった。あとは共感できないか、もう知っていることが多かった</li></ul><h4><a href=#%e6%87%87%e8%a6%aa%e4%bc%9a id=懇親会 class=anchor aria-hidden=true>懇親会</a></h4><p>オフレコのつもりで話していた方もいるだろうからここには詳細書かない方が良さそうかな。知らない業種の話を聞けたり、一方的に存じ上げていた方のお悩みをお聞きしたのが印象的。また増田さんや他の登壇者の方に質問したり、そこから発展したお話し伺えて楽しかった。ドメインエキスパートどこにいるんだよ、いなくない&mldr;?みたいな話を質問した。他にも色々お話し聞けた。</p><h3><a href=#%e6%8c%af%e3%82%8a%e8%bf%94%e3%82%8a id=振り返り class=anchor aria-hidden=true>振り返り</a></h3><p>増田さん、川中さんのお話が響いたし、発表後に質問に伺って教えていただいた知見が良かった。熱い気持ちになっている。そのほかのセッションではFlattセキュリティの内容が面白かった。ASM、そんなステップが中にあることを今まで全くイメージできてなくて、概要を知れたことが嬉しかった。
Webアプリケーションの構造を始めて学んだときみたいな気持ち。登壇者がラムダノートのWebブラウザセキュリティの本の著者だと聞いてなるほどな気持ち。</p><p>増田さんからはドメインモデリングと事業を進める話を学んだ。訳書である「ドメイン駆動設計をはじめよう」を読んで、今回の発表内容の結構な部分を腹落ちさせていたのだが、増田さんがどこをどういう形で支持しているかを知れたのが収穫。また、僕が抱えていた悩みとして「ドメインモデリングしたいが、ソフトウェアだけじゃなくてドメイン自体の設計も僕たちが結局やる必要がある。ではドメインをどう作っていくのが良いだろう」というのがあった。それを増田さんにぶつけてそれが真っ当な悩みっぽいと共感していただけた（と僕は思っている）ことと、それへの対処（競争優位を重視して作るとか、エンジニアから歩み寄ってディレクタとかと会話するとか）を引き出せたことが収穫。あと懇親会で色々お話し聞けて楽しかった。ここのお話しから収穫あったのはそうだけど、人柄を知れたのがでかい。</p><p>川中さんからはプロダクト開発における意思決定の進め方を学んだ。初期には対象範囲（バックエンドとかフロントエンドとか）を決めて強い人が決める、それに対して責任を持つ、範囲の境界の契約（APIスキーマとか）はちゃんと決めて厳格に運用する。まあ確かにシュシュっと決まりそうだし、なんとかする未来を描きやすそう。</p><p>その他の意思決定の仕方として、やはり強い人が提案をして決めにかかるやり方もあるそうだが、それだと独裁になっちゃうので最終決定を会議でするようにしてるとのこと。決める内容はあらかじめ共有しておいて、反論があれば会議までには用意する必要がある。会議で異論がなければ決まる。もちろんレビューを依頼することはある。</p></p></div><div class=post-footer><time>November 26, 2024</time></div></article><article><h2><a href=https://blog.nfurudono.com/daily/2024-11-04/>2024-11-04</a></h2><div><p><p>ちょっと前からソフトウェア工学を触っている。興味から学んでいるというよりは必要に駆られて学んでいる側面が大きい。楽しい仕事をするためにつまらない状況を抑え込む力を身につけるために学んでいる。</p><p>とはいえ全くつまらないかというとそうでもなくて、ソフトウェアエンジニアやそれを取り巻く仕事はどんな体系で整理されているかを把握するのは職場の役割を整理して把握することにつながっていて面白みがある。</p><p><a href=https://amzn.asia/d/4unQnjS>入門 コンピュータ科学 ITを支える技術と理論の基礎知識 (J.Glenn Brookshear)</a>のソフトウェア工学の章を読んだ後に、<a href=https://www.iwanami.co.jp/book/b606533.html>ソフトウェア工学の基礎（玉井　哲雄）</a>を読み進めている。</p><p>CSは学部の頃にある程度学んだが、その中で工学っぽい分野は触らなかったので学部レベルから勉強している。とはいえ実務経験やラボの先生のお話とかでソフトウェア工学に触れている（割とそれはそう）ので、全く素人って感じでもない。</p><p>ぼくが必要に駆られているのは要求工学なのかな。設計には純粋に興味がありそう。</p></p></div><div class=post-footer><time>November 4, 2024</time></div></article><article><h2><a href=https://blog.nfurudono.com/daily/2024-10-27/>2024-10-27</a></h2><div><p><h2><a href=#%e7%b5%90%e5%a9%9a%e5%bc%8f%e6%ba%96%e5%82%99 id=結婚式準備 class=anchor aria-hidden=true>結婚式準備</a></h2><p>友達の結婚式に今度出席するので真面目に準備してみる。普段スーツを着ないので礼服を着るのはコスプレみたいでドキドキする。</p><ul><li><input checked disabled type=checkbox> 礼服が入るか検証</li><li><input checked disabled type=checkbox> シャツを買う</li><li><input checked disabled type=checkbox> ネクタイと胸につけるハンカチ買う<ul><li>ネクタイの練習もしておかないとな</li></ul></li><li><input checked disabled type=checkbox> 靴を手入れする</li><li><input checked disabled type=checkbox> ワックス買って練習する</li><li><input checked disabled type=checkbox> 髪をいい感じに切ってもらうための店を見つける<ul><li>人に聞くのがいいかな</li><li>2 or 3日に行こう（最近切ったばかりでできることあるのか？）</li></ul></li><li>その他マナーを学んでおく</li></ul><h2><a href=#sql%e3%81%ae%e3%83%a6%e3%83%bc%e3%82%b6%e7%ae%a1%e7%90%86 id=sqlのユーザ管理 class=anchor aria-hidden=true>SQLのユーザ管理</a></h2><p>アプリケーションの開発・運用をしているとSQLのユーザをそれなりに作ることになる。データベースもしかり。それらをIaCな感じで管理したいがベストプラクティスをまだ知らない。</p><p>管理したいユーザの情報は以下の通り</p><ul><li>ユーザ名（ホストを含む）</li><li>Grant</li><li>パスワード</li></ul><p>簡単なのは、ユーザ名とパスワードだけ1Passとかで管理して、他は動いているものを見に行く方法。管理しない考え方。実態と齟齬がないことは良いことだが、設定を見るためには管理者権限が必要だしいちいち接続するのも面倒。また、複製が面倒なのも問題だし、設定の経緯をコメントに残したりバージョン管理したりできないので組織としてスケールしない。</p><p>Terraformで管理するのはいい線行きそう。ネックはパスワードかな。パスワードを平文で保持しないことを達成しようと思うと途端にややこしくなりそう。運用ではパスワードにシュッとアクセスしたいケースがあるため、他の解決策と併用するのが良いだろう。
Grantとユーザ名、変更の経緯の管理には向いていそう。</p><p>Terraformと1passを組み合わせるのが綺麗だろうと思った。ユーザ名は不変（変更したくなったら作り直す）にしておけば、色々いい感じになるんじゃないかな。</p><h2><a href=#oauth%e3%81%ae%e3%83%99%e3%82%b9%e3%83%88%e3%83%97%e3%83%a9%e3%82%af%e3%83%86%e3%82%a3%e3%82%b9 id=oauthのベストプラクティス class=anchor aria-hidden=true>OAuthのベストプラクティス</a></h2><p><a href=https://datatracker.ietf.org/doc/html/draft-ietf-oauth-security-topics>https://datatracker.ietf.org/doc/html/draft-ietf-oauth-security-topics</a> が良さげ。
Refresh tokenをどこにどれくらいの期間保持するとか、どういうインターバルで無効化するとかで悩む。あとaccess tokenはauthorizationヘッダに突っ込むのが吉？とか。</p><h2><a href=#about-a-philosophy-of-software-design id=about-a-philosophy-of-software-design class=anchor aria-hidden=true>about: A Philosophy of Software Design</a></h2><p>ソフトウェア設計の指針をまとめた本で定番だけど日本語訳されてない（はず、2022年に買ったときはそうだった）。
APIを実装・設計したりそれに付随してコードレベルのモジュール（クラスとかで表現するようなレイヤ）を設計するときに役立つ指針をくれる。</p><p>僕がプログラミングのレビューをしたり、自分でプログラミングしたりするときに気にすることは割とここから学んだ（言語化しただけ？）と思う。インターネットでHTMLが公開されてたらどんなに嬉しいだろうと思う。レビューのときに「ここを読んでください」をできるので。</p><p>言語とかパラダイムに依存しない、プログラミング一般について使える知見が書かれているので繰り返し読む価値のあるものだと思うし、実際そうしている。以下のそれぞれのタイミングで読んだが、毎回楽しく思っている。</p><ol><li>がっつりプログラミング始める前</li><li>自分でコードを書くようになってから</li><li>レビューをするようになってから</li></ol><p>広くいろんな人に使われるAPIを設計するようになるとまた見える世界が違うのだろうと思う。</p><h2><a href=#about-%e3%83%9e%e3%82%b9%e3%82%bf%e3%83%aa%e3%83%b3%e3%82%b0api%e3%82%a2%e3%83%bc%e3%82%ad%e3%83%86%e3%82%af%e3%83%81%e3%83%a3 id=about-マスタリングapiアーキテクチャ class=anchor aria-hidden=true>about: マスタリングAPIアーキテクチャ</a></h2><p>最近（日本語訳が）発売されったぽい本。内容的には流行り廃りがありそうな内容を扱っていて10年後には古くなっていそう。例えば第1章の「APIの設計・構築・仕様化」ではConnect使えばいいじゃないと思った。</p><p>とはいえこれまで10年くらいのプラクティスがおそらくいい感じに説明されていて、今どきのクラウドでいろんなサービスを動かして連携させるスタイルのアプリケーションをどうやって作っていくかを体系的に述べているように思う。ぼくはそのあたりを勉強中の身なので偉そうなことを言ったり評価をしたりできないのだけど、これまで断片的に学んで来たこと（そして腑に落としたり手を動かすに至らなかったこと）の使い所を自分の中で描けるようになっていると感じる。ほんまかいなと思うこともあるので、盲目的に信じるというよりは質の高い雑誌のような意識で読んでいる。</p></p></div><div class=post-footer><time>October 27, 2024</time></div></article><article><h2><a href=https://blog.nfurudono.com/daily/2024-10-26/>2024-10-26</a></h2><div><p><ul><li><input disabled type=checkbox> aboutページの収取をするプラグインを実装して組み込んだ。あとはそれをいい感じに表示する必要がある</li><li><input checked disabled type=checkbox> 今度人の結婚式に出るので身だしなみとか常識を身につける・髪切るとか服を用意する計画を立てる<ul><li>受付やるらしいのでちゃんとした方が良さそう</li><li>礼服着れるか確認しておくか</li></ul></li><li><input disabled type=checkbox> helm完全に理解する。リリースとか意味わからん。installって何？kubectl applyとの関係は？</li></ul></p></div><div class=post-footer><time>October 26, 2024</time></div></article><article><h2><a href=https://blog.nfurudono.com/daily/2024-10-10/>2024-10-10</a></h2><div><p><ul><li><input disabled type=checkbox> protobufとかsqlcでファイル生成をするツールを使ってチーム開発をしているとすごくコンフリクトして辛い。生成するファイルを分割して、例えばrpcとかmessage単位にファイル（パッケージではない！）を分ければgitのコンフリクトは避けられる。パッケージも一緒なので振る舞いには影響しない。</li></ul></p></div><div class=post-footer><time>October 10, 2024</time></div></article><article><h2><a href=https://blog.nfurudono.com/daily/2024-10-06/>2024-10-06</a></h2><div><p><h2><a href=#llm-%e3%82%92%e5%b0%82%e9%96%80%e5%ae%b6%e3%81%a0%e3%81%a8%e6%80%9d%e3%81%88%e3%81%aa%e3%81%84 id=llm-を専門家だと思えない class=anchor aria-hidden=true>LLM を専門家だと思えない</a></h2><p>LLMはコンパイラとかみたいに説明とか分析を出力してくれるものではあるけど、
LLMはコンパイラよりも人間に近いものだと思っている。コンパイラみたいな決定的な出力をするツールに対して良い入力を与えてその出力をそのまま共有することには価値がたくさんあるけれど、
LLMから得られた出力をそのまま「LLMに聞いたらこう返してくれました！」っていうのは（少なくとも現代使えるLLMのレベルでは）意味が薄いと感じる。</p><p>人間に対して質問して、その回答をそのまま人に共有することにも、場合によって価値がたくさんあったり薄かったり感じることがそれぞれある。質問を回答してくれる人間に対して信頼というか専門家としての信頼というかがあったら、そのまま回答を知りたいと思うが、その辺のただの人とか単に知識がたくさんあるだけな人だと、
（アンケート回答のデータとかなら別だけど）意見や情報としては価値を見出しにくい。そんな感じに、ぼくはLLMを専門家だとはまだ思えていない。単に知識がたくさんあってそれっぽい文章を生成するだけの（論理的思考の欠けた）出力をするやつだと思う。</p><p>とはいえ知識や経験がたくさんあれば結構な量の論理的思考は不要だろうことは段々わかってきた。なんのために考え事が必要なんだろうね。そして論理的思考とは何なのだろう。</p><h2><a href=#%e3%81%8a%e7%96%b2%e3%82%8c id=お疲れ class=anchor aria-hidden=true>お疲れ</a></h2><p>今週は疲れた。先週の金曜から毎日飲み会だとか人と会ったりだとかのイベントがあった。それぞれは楽しいのだけど全てに参加していると大変。昨日はずっと寝ていたし、今日は家事をしていた。本を読む気力もない。体としては寝ても良さそうなのだが頭は何かをしたがっているので文章を書いている。本を読みたい気持ちもあるが、落ち着いて考え事をしたい気持ちもある。今その本を本当に読みたいのだったか、とか。</p><h2><a href=#%e3%82%8f%e3%81%8b%e3%81%a3%e3%81%9f%e3%81%a4%e3%82%82%e3%82%8a-%e8%aa%ad%e8%a7%a3%e5%8a%9b%e3%81%8c%e3%81%a4%e3%81%8b%e3%81%aa%e3%81%84%e6%9c%ac%e5%bd%93%e3%81%ae%e5%8e%9f%e5%9b%a0-%e5%85%89%e6%96%87%e7%a4%be%e6%96%b0%e6%9b%b8-%e3%81%8c%e8%89%af%e3%81%84 id=わかったつもり-読解力がつかない本当の原因-光文社新書-が良い class=anchor aria-hidden=true>わかったつもり 読解力がつかない本当の原因 (光文社新書) が良い</a></h2><p><a href=https://amzn.asia/d/gd6e4f7>わかったつもり 読解力がつかない本当の原因 (光文社新書) </a>に本屋で出会って読んでいるのだが良い。わかるとか理解する、みたいなことは一体何なのかは高校生の頃からのぼくのテーマの一つなのだが、それを一段深めてくれている。</p><p>ぼくの中での「理解する」とは、説明をつけることとか腹落ちしていることであった。論理とかは客観的なアレとして社会的に認められていたり、自然科学は実際問題役に立っているので市民権を得ているが、そんなことは「理解している」とは関係ないと思っている。理解しているか否かは主観的な問題で、腹に落ちた感じがするなら自分はそれを理解していると思うし、自分が同意できる説明を他者がするなら他者はそれを理解しているように感じる。そういうものだと思っていたし、今も思っている。</p><p>この本の説明ではぼくの解釈と矛盾しない中で理解の程度を論じているように思う。文脈とそれに対する解釈を持っている人間は、文脈を新たに獲得し明らかにすることで対象の解釈をより鮮明にする、みたいな主張だと今のぼくは大体思っているはず。鮮明にするというか、よりわかるというか。</p><p>これまでのぼくの理解への価値観には抽象度の違いがなかった。抽象解釈をするときにどれだけfineに解釈するかの違いが認識する文脈の違いに依存することをこの本に解らさられた。</p><h2><a href=#%e5%85%ab%e7%99%be%e5%b1%8b id=八百屋 class=anchor aria-hidden=true>八百屋</a></h2><p>この前ご近所さんとお話した影響で今日は八百屋に行ってきた。はじめて行くタイプの八百屋で、なんとカゴとレジは存在しなくて、床に陳列されている野菜を見ながら店員さんに口頭で欲しい野菜をクエリするタイプの買い方だった。ちなみに野菜の品質はそんなに良くなかったので次は他のところかなと思っている。安くはあった。</p><h2><a href=#%e8%aa%ad%e6%9b%b8 id=読書 class=anchor aria-hidden=true>読書</a></h2><p>結局人は自分と近しい考えを読んでそれを楽しいと思うのだな、みたいなことを恩師が言っていたのを思い出した。ぼくもそう思う。そういう答え合わせみたいな読書は楽しい。</p><p>読書に限らずおしゃべりとかでもなんやかんや同調とか、似たような哲学のもとでの「議論」みたいなことをするときが楽しそう。「あいつはやばいから！」と嬉しそうに友達を紹介する人は、大体その友達と大差ないとかだとか。議論をするときに背景に共通点を見出して群れるのもそういうことだと思う。良し悪しは知らない。</p><h2><a href=#%e5%a5%bd%e3%81%8d%e3%81%aa%e6%a7%8b%e6%96%87 id=好きな構文 class=anchor aria-hidden=true>好きな構文</a></h2><p>named-letです。</p></p></div><div class=post-footer><time>October 6, 2024</time></div></article><article><h2><a href=https://blog.nfurudono.com/daily/2024-09-16/>2024-09-16</a></h2><div><p><h2><a href=#%e4%bb%8a%e6%97%a5%e3%82%84%e3%82%8b%e3%81%93%e3%81%a8 id=今日やること class=anchor aria-hidden=true>今日やること</a></h2><ul><li><input checked disabled type=checkbox> 掃除<ul><li>ルンバを起動したのでok</li></ul></li><li><input checked disabled type=checkbox> 外出<ul><li>電車乗るくらいの外出をする。秋物出たかな。あるいは外で使うと幸せになれるグッツを買うか。</li><li>ランニングパンツと靴下を買う。帰省でランニングのズボンを置いてきたのと、靴下が大体ボロボロになってきたので。</li><li>靴下は買った。ランニングパンツはまあいっかと思って買わず。そのほかに秋に向けて服を見たけどピンと来なかったので特に買わずだった。</li></ul></li><li><input checked disabled type=checkbox> 本読む。k8sのあれ。あとは認証の技術気になるので学ぶ。認可も気になる。<ul><li>SSL</li><li>ドメイン</li><li>k8sのRBAC</li><li>選ばれたのはカスタムコントローラでした。ググって見つけたyahooの人のスライドが概要を掴むのにいい感じだった。<ul><li><a href=https://speakerdeck.com/hhiroshell/platform-engineering-and-kubernetes>https://speakerdeck.com/hhiroshell/platform-engineering-and-kubernetes</a></li></ul></li></ul></li><li><input checked disabled type=checkbox> todoをリストアップする拡張の実装</li><li><del>todoの拡張、出先でチェック入れたくなりそうなので、githubでの編集へのリンクをつけたい</del><ul><li>やっぱりいいや。出先ではのんびりしよう。todoのことなんて忘れればいい。</li></ul></li></ul><h2><a href=#todo%e3%82%92%e3%83%aa%e3%82%b9%e3%83%88%e3%82%a2%e3%83%83%e3%83%97%e3%81%99%e3%82%8b%e3%83%9a%e3%83%bc%e3%82%b8%e3%82%92%e5%ae%9f%e8%a3%85%e3%81%97%e3%81%9f id=todoをリストアップするページを実装した class=anchor aria-hidden=true>todoをリストアップするページを実装した</a></h2><p><a href=https://diary.nfurudono.com/todos/>https://diary.nfurudono.com/todos/</a>に実装した。これでもう過去のtodoを忘れない。収集とレンダリングの両方が必要でだるかった。特にレンダリングはunifiedのアーキテクチャを理解してなくて手間取った。今の実装がunifiedのアーキテクチャに沿っているか自信がない。</p><h2><a href=#%e6%ac%a1%e3%81%ae%e5%bc%95%e8%b6%8a%e3%81%97 id=次の引越し class=anchor aria-hidden=true>次の引越し</a></h2><p>本棚を作って設置したところ、そろそろキャパシティが限界だと気がついた。本棚を増やすためには引越しが必要。そろそろ減らしてもいい本も増えてきたので、
2年周期の引越しで問題ないとは思うが。今で3/4年か&mldr;、今年のうちに西側の探索をしたいな。今度友達とどこに行くか決めてないので、そっちの方に雑に行ってみて案内してもらおう。向こうが詳しいかは知らないけど。</p><h2><a href=#%e9%9b%bb%e8%bb%8a%e3%81%a7%e9%81%8e%e3%81%94%e3%81%99%e3%81%ae%e3%81%8c%e5%a5%bd%e3%81%8d id=電車で過ごすのが好き class=anchor aria-hidden=true>電車で過ごすのが好き</a></h2><p>寝たり本を読んだり景色をみたり、考え事をしたりする環境として電車で過ごすのが好き。年末は北国に電車に乗りに行きたいな。高校生の頃に一週間電車に乗りっぱなしの旅行をしたけど、あんな感じのことをまたやりたい。それでいうとシベリア鉄道は憧れる。</p><p>景色が変わるのがいいし、椅子しかないのも良い。なので新幹線みたいな机があるのはそれほど好きじゃない。横に細いサイドテーブルみたいなのはok。ものを置けるけどそこで何かやる感じではないのがいい。集中できるし、パッと休憩しようと思ったら外を見ればいい。なので電車に乗るのは日中がいい。夜は外が見えないので興醒めする。</p><p>家にいても景色が変わらなくてつまらない。外に出るのも良いが、それだと本読んだりできない。電車の中は家と同様に自分が暇なのに快適で、移動しているのがいい。</p><h2><a href=#3%e9%80%a3%e4%bc%91 id=3連休 class=anchor aria-hidden=true>3連休</a></h2><p>金曜日の昼過ぎに三連休だということを知った。なんと来週も三連休だということだった。この三連休は本棚を作り、あとは家でまったりした。こういうのもあり。</p></p></div><div class=post-footer><time>September 16, 2024</time></div></article><article><h2><a href=https://blog.nfurudono.com/posts/go-static-analysis/>Goのanalysisとtypesに入門する</a></h2><div><p><h2><a href=#%e6%a6%82%e8%a6%81 id=概要 class=anchor aria-hidden=true>概要</a></h2><p>Goで静的解析してリンターを実装したい。具体的には、あるT1インターフェース型の変数がスコープにあるときは、T1よりゆるい任意の型の使用を禁止する、みたいな制約を入れたい。その辺に転がっている記事ではASTを覗いてみたり、SSAを覗いてみたりするようだけど、ASTとその型をまともに扱っていつつ、いい感じに静的解析ツールとして仕上げる記事を見つけられなかった。</p><p>この記事ではGoプログラムの静的解析ツールを実装するために存在する標準的なツールチェーンの思想を説明する。Go Analyzerは静的解析ツールフレームワークとして用いる。具体的な静的解析には標準ライブラリを用いる。</p><h2><a href=#%e4%bd%9c%e3%82%8a%e3%81%9f%e3%81%84%e3%82%82%e3%81%ae id=作りたいもの class=anchor aria-hidden=true>作りたいもの</a></h2><blockquote><p>具体的には、あるT1インターフェース型の変数がスコープにあるときは、T1よりゆるい任意の型の使用を禁止する、みたいな制約を入れたい。</p></blockquote><p>これを検証するGoの静的解析ツール。例えば以下のようなrの使用を検知したい。</p><pre><code class=language-go>func parse(r io.Reader) (string, error) { ... }

func (rw io.ReadWriter) {
	var r io.Reader = getReader()
	s, err := dump(r) // 「rじゃなくてrwを使ってくれ〜！」と指摘したい。
	...
}
</code></pre><h2><a href=#analysis id=analysis class=anchor aria-hidden=true>analysis</a></h2><p><a href=https://pkg.go.dev/golang.org/x/tools/go/analysis>https://pkg.go.dev/golang.org/x/tools/go/analysis</a> これ。準標準なパッケージ。ドキュメントの冒頭に思想がちゃんと書かれているのでそれを読むのが良さそう。</p><h3><a href=#analyzer%e6%a7%8b%e9%80%a0%e4%bd%93 id=analyzer構造体 class=anchor aria-hidden=true>Analyzer構造体</a></h3><p>一個の解析ツールに対応する。Analyzer.Runに解析を実行する関数を定義する。この解析ツールを実行するとき（実行するのはフレームワークの仕事）に、Pass構造体が渡される。</p><h3><a href=#pass%e6%a7%8b%e9%80%a0%e4%bd%93 id=pass構造体 class=anchor aria-hidden=true>Pass構造体</a></h3><p>Pass構造体は解析対象のパッケージごとに作成される。なので解析の単位はパッケージごとということになりそう。いいじゃん。</p><pre><code class=language-go>type Pass struct {
	Fset         *token.FileSet
	Files        []*ast.File
	OtherFiles   []string
	IgnoredFiles []string
	Pkg          *types.Package
	TypesInfo    *types.Info
	ResultOf     map[*Analyzer]interface{}
	Report       func(Diagnostic)
	...
}
</code></pre><p>こいつを通じて解析をする関数は処理対象のデータにアクセスしたり、処理結果を報告したりするぽい。モナドとか代数的エフェクトみたいで綺麗だ。そう思うとあれらは抽象化された一つの振る舞いの切り口を表現するための基本的な演算を定義していたのだから、まあそうだなと思える。Kokaで静的解析ツールを作るときにはpassエフェクトを定義するのだろう。</p><blockquote><p>The Fset, Files, Pkg, and TypesInfo fields provide the syntax trees, type information, and source positions for a single package of Go code.</p></blockquote><p>これは本質情報の予感。このあたりにうまくアクセスすることで、ぼくたちの頭の中で想像する型付き抽象構文木へのアクセスを実現できるんだろう。データ構造が思ったのと違いそうなことには気をつけよう。</p><p>これらに加えて、他のanalyzerが出力してくれる結果をこのanalyzerの入力として使える。それにアクセスするためには pass.ResultOf[a].(aResType)を参照すればよい。</p><p>診断(diagnostics)を出したければPass.Reportとか、パッケージで提供されているReportfとかを使うらしい。</p><h2><a href=#go%e3%81%ae%e5%9e%8b%e4%bb%98%e3%81%8d%e6%a7%8b%e6%96%87%e8%a7%a3%e6%9e%90%e6%9c%a8 id=goの型付き構文解析木 class=anchor aria-hidden=true>Goの型付き構文解析木</a></h2><p>ここまでで、モジュラーに静的解析ツールを実装するフレームワークの構造がわかった。それに乗っかれば静的解析をいい感じに動かすことはできそうだ。静的解析の処理を実装する方法もなんとなくわかった。Pass構造体の世界観に乗っかればokな感じがする。</p><p>次に自在にプログラムを解釈する方法を知りたい。プログラムはコンパイラに処理されていろんな形態に変換されるので、ユースケースに応じて適切な表現を選ぶ必要がある。今回は型付き抽象構文木を扱いたいので、Pass構造体のFset, Files, Pkg, TypesInfoあたりを上手に使えると良さそうだ。特にTypesInfoが気になる。これは types.Info型をとるみたいなので、typesパッケージを見に行く。</p><p>typesパッケージはこれ <a href=https://pkg.go.dev/go/types>https://pkg.go.dev/go/types</a>。冒頭の説明がスッキリしていてまだ何をやれば型付き抽象構文木に対してクエリっぽいことをできるか、どんなクエリっぽいことが許されるかを理解できない。なので貼ってあったチュートリアルのリンクを辿る。なお、スッキリしている説明自体は読んでよかった。このパッケージが扱うフェーズで何をやるか説明されていて、もっと詳しく読んで良さそうなことに自信を持てた。</p><p>なお、僕の目的のためには他の解析ツールの結果を使う方が良いかもしれないとも思う。暇だし気になるのでチュートリアルを読むのに時間をかけるけど。</p><h3><a href=#%e3%83%81%e3%83%a5%e3%83%bc%e3%83%88%e3%83%aa%e3%82%a2%e3%83%ab id=チュートリアル class=anchor aria-hidden=true>チュートリアル</a></h3><p>脱線したがチュートリアルを読み進める。<a href=https://go.dev/s/types-tutorial>https://go.dev/s/types-tutorial</a> これ。これを読む目的は、何をやれば型付き抽象構文木に対してクエリっぽいことをできるか、どんなクエリっぽいことが許されるかを理解すること。</p><p>このチュートリアルはジェネリクスには対応してないらしい。ジェネリクスのためのドキュメントは別途あるとのことだけど、今回は基礎を知りたいので気にしない。</p><p>イントロと例くらいは読んでみて、あとは斜め読みでいいかな。まずはイントロ。</p><blockquote><p>Measured by lines of code and by API surface area, it is one of the most complex packages in Go&rsquo;s standard library, and using it requires a firm grasp of the structure of Go programs.</p></blockquote><p>とのこと。大変だ。</p><blockquote><p>Starting at the bottom, the go/token package defines the lexical tokens of Go. The go/scanner package tokenizes an input stream and records file position information for use in diagnostics or for file surgery in a refactoring tool. The go/ast package defines the data types of the abstract syntax tree (AST). The go/parser package provides a robust recursive-descent parser that constructs the AST. And go/constant provides representations and arithmetic operations for the values of compile-time constant expressions, as we&rsquo;ll see in Constants.</p></blockquote><p>データ構造とアルゴリズムを分けるの賢そう。parserにastを定義しないとか偉い感じがする。色々あるんだろうな。どう嬉しいのかはわからないけど。定数畳み込みをastに対して実装したいが、parserに依存するわけではないよね、みたいな話かな。</p><p>名前解決、型検査、定数式の計算は一緒にやらないといけないなるほど。ここでいう名前解決とは、名前の出現に対してその宣言を対応させること。</p><p>例まで読んだがパッケージレベルの話しかわからないな。ぼくは式とかのレベルでプログラムを処理したいんだ！ということで本命のInfo構造体への言及を探すことにすると、<a href=https://github.com/golang/example/tree/master/gotypes#typeandvalue>TypeAndValue</a>でそれらしいことを述べている。</p><p>Info.Typesは <code>map[ast.Expr]TypeAndValue</code> らしい。そろそろ手を動かして、プログラムのこの要素は式として扱われるか？とかをみたい。と思ったらドキュメントが例を出してくれた。こういうときが一番楽しい。式があったら型は得られるようになってるのね。ただまだよくわかってなくて、mapの定義域をast.Exprとしているが、そのExprとして本当に登録されるのはどの範囲のExprなのかがわからない。当然 <code>ast.Expr{}</code> なんて渡しても、その型を計算しているわけがない。どういう操作で手に入れたast.Exprに対しては、Info.Typeがその型を教えてくれるんだろうか。Infoを生成するやつが知ってるのかな。analysisパッケージはよくわからんPassがInfoを持っていたので微妙だけど、パッケージの単位で処理をするのでパッケージに存在するすべての式の型を教えてくれると思って良さそう？</p><p>確かに<a href=https://pkg.go.dev/go/types#Config.Check>Config.Check</a>はパッケージを型検査して、引数にInfoへのポインタをとって結果を書き込みそう。</p><p>次に、型同士の比較をしたい。具体的には、T1が必要な文脈でT2は使えるか (assignable) を判定する方法が欲しい。そのためにこれが使える<a href=https://pkg.go.dev/go/types#AssignableTo>https://pkg.go.dev/go/types#AssignableTo</a>。引数に渡すTypeインターフェースの値はTypeAndValueで取れるので、ほとんど勝ったようなもの。ちなみに僕は、最初<a href=https://pkg.go.dev/go/types#ConvertibleTo%3E>ConvertibleTo</a>を使っていて全然ダメだった。ConvertibleToは数値が変換できるか判定するやつぽい。</p></p></div><div class=post-footer><time>August 31, 2024</time></div></article><article><h2><a href=https://blog.nfurudono.com/daily/2024-08-15/>2024-08-15</a></h2><div><p><p>日記をnextjsでビルドして、cloudflare pagesにデプロイするようにした。cnameの設定が効くようになれば、<a href=https://diary.nfurudono.com>https://diary.nfurudono.com</a>から見えるようになるはず。</p><p>cloudflareのアカウントを初めて作って設定したが、体験よかった。デプロイとか周りの開発のためにCLIツールやそれのgithub actionsバインディングが提供されていて、サクッとデプロイできた。記念すべき初デプロイの成功をメモしておく<a href=https://github.com/naoyafurudono/naoyafurudono.github.io/actions/runs/10399555684/job/28798614059>https://github.com/naoyafurudono/naoyafurudono.github.io/actions/runs/10399555684/job/28798614059</a></p><p>Hugoの設定をたくさん書いていても楽しくないのでNext.jsでなんでもやってみよう、というモチベーション。<a href=https://github.com/unifiedjs/unified>unified</a>がいい感じで楽しいので動くところまで持って来れた。</p><p>ソースコードは<a href=https://github.com/naoyafurudono/naoyafurudono.github.io/tree/main/tools/tt>https://github.com/naoyafurudono/naoyafurudono.github.io/tree/main/tools/tt</a>にある。</p></p></div><div class=post-footer><time>August 15, 2024</time></div></article><article><h2><a href=https://blog.nfurudono.com/daily/2024-08-03/>2024-08-03</a></h2><div><p><h2><a href=#%e4%ba%8b%e6%a5%ad%e3%81%a7%e4%bd%bf%e3%81%86%e3%82%b7%e3%82%b9%e3%83%86%e3%83%a0%e3%82%92%e8%a8%ad%e8%a8%88%e3%81%99%e3%82%8b%e3%81%a8%e3%81%8d%e3%81%ae%e8%a9%b1 id=事業で使うシステムを設計するときの話 class=anchor aria-hidden=true>事業で使うシステムを設計するときの話</a></h2><p>ソフトウェアを設計するときにはどこを変えやすくしたいか（どんな変更をしやすくしたいか）を把握したい。
Expression probremは必ずしも解決しなくてよいと思っていて、変更に必要な気合がどれくらいかを把握したうえでそれを許容できるかが論点だと思う。</p><p>もちろん使う気合が小さいのに越したことはないのだが、コード読み書きするのはみんな好きだろうし、嫌いなひとは割とAIに任せられる世の中なのだから、小手先のテクニックでなんでもできる設計とかにしておくうまみはあまりないと思う。</p><h2><a href=#%e8%87%aa%e5%ae%85%e3%81%ae%e3%83%8e%e3%83%bc%e3%83%88pc id=自宅のノートpc class=anchor aria-hidden=true>自宅のノートPC</a></h2><p>会社ではmacbook proを使っていて、家ではmacbook airを使っている。使っているソフトウェアとか設定は大体同じにできていて便利ではあるのだけど、今日は手ぐせで会社でよく触っているリポジトリにcdしようとして失敗するのを何回もやってしまった。
lsのノリでそのディレクトリにcdすることに辛さを感じる。</p><h2><a href=#%e4%bb%8a%e6%97%a5%e3%82%84%e3%82%8a%e3%81%9f%e3%81%84%e3%81%93%e3%81%a8 id=今日やりたいこと class=anchor aria-hidden=true>今日やりたいこと</a></h2><ul><li>飲み会の場所を抑える<ul><li>ビールをたくさん飲めるところでそう遠くないところがいい</li></ul></li><li>健康料理<ul><li>野菜を食べたいです</li></ul></li><li>外出<ul><li>15:30を回ったが、まだ外に出ていない。お日様が欲しい</li></ul></li><li>洗濯<ul><li>あとは干すだけ</li></ul></li><li>運動</li><li>ルータを吊るす<ul><li>そういえば家の壁に釘打っても怒られなさそうな板が壁に付いているので、そこにルータをなんとかつけたい</li></ul></li></ul><h2><a href=#%e9%9b%91%e8%ab%87 id=雑談 class=anchor aria-hidden=true>雑談</a></h2><p>今日は小学校4年生の頃に転校してきた友達の誕生日。ブルーアイズホワイトドラゴンをくれた、寡黙なやつだった。元気だといいな。</p></p></div><div class=post-footer><time>August 3, 2024</time></div></article><article><h2><a href=https://blog.nfurudono.com/posts/ahk/>AHK入門</a></h2><div><p><p>Windowsマシンでキーボード操作が不便なので導入する。悪態をつきながらも使っている人を知っているので内容を理解していないが期待している。</p><h2><a href=#%e3%82%a4%e3%83%b3%e3%82%b9%e3%83%88%e3%83%bc%e3%83%ab id=インストール class=anchor aria-hidden=true>インストール</a></h2><p><a href=https://www.autohotkey.com/>https://www.autohotkey.com/</a> 公式ページからバイナリを落とせる。インストールするとwelcome画面が開いたのだが、そこに「コンパイルする」ボタンがあって、ちょっと不安になる。僕はプログラムをボタンを押してコンパイルしないといけない？</p><p>ついてきたマニュアルはいい感じのスタイリングでよみやすそう？</p><h2><a href=#%e3%83%9e%e3%83%8b%e3%83%a5%e3%82%a2%e3%83%ab%e3%82%92%e8%aa%ad%e3%82%93%e3%81%a7%e3%81%bf%e3%82%8b id=マニュアルを読んでみる class=anchor aria-hidden=true>マニュアルを読んでみる</a></h2><p>頭から飽きるまで読んでいく。</p><ul><li>スクリプトの作成 (Create a Script)<ul><li><blockquote><p>Be sure to save the file as UTF-8 with BOM if it will contain non-ASCII characters. For details, see the FAQ.</p></blockquote></li><li>BOMがいるらしい。そういえばBOMってなんなのだろう。結局まだちゃんと理解してない。</li></ul></li><li>スクリプトの実行 (Run a Script)<ul><li>なんかソースファイルをダブルクリックしたりして実行できて、実行してる間だけ効くらしい。</li><li>イベントハンドラみたいなやつの定義がそれぞれのスクリプトに対応するかと思っていたが、なんかメンタルモデルがあってなさそう</li></ul></li><li>それぞれのスクリプト実行がWindowsのトレイアイコンに反映されるらしい。なるほど</li></ul><p>飽きたのでhello worldする。</p><h2><a href=#hello-world id=hello-world class=anchor aria-hidden=true>hello world</a></h2><p>以下はCapsLockを押すとhello, worldと出力するよう設定するahkスクリプト。ちなみにこれらのhello, worldはCapsLockを打って入力している。</p><pre><code class=language-ahk>#Requires AutoHotkey &gt;=v2.0.0

CapsLock::
  {
    SendInput &quot;hello, world&quot;
  }
  Return
</code></pre><p>CapsLockで英数変換するのは以下で実現できた。</p><pre><code class=language-ahk>#Requires AutoHotkey &gt;=v2.0.0

CapsLock::
  {
    SendInput &quot;^{Space}&quot;
  }
  Return
</code></pre><p>紆余曲折あって、以下のようになった。Windowsでもいい感じにvim使えるようになって幸せ。</p><p><a href=https://github.com/naoyafurudono/dotfiles/blob/main/autohotkey.ahk>https://github.com/naoyafurudono/dotfiles/blob/main/autohotkey.ahk</a></p><pre><code class=language-ahk>#Requires AutoHotkey &gt;=v2.0.0

IME_SET(SetSts, WinTitle:=&quot;A&quot;)    {
    hwnd := WinExist(WinTitle)
    if  (WinActive(WinTitle))   {
        ptrSize := !A_PtrSize ? 4 : A_PtrSize
        cbSize := 4+4+(PtrSize*6)+16
        stGTI := Buffer(cbSize,0)
        NumPut(&quot;Uint&quot;, cbSize, stGTI.Ptr,0)   ;   DWORD   cbSize;
        hwnd := DllCall(&quot;GetGUIThreadInfo&quot;, &quot;Uint&quot;,0, &quot;Uint&quot;,stGTI.Ptr)
                 ? NumGet(stGTI.Ptr,8+PtrSize,&quot;Uint&quot;) : hwnd
    }
    return DllCall(&quot;SendMessage&quot;
          , &quot;UInt&quot;, DllCall(&quot;imm32\ImmGetDefaultIMEWnd&quot;, &quot;Uint&quot;,hwnd)
          , &quot;UInt&quot;, 0x0283  ;Message : WM_IME_CONTROL
          ,  &quot;Int&quot;, 0x006   ;wParam  : IMC_SETOPENSTATUS
          ,  &quot;Int&quot;, SetSts) ;lParam  : 0 or 1
}

IME_GET(WinTitle:=&quot;A&quot;)  {
    hwnd := WinExist(WinTitle)
    if  (WinActive(WinTitle))   {
        ptrSize := !A_PtrSize ? 4 : A_PtrSize
        cbSize := 4+4+(PtrSize*6)+16
        stGTI := Buffer(cbSize,0)
        NumPut(&quot;DWORD&quot;, cbSize, stGTI.Ptr,0)   ;   DWORD   cbSize;
        hwnd := DllCall(&quot;GetGUIThreadInfo&quot;, &quot;Uint&quot;,0, &quot;Uint&quot;, stGTI.Ptr)
                 ? NumGet(stGTI.Ptr,8+PtrSize,&quot;Uint&quot;) : hwnd
    }
    return DllCall(&quot;SendMessage&quot;
          , &quot;UInt&quot;, DllCall(&quot;imm32\ImmGetDefaultIMEWnd&quot;, &quot;Uint&quot;,hwnd)
          , &quot;UInt&quot;, 0x0283  ;Message : WM_IME_CONTROL
          ,  &quot;Int&quot;, 0x0005  ;wParam  : IMC_GETOPENSTATUS
          ,  &quot;Int&quot;, 0)      ;lParam  : 0
}

IME_TOGGLE() {
  current := IME_GET()
  IME_SET(!current)
}

IME_OFF() {
  IME_SET(0)
}

CapsLock::
  {
    IME_TOGGLE()
  }

~Esc::
  {
    IME_OFF()
  }
</code></pre></p></div><div class=post-footer><time>July 28, 2024</time></div></article><article><h2><a href=https://blog.nfurudono.com/posts/learn-authorization/>認可に入門 wip</a></h2><div><p><p><a href=https://www.osohq.com/academy>https://www.osohq.com/academy</a>
これを読んで認可に入門します。頑張るぞ〜！</p><h2><a href=#%e3%82%a4%e3%83%b3%e3%83%88%e3%83%ad id=イントロ class=anchor aria-hidden=true>イントロ</a></h2><p><a href=https://www.osohq.com/academy/authorization-academy>https://www.osohq.com/academy/authorization-academy</a></p><blockquote><p>Chapter II: What authorization is: how to organize your authorization code
Chapter III: Role-based access control: grouping permissions in your app into roles like User and Admin
Chapter IV: Relationship-based control: grouping permissions by relationship, like &ldquo;the creator of a post may edit that post&rdquo;
Chapter V: Authorization enforcement: once your app has decided to allow or deny access, what do you do with that decision?</p></blockquote><p>こんな感じとのこと。色々あるんだな。どれも気になるが、特にアプリケーションコードにどうやって統合していくかが気になるところかな。もれなく頑張らずに実現したい。</p><h2><a href=#what-is-authorization id=what-is-authorization class=anchor aria-hidden=true>What is Authorization?</a></h2><p><a href=https://www.osohq.com/academy/what-is-authorization>https://www.osohq.com/academy/what-is-authorization</a></p><p>具体例を挙げてWebアプリケーションにはレイヤがあって、それぞれのレイヤではどんな情報を取れて、どんな認可ができるかを議論する。</p><p>また、<a href="https://www.osohq.com/academy/what-is-authorization#authzlogic:~:text=4.%20Adding%20Authorization%20to%20an%20Application">&ldquo;4. Adding Authorization to an Application>&rdquo;</a>ではコードでの認可処理の書き方を比較する。</p><p>Naiveなアプローチだと以下のつらみがあると言っている。それな〜。</p><blockquote><p>That quickly gets difficult. As the number of places where you need to apply authorization increases, you end up duplicating the same logic. Making any change then requires us to remember every place our logic is duplicated.</p></blockquote><p>どうしたらいいんだ&mldr;</p><p><a href="https://www.osohq.com/academy/what-is-authorization#authzlogic:~:text=Formalizing%20Our%20Authorization%20Model">Formalizing Our Authorization Model</a> なるほどね（以下を認識する）。</p><ul><li>actor</li><li>action</li><li>resource</li></ul><p>UNIXのファイルにつけるパーミッションもこの考えで整理されてそう。どのユーザがどのファイルに対してどんな操作をするかを気にして権限の管理をしてるイメージ。</p><p>グループIDみたいなのはactorを発展させたものぽい。
sudoもその辺をいじるのかな。Capabilityはactionsの部分かな。それだけでもなさそうか。</p><p>上の三つ組を考えるメリットは二つあるとのこと。</p><ul><li>言語を共有できる</li><li>設計としてシンプル</li></ul><p>設計がシンプルと言ってるのは、以下のように認可のインターフェイスを持てそうということらしい。</p><pre><code class=language-haskell>isAllowed:: (Actor, Action, Resource) -&gt; Bool
</code></pre><p>こういうインターフェースを定めることで認可の周りで責務の境界を定められる。呼び出し側の責務にenforcement, 呼ばれる側の責務にdecisionという名前をここではつけている。</p><h3><a href=#enforcement id=enforcement class=anchor aria-hidden=true>Enforcement</a></h3><p>認可処理の結果をもとに何をするかを決めること。そもそも認可処理の呼び出しをするのもここの範囲だし、その結果アクセスがなければ403返すとかするのもここ。良いかどうかを気にしつつ、その結果どうするかを決めるのがここ。</p><h3><a href=#decision id=decision class=anchor aria-hidden=true>Decision</a></h3><p>基本はyes/noを返すやつ。さっきの関数の実装。警告とかは出したきゃ出せばいい。純粋である必要はなさそう。</p><h3><a href=#%e3%81%be%e3%81%a8%e3%82%81 id=まとめ class=anchor aria-hidden=true>まとめ</a></h3><p><a href="https://www.osohq.com/academy/what-is-authorization#authzlogic:~:text=5.%20Putting%20Everything%20Together">5. Putting Everything Together</a> がまとめだった。ここまでのメモが集約されてる感じ。</p><p>あとここには書かなかったけど、enforcementとかdecisionとかの話の後にenforcementをどこに実装する？みたいな話があるがマイクロサービスぽいアプリケーションを書いてないとそもそも問題にならなさそうで、一旦そこに僕は興味ないのでスルー。</p><h3><a href=#%e8%aa%b2%e9%a1%8c id=課題 class=anchor aria-hidden=true>課題</a></h3><p>アーキテクチャの話はなるほどって感じだが、まだ考えられることはたくさんある。</p><ul><li>権限が足りないときのエラーメッセージの返し方<ul><li>足りない場合は403だけじゃなくて何を足せば良いか知りたいとか</li></ul></li><li>管理者にアプリユーザがどんな権限を持ってるかを表示するとか</li><li>グループとか</li></ul><h2><a href=#role-based-access-control-rbac id=role-based-access-control-rbac class=anchor aria-hidden=true>Role-Based Access Control (RBAC)</a></h2><p><a href=https://www.osohq.com/academy/role-based-access-control-rbac>https://www.osohq.com/academy/role-based-access-control-rbac</a></p></p></div><div class=post-footer><time>June 24, 2024</time></div></article><article><h2><a href=https://blog.nfurudono.com/posts/semi-open-interval/>半開閉区間</a></h2><div><p><h2><a href=#%e5%8f%82%e7%85%a7 id=参照 class=anchor aria-hidden=true>参照</a></h2><p>コンピュータで区間処理するときは半開閉区間で持つことが多い気がしている。もはや信仰のレベルで身についているので自分一人で決めて終わりなときはそれで良いのだが、説明が必要なときに困る。そのときのために良さげな参照を集めておく。</p><ul><li>&ldquo;Always use [closed, open) intervals&rdquo;<ul><li><a href=https://fhur.me/posts/always-use-closed-open-intervals>https://fhur.me/posts/always-use-closed-open-intervals</a></li><li>半開閉区間の説明と閉区間のつらみ、半開閉区間のよさを語っている</li></ul></li><li>&ldquo;Google Cloud API設計ガイド&rdquo;<ul><li><a href="https://cloud.google.com/apis/design/design_patterns?hl=ja#representing_ranges">https://cloud.google.com/apis/design/design_patterns?hl=ja#representing_ranges</a></li><li>半開閉区間を使う必要があるとしている。C++とJavaがそうしてるぞと強調してるが理由は特に触れてない。</li></ul></li><li>&ldquo;時間の歩き方&rdquo;<ul><li><a href=https://blog.osa.in.net/time-tips/>https://blog.osa.in.net/time-tips/</a></li><li>半開閉区間というか、時間（時刻の区間としている）の持ち方の話。日付の区間なら閉区間もありと主張してる。</li></ul></li></ul><h2><a href=#%e4%bd%99%e8%ab%87 id=余談 class=anchor aria-hidden=true>余談</a></h2><p>何というか区間は連続な集合の２端点を指定して定まる部分集合であって、その全体からなる集合族を扱おうと思うと半開閉区間にしておくと綺麗というのも関係する？</p><p>区間は全順序集合の部分集合で、それらを体系的に考えようと思うと区間の集合の性質を考えるのが良いはず。つまり区間からなる族を考えると良さそう。</p><p>考える全順序集合が連続な集合なら、半開閉区間からなる族を考えると、任意の区間は有限個の区間の非交和として表現できる半開では無い区間の族ではこの性質は成り立たなさそう。漏れとダブりがないように区間を分割する必要は実用的に割とあってそれをきれいにできるのは半開閉区間だけということになる。</p><p>ググってみると集合半環という概念があるみたいで、それにこの性質が効いてるぽい。<a href=https://ja.wikipedia.org/wiki/%E9%9B%86%E5%90%88%E5%8D%8A%E7%92%B0>集合半環 (wikipedia)</a>をみると良さそう。</p><p>むずい。</p><h2><a href=#chatgpt%e3%81%ab%e6%95%b4%e7%90%86%e3%81%97%e3%81%a6%e3%82%82%e3%82%89%e3%81%a3%e3%81%9f id=chatgptに整理してもらった class=anchor aria-hidden=true>ChatGPTに整理してもらった</a></h2><p><a href=https://chatgpt.com/share/4c778bf6-f43a-4230-825d-398ad025a457>https://chatgpt.com/share/4c778bf6-f43a-4230-825d-398ad025a457</a></p><p>結構良い回答をもらえた。</p><h3><a href=#%e3%83%97%e3%83%ad%e3%82%b0%e3%83%a9%e3%83%9f%e3%83%b3%e3%82%b0%e3%81%a7%e5%8c%ba%e9%96%93%e3%82%92%e8%a1%a8%e7%8f%be%e3%81%99%e3%82%8b%e3%81%ae%e3%81%ab%e5%8d%8a%e9%96%8b%e9%96%89%e5%8c%ba%e9%96%93%e3%82%92%e7%94%a8%e3%81%84%e3%82%8b%e3%81%a8%e8%89%af%e3%81%84%e7%90%86%e7%94%b1%e3%82%92%e8%aa%ac%e6%98%8e%e3%81%97%e3%81%a6%e3%81%8f%e3%81%a0%e3%81%95%e3%81%84 id=プログラミングで区間を表現するのに半開閉区間を用いると良い理由を説明してください class=anchor aria-hidden=true>プログラミングで区間を表現するのに半開閉区間を用いると良い理由を説明してください</a></h3><p>プログラミングで区間を表現する際に半開閉区間（半開区間、片開区間とも言う）を用いると良い理由は、特に次のような点にあります：</p><ol><li><p><strong>直感的なインデックス操作</strong>:</p><ul><li>配列やリストなどのデータ構造において、インデックスは通常0から始まります。半開閉区間 <code>[start, end)</code> を使うと、<code>start</code> から <code>end-1</code> までのインデックスが含まれるため、範囲を扱う際に計算がシンプルになります。例えば、要素数が10の配列に対して <code>[0, 10)</code> という範囲を指定すると、全ての要素を含むことになります。</li></ul></li><li><p><strong>区間の連結が容易</strong>:</p><ul><li>半開閉区間は連結する際に便利です。例えば、 <code>[start1, end1)</code> と <code>[start2, end2)</code> という2つの区間を連結する場合、<code>end1</code> と <code>start2</code> が同じであれば、それらを連結して <code>[start1, end2)</code> とすることができます。このように、区間の端点が明確に分かれているため、エッジケースが少なくなります。</li></ul></li><li><p><strong>境界の一貫性</strong>:</p><ul><li>境界条件を処理する際、開区間の端点は含まれないため、範囲外アクセスのリスクが減少します。これにより、特にループ処理や再帰的なアルゴリズムの実装が一貫しやすくなります。</li></ul></li><li><p><strong>数学的な整合性</strong>:</p><ul><li>半開閉区間の表現は、数学的にも広く使われており、理論的な背景からも自然な表現です。例えば、集合の分割や区間の分割などで、一貫した扱いが可能です。</li></ul></li><li><p><strong>プログラミング言語のサポート</strong>:</p><ul><li>多くのプログラミング言語やライブラリが、半開閉区間をデフォルトでサポートしています。例えば、Pythonのリストスライスや、C++の標準ライブラリの範囲は、半開閉区間の形式を採用しています。このため、言語やライブラリの機能を活用する上で半開閉区間を使うのが自然です。</li></ul></li></ol><p>以上の理由から、プログラミングにおいて区間を表現する際には半開閉区間を用いることが一般的であり、推奨されます。</p><h3><a href=#%e6%95%b0%e5%ad%a6%e7%9a%84%e3%81%aa%e7%94%9f%e5%90%88%e6%88%90%e3%81%a7%e4%b8%80%e8%b2%ab%e3%81%97%e3%81%9f%e6%89%b1%e3%81%84%e3%81%a8%e3%81%82%e3%82%8a%e3%81%be%e3%81%99%e3%81%8c%e5%b0%82%e9%96%80%e7%9a%84%e3%81%ab%e3%81%af%e3%81%a9%e3%81%ae%e3%82%88%e3%81%86%e3%81%aa%e6%80%a7%e8%b3%aa%e3%81%8c%e6%88%90%e3%82%8a%e7%ab%8b%e3%81%a4%e3%81%ae%e3%81%a7%e3%81%97%e3%82%87%e3%81%86%e3%81%8b id=数学的な生合成で一貫した扱いとありますが専門的にはどのような性質が成り立つのでしょうか class=anchor aria-hidden=true>数学的な生合成で一貫した扱いとありますが、専門的にはどのような性質が成り立つのでしょうか？</a></h3><p>数学的な観点から見て、半開閉区間（例えば ([a, b))）を使用することにはいくつかの重要な性質があります。これらの性質により、一貫した扱いや直感的な操作が可能となります。以下にいくつかの重要な性質を挙げます：</p><ol><li><p><strong>区間の連結性</strong>:</p><ul><li>2つの半開閉区間 ([a, b)) と ([b, c)) を連結すると、新しい半開閉区間 ([a, c)) を得ます。これにより、連続する区間を簡単に扱うことができます。</li><li>例： ([1, 3)) と ([3, 5)) の連結は ([1, 5)) となります。</li></ul></li><li><p><strong>区間の分割性</strong>:</p><ul><li>半開閉区間 ([a, c)) を点 (b) で分割すると、2つの区間 ([a, b)) と ([b, c)) になります。このように、区間を分割する際の扱いがシンプルです。</li><li>例： ([2, 7)) を (5) で分割すると ([2, 5)) と ([5, 7)) になります。</li></ul></li><li><p><strong>一意性と包含関係</strong>:</p><ul><li>各点は1つの半開閉区間に一意的に属します。具体的には、点 (x) が区間 ([a, b)) に属するのは (a \leq x &lt; b) の場合のみです。このため、区間の包含関係を判断するのが容易です。</li><li>例： (x = 3) は ([1, 5)) に含まれますが、([3, 7)) にも含まれます。</li></ul></li><li><p><strong>空集合の扱い</strong>:</p><ul><li>半開閉区間において、区間 ([a, a)) は空集合となります。これにより、区間のサイズが負になることを避け、理論的な一貫性を保ちます。</li><li>例： ([4, 4)) は空集合として扱います。</li></ul></li><li><p><strong>順序性と計算の簡便性</strong>:</p><ul><li>半開閉区間は順序を持っているため、数直線上の位置関係を直感的に理解できます。これにより、範囲の計算や比較が簡単になります。</li><li>例： ([2, 5)) と ([5, 8)) の関係は明確に非重複であると分かります。</li></ul></li><li><p><strong>測度論との整合性</strong>:</p><ul><li>測度論（特にルベーグ測度）においても、半開閉区間は重要です。半開閉区間は測度が容易であり、特に区間の長さが (b - a) で計算できるため、実際の応用において便利です。</li></ul></li></ol><p>これらの性質により、半開閉区間は数学的に一貫した扱いが可能となり、プログラミングにおいても同様の利便性が得られます。このため、アルゴリズムやデータ構造の設計において半開閉区間を使用することが推奨されます。</p><h2><a href=#%e5%a5%bd%e3%81%8d%e3%81%aa%e5%8c%ba%e9%96%93%e7%99%ba%e8%a1%a8%e3%83%89%e3%83%a9%e3%82%b4%e3%83%b3 id=好きな区間発表ドラゴン class=anchor aria-hidden=true>好きな区間発表ドラゴン</a></h2><p><img src="/posts/semi-open-interval/nc355601_%E5%A5%BD%E3%81%8D%E3%81%AA%E6%83%A3%E8%8F%9C%E7%99%BA%E8%A1%A8%E3%83%89%E3%83%A9%E3%82%B4%E3%83%B3%E3%81%AE%E3%83%89%E3%83%A9%E3%82%B4%E3%83%B3.png?width=200px" alt=閉じたとこから開いたと〜こ！></p><p>好き好き大好き〜</p></p></div><div class=post-footer><time>May 29, 2024</time></div></article><article><h2><a href=https://blog.nfurudono.com/posts/rubykaigi2024/>RubyKaigi2024参加メモ</a></h2><div><p><p>RubyKaigi2024に参加したので、思ったことをメモしておきます。</p><p>参加したセッションはこちら: <a href=https://rubykaigi.smarthr.co.jp/2024/plans/d2350276-c631-4bdc-ad75-49e446e798a3>https://rubykaigi.smarthr.co.jp/2024/plans/d2350276-c631-4bdc-ad75-49e446e798a3</a></p><h2><a href=#shopify%e3%81%8c%e3%81%99%e3%81%94%e3%81%84 id=shopifyがすごい class=anchor aria-hidden=true>shopifyがすごい</a></h2><p>今回のセッションをいくつか聞いてShopifyのやり方に憧れるようになった。エンジニアリングをしていく上での姿勢として、課題に対して上流から対処しよう、みたいな箴言があってそれが心に残っている。
ShopifyのRuby周りのチームはまさにそれを地で行っていると今回のセッションを聞いて感じたそういうチームに所属して（作って？）良いエンジニアリングをしていきたいと思っていたのだが、これまでは具体的なイメージいを持っていなかった。</p><p>ShopifyのRubyチームによる貢献にはすでに自分が直接的に恩恵を受けているし、彼らがどういう思想で取り組んで具体的に何をしてきたか、これからどういう思想でやっていくかを生で聞くことができた。遠いけれども具体的に目標とする存在に出会えたことが今回の一番の収穫だったと思う。</p><h2><a href=#%e5%90%8d%e5%89%8d%e7%a9%ba%e9%96%93%e3%81%a8%e3%81%8b%e3%83%a2%e3%82%b8%e3%83%a5%e3%83%bc%e3%83%ab%e3%81%ae%e8%a9%b1%e9%a1%8c%e3%81%8c%e6%a5%bd%e3%81%97%e3%81%bf id=名前空間とかモジュールの話題が楽しみ class=anchor aria-hidden=true>名前空間とかモジュールの話題が楽しみ</a></h2><p>バージョンとかライブラリのインストールとか大変だしよく分からないのでスッキリする方向に進んでいきそうで楽しみ。セッションも普通に勉強になった。</p><h2><a href=#%e4%ba%ba%e3%81%a8%e4%bc%9a%e3%81%88%e3%81%a6%e3%82%88%e3%81%8b%e3%81%a3%e3%81%9f id=人と会えてよかった class=anchor aria-hidden=true>人と会えてよかった</a></h2><p>一方的に知っていた人もお互い初めましてな人もお話しできてよかった。今回存在を新たに認知した人ももちろんいて、いろんな人が色々やっていることとか、意外とコミッタ少ないこととか認知できて良い。
Rubyって人間が作ってるんだなと感じる。</p><p>現実味を感じる一週間でした。</p></p></div><div class=post-footer><time>May 18, 2024</time></div></article><article><h2><a href=https://blog.nfurudono.com/posts/elm-architecture/>ElmアーキテクチャをReactで実現する話</a></h2><div><p><h2><a href=#elm%e3%82%a2%e3%83%bc%e3%82%ad%e3%83%86%e3%82%af%e3%83%81%e3%83%a3 id=elmアーキテクチャ class=anchor aria-hidden=true>Elmアーキテクチャ</a></h2><p>リアクティブプログラミングの勉強をしていた頃にElm言語を知って好きになった（全然コード書いてないけど）。特徴はElmアーキテクチャにあると思っている。
Webアプリケーションの大体のフロントエンドアプリケーションはこう言うアーキテクチャで表現できるはず、みたいなことを言っていて、そのアーキテクチャが簡単なので気に入ったのだろう。</p><p>ユーザやAPIとやりとりをするアプリケーションなので、外界からの入力は当然ある。</p><p>また、それによって（のみ）アプリケーションの状態は変化する。アプリケーションが取りうる状態はアプリケーションに固有だし、どんなことがアプリケーションで起こって（入力としておきえて）、その結果どのような状態遷移をするかもアプリケーションに固有。なのでそれらはアプリケーションの実装者が決める。入力というかイベントがあって、それによってある状態から他の状態に遷移する、状態遷移系を定義するのはシンプルに思える。</p><p>状態が決まればそれの描画結果も決まるはず。もちろんDOMとかスタイルを当てたりとかして状態を描画結果に対応づける方法はそのアプリを作る人が定義する。描画というのは状態から描画結果への写像なのだ、と思うのがシンプルなポイント。</p><p>最初にあげた、外界からの入力は曲者。クリックとかレンダリングとかAPIの呼び出しとかは、知ったことではない感じがする。少なくともフロントエンドアプリケーションの範囲で意味を定義して実装するものではない。なのでその辺はElmのランタイムがいい感じに実装してインターフェイスを提供してくれる。そのインターフェイスを使いつつ、イベントを定義することになる。</p><h2><a href=#react%e3%81%a7%e5%ae%9f%e7%8f%be%e3%81%99%e3%82%8b%e8%a9%b1 id=reactで実現する話 class=anchor aria-hidden=true>Reactで実現する話</a></h2><p>Elmアーキテクチャは最高なんだけど、仕事のプロジェクトで使うとなると言語の選択はもっと資本主義ぽい判断が必要になって、TypeScriptとReact使うかという気持ちになる。</p><p>幸いなことにこれら二つでElmっぽいことはできるので、今の仕事では黙々とそれを進めている。
Reactで違うところは、Elmランタイムがなくてもうちょっと小さな部品がたくさんあって、それをいい感じに組み合わせて使うところだと思う。<code>useEffect</code> で頑張るとか。</p><p>そのあたりを頑張っているうちとかに、だんだんElmアーキテクチャっぽくするのが辛くなったりして辛い。みんなで強い気持ちでその方針に向かうのが良さそう。</p><p><a href=https://guide.elm-lang.org/>https://guide.elm-lang.org/</a> がElmのガイドでElmアーキテクチャを推してくれる。なのでみんな読んでほしい。</p><h2><a href=#elm%e3%82%a2%e3%83%bc%e3%82%ad%e3%83%86%e3%82%af%e3%83%81%e3%83%a3%e3%81%a8%e3%82%a8%e3%83%95%e3%82%a7%e3%82%af%e3%83%88%e3%83%8f%e3%83%b3%e3%83%89%e3%83%a9 id=elmアーキテクチャとエフェクトハンドラ class=anchor aria-hidden=true>Elmアーキテクチャとエフェクトハンドラ</a></h2><p>エフェクトハンドラで実現したい世界と、Elmアーキテクチャみたいな世界は重なる部分が多そうだと感じている。
Reactの開発者もuseContextはalgebraic effectなんだ！みたいなことを何処かで言っていた気もするし、誰しも思うことなんだろう。</p></p></div><div class=post-footer><time>April 18, 2024</time></div></article><article><h2><a href=https://blog.nfurudono.com/daily/2024-03-26/>2024-03-26</a></h2><div><p><p>イベントソーシング？と言うのかわからないけど、イベントを全部持っておけば現時点での状態はイベントを全部みて計算できるので永続化しなくて良くない？みたいな考え方がある（はず）。</p><p>イベントを解釈する遷移規則が変わらなければそうだけど、実際のソフトウェアではプログラムは継続的に変わっていくもので、イベントの解釈が変わらないこと（もっと言えば解釈できること）を保つのは大変そう。検証するためにリグレッションテストみたいにスナップショットを取っておいて、遷移規則が変わるたびに新しい解釈結果と比較すれば良いかもしれないw。</p><p>世間ではその辺どうしているんだろう。遷移規則が変わらない範囲でこのアーキテクチャを採用することでクリアしてるのか、そんなことは気にしないのか（あるいは気にならないのか）、他に上手いやり方があるのか。</p><p>このアーキテクチャを採用する目的にもよるか。</p></p></div><div class=post-footer><time>March 26, 2024</time></div></article><article><h2><a href=https://blog.nfurudono.com/posts/install-storybook-next/>Nextjsのプロジェクトにstorybookを導入してみた</a></h2><div><p><h2><a href=#%e3%82%84%e3%81%a3%e3%81%9f%e3%81%93%e3%81%a8 id=やったこと class=anchor aria-hidden=true>やったこと</a></h2><p><a href=https://github.com/naoyafurudono/timer/pull/1>https://github.com/naoyafurudono/timer/pull/1</a></p><p>このプルリクエストで頑張った。コミットメッセージにやったことは書いてある。</p><h2><a href=#%e5%8f%82%e8%80%83 id=参考 class=anchor aria-hidden=true>参考</a></h2><p>公式ドキュメントがしっかりしてそう。storybookが内部で使っているwebpackが<code>@</code> インポートを読めないみたいで、プラグインを入れる必要があった。</p><ul><li>storyの書き方: <a href=https://storybook.js.org/docs/writing-stories>https://storybook.js.org/docs/writing-stories</a></li><li>Next.jsへのインストール: <a href=https://storybook.js.org/docs/get-started/nextjs>https://storybook.js.org/docs/get-started/nextjs</a><ul><li>コマンド一発だった。便利。</li></ul></li><li><code>@</code> インポートが効かない問題の対処: <a href=https://qiita.com/sinnlosses/items/51e614570180c5f12e86>https://qiita.com/sinnlosses/items/51e614570180c5f12e86</a></li></ul></p></div><div class=post-footer><time>March 26, 2024</time></div></article><article><h2><a href=https://blog.nfurudono.com/daily/2024-03-20/>2024-03-20</a></h2><div><p><p>Webアプリケーションのテストをどう実施したものかと最近考えることが多い。
Webアプリは雰囲気で変更したいはずで（ソフトウェアって大体そう？）、またテストは長持ちしてほしいと思う。</p><p>テストではなんらかの仮定のもとで実装がある条件を満たすことを検証する。その仮定を上手に置くことがテスト戦略を決める人の腕の見せどころだろう。</p><p>例えば関数の単体テストをする場合は、そこに渡す実引数を仮定して、その関数の出力が意図した通りになることを検証するし、モックを使うならそのモック対象の振る舞いを仮定することになる。
e2eではユーザの操作を仮定するのだろう。</p><p>いろんな仮定の置き方とその結果実現できる検証内容がある気がしていて、安定した仮定（覆るとテストを直さないといけない）を選びつつ、そこがクリアできれば安心と思える検証内容を取ることがテスト戦略の設計で目指すことなのだと朝の東横線で思ったのだった。</p><p>で、そういうお得さを出せるように実装するのも大事なんだろうなと思っています。</p></p></div><div class=post-footer><time>March 20, 2024</time></div></article><article><h2><a href=https://blog.nfurudono.com/daily/2024-03-09/>2024-03-09</a></h2><div><p><h2><a href=#web%e3%83%95%e3%83%ad%e3%83%b3%e3%83%88%e3%82%a8%e3%83%b3%e3%83%89%e5%a4%a7%e5%a4%89%e3%81%9d%e3%81%86 id=webフロントエンド大変そう class=anchor aria-hidden=true>Webフロントエンド大変そう</a></h2><p>フロントエンドのモデルとRPCについて考えてみたい。</p><p>Webアプリケーションのフロントエンドがリッチなときに、テストをどんな感じで書こうかとか、そもそもアプリケーションをどんな感じで書こうかと悩む。僕は悩んでいる。</p><p>ユーザとページがあって、必要に応じてAPIを呼ぶ、その結果画面遷移が起きるくらいのものだったのが、しっちゃかめっちゃかしてきてそれを理解できるのはコードを書いた時空にいる人のみになる。</p><p>フロントエンド、副作用が多すぎるんだよな。レンダリング、人間、apiが絶対にいるのでそれは大変に決まっている。ログを気軽に残せないとか、エラーの出し方に気を使うのも辛い。Webアプリのバックエンドなら、しょうがないからログたくさん出して500返しとくかができるけど、フロントエンドで想定外が起きたときに、すまん壊れただけでは完結しない。</p><p>そもそも完結しないようなレイヤ分けが間違ってるのか？ネットワークの隔たりとレイヤ分割が一致してしまっているが、フロントエンドアプリケーションも気軽に壊れさせてあげてほしい。その内容をログに取ったりユーザに幸せになってもらうためのあれこれは他のレイヤでやるべきなんじゃないかと思ったりしました。</p><h2><a href=#%e3%81%8a%e9%85%92 id=お酒 class=anchor aria-hidden=true>お酒</a></h2><p>今お酒を飲んでいるし、今日会社で上司というか先輩というかがウイスキー好きだとしって酒モチベが高い。最悪だな。</p><p>お酒を楽しく飲める会をしたいね。酒の好きなところを語ると良さそうに感じたのでやります。</p><h3><a href=#%e3%81%8a%e3%81%84%e3%81%97%e3%81%84 id=おいしい class=anchor aria-hidden=true>おいしい</a></h3><p>まずいやつはまずいけど、美味しいやつは本当に美味しい。他の食べ物と同じで体調とか好みによるのだけど、摂取するもので酒が一番美味しいことはままある。ウイスキーとビールは特にそう感じる。日本酒とかワインはそんなに美味しくないと思います。</p><h3><a href=#%e3%82%a2%e3%83%ab%e3%82%b3%e3%83%bc%e3%83%ab%e3%81%8c%e5%85%a5%e3%81%a3%e3%81%a6%e3%82%8b id=アルコールが入ってる class=anchor aria-hidden=true>アルコールが入ってる</a></h3><p>アルコールを摂取するといわゆる常識を司る理性が外れて、あらゆる人と小学校の友達のように接することができるようになって楽しい。それっぽい言い方をした（？）けど、僕が小学生みたいな動きをしてるだけかも。</p><p>あと音楽聴くときにはアルコール入ってるともっと楽しめて好き。</p><h2><a href=#%e6%9c%80%e8%bf%91%e3%81%8a%e4%bb%95%e4%ba%8b%e6%a5%bd%e3%81%97%e3%81%84%e8%a9%b1 id=最近お仕事楽しい話 class=anchor aria-hidden=true>最近お仕事楽しい話</a></h2><p>インカレの1,2週間前くらいな感じがして楽しい。フルタイムで専門目な領域なのが痺れる。</p></p></div><div class=post-footer><time>March 9, 2024</time></div></article><article><h2><a href=https://blog.nfurudono.com/daily/2024-02-17/>2024-02-17</a></h2><div><p><p>glangに<a href=https://github.com/golang/go/issues/61405>generatorを入れようというプロポーザル</a>があって、試験的に実装されているみたい。いくつかのパターンがあるけど、<a href="https://go.dev/play/p/93W3jTQjBk0?v=gotip">だいたいこんな感じで使える (The Go Playground)</a>。</p><p>ジェネレータとして使われる関数は定義の段階では普通の関数と区別がつかないような構文定義をされている。コンパイラやランタイムの実装が気になるし、静的解析ツールが大変なことにならないかが心配。</p><p>気が向いたらプロポーザルを読もう。ジェネレータが引数にとる関数がブールを返すけど、どちらを返すかを誰が決めているかも気になる。</p><p>第一印象ではgolangには入らないで欲しいなと感じた。</p></p></div><div class=post-footer><time>February 17, 2024</time></div></article><article><h2><a href=https://blog.nfurudono.com/daily/2024-02-13/>2024-02-13</a></h2><div><p><p>今日1on1で教えてもらった。ロールモデルとして追っていく。<a href=https://scrapbox.io/kawasima/%E3%82%A4%E3%83%9F%E3%83%A5%E3%83%BC%E3%82%BF%E3%83%96%E3%83%AB%E3%83%87%E3%83%BC%E3%82%BF%E3%83%A2%E3%83%87%E3%83%AB>https://scrapbox.io/kawasima/%E3%82%A4%E3%83%9F%E3%83%A5%E3%83%BC%E3%82%BF%E3%83%96%E3%83%AB%E3%83%87%E3%83%BC%E3%82%BF%E3%83%A2%E3%83%87%E3%83%AB</a></p></p></div><div class=post-footer><time>February 13, 2024</time></div></article><article><h2><a href=https://blog.nfurudono.com/daily/2024-02-12/>2024-02-12</a></h2><div><p><h2><a href=#web%e3%82%a2%e3%83%97%e3%83%aa%e3%82%b1%e3%83%bc%e3%82%b7%e3%83%a7%e3%83%b3%e3%81%ae%e5%ae%9f%e8%a3%85%e6%96%b9%e9%87%9d%e3%82%92%e8%80%83%e3%81%88%e3%81%a6%e3%81%bf%e3%81%9f%e3%83%a1%e3%83%a2 id=webアプリケーションの実装方針を考えてみたメモ class=anchor aria-hidden=true>Webアプリケーションの実装方針を考えてみたメモ</a></h2><p>管理画面の設計について考えてみる。
Webアプリケーションでもろもろを設定する際のUI設計を考えている。</p><h3><a href=#%e3%82%b7%e3%83%b3%e3%82%b0%e3%83%ab%e3%83%a6%e3%83%bc%e3%82%b6%e3%81%ae%e8%a1%8c%e5%8b%95%e3%83%95%e3%83%ad%e3%83%bc id=シングルユーザの行動フロー class=anchor aria-hidden=true>シングルユーザの行動フロー</a></h3><p>設定の初期化時や更新時でフローが異なるはずだ。</p><p>初期化のタイミングでは、氏名やメールアドレスの設定・認証や、オプショナルな事項（決済情報とか追加の契約事項とか）の設定が挟まり、最後に確認してよければコミット、ダメなら修正する。</p><p>更新では最初の設定で気に食わなかったところを修正したり、追加の設定項目をいじったりするだろう。</p><p>それぞれのタイミングで何を設定させるかや、どれだけサクサク入力できるかによってユーザの体験が左右されそう。例えば初期では認証情報だけをコミットして、その他の情報は更新で登録する手もあれば、ファストバスを登録時に持ってきてしまって、8割のユーザが最短で使用を開始できるようにするパターンもあるだろう。</p><h3><a href=#%e3%83%95%e3%83%ad%e3%83%bc%e3%81%ae%e8%a7%a3%e9%87%88 id=フローの解釈 class=anchor aria-hidden=true>フローの解釈</a></h3><p>ユーザが行うそれぞれのフローはアプリケーションというかシステムにどのような影響を与えるだろうか。というよりも、ユーザがそれぞれのフローの結果及ぼせる作用をどのようにデザインすると良いだろうか。</p><p>この作用をデザインするにあたって、アプリケーションで表現するモデルがどんなであるかを明らかにしておくと良いはずで、そのモデルに対する作用の一つの実現方法としてユーザが操作するフローがある、と思えそう。</p><p>ユーザによる操作じゃない作用としては、決済が行われたとか権限が時間経過で失効したみたいな作用がありそう。</p><h3><a href=#%e3%83%87%e3%83%bc%e3%82%bf%e3%81%ae%e6%8c%81%e3%81%a1%e6%96%b9 id=データの持ち方 class=anchor aria-hidden=true>データの持ち方</a></h3><p>データにもいろいろありそう。モデルを表現するためのデータと、作用を実現するために一時的に保持するデータは異なる。</p><p>例えばユーザが登録されているか登録されていないかしかないモデルでは、メール認証中にはユーザが登録されていないけど、メール認証のためのトークンとかはサーバにデータとして持っていないといけない。</p><p>もちろん、そういう一時的な状態もモデルに含めるてもあるはず。RDBで実装する場合delete操作が激しくなりそうだけど。セッションキーもそうかな。セッションキーはモデルを表すデータに持つことは少なさそう。モデルの表現には含まれないログイン状態として扱われるイメージがある。揮発性のあるデータストアで保持しそう。</p><p>全部モデル化してしまうのが教科書的なんだろうな。汚いとわかるならあえて汚いことをやる必要はないだろう。</p><p>モデルではないけど、DBMSの都合について説明する記事があったので貼っとく<a href=https://jp.quora.com/%E3%82%BB%E3%83%83%E3%82%B7%E3%83%A7%E3%83%B3%E3%81%AE%E4%BF%9D%E5%AD%98%E3%81%AA%E3%81%A9%E3%81%ABRDBMS%E3%82%88%E3%82%8A%E3%82%82Redis%E3%82%84memcached%E3%81%AE%E3%82%88%E3%81%86%E3%81%AA-NoSQL%E3%81%8C%E5%90%91>セッションの保存などにRDBMSよりもRedisやmemcachedのような、NoSQLが向いているのは何故ですか？他にNoSQLの用途として向いている(いない)処理にはどのようなものがありますか？ (Quora)</a></p><p>TTLが欲しいよね、という感じか。確かにそもそもセッションキーにはTTLが欲しい気がするし、モデルを考える上でTTLはあまり意識したくない気もする（頭弾けそう）。</p><p>反面、TTLもうまく表現したら面白そうな気もするし、割と欠かせないんじゃないかという気もする。そのときに普段のモデルを表現するのに使うDBとTTLを複雑さを吸い取らせるために導入したDBが異なると不必要な複雑さが生じたりするかもなと思った。</p><h2><a href=#%e5%ae%b6%e3%81%ae%e3%82%a4%e3%83%b3%e3%83%86%e3%83%aa%e3%82%a2 id=家のインテリア class=anchor aria-hidden=true>家のインテリア</a></h2><p>今日たくさん寝て軽くランニングしたらなかなか幸せな時間を過ごせた。ただいまはそのクオリティが持続していない。夕食の目処が立っていないこととか部屋がちょっと寒いこと、姿勢が微妙なことが原因だろう。軽く座って作業する空間はやはり欲しい。机にがっつり向かうか後傾でノートパソコンを叩くか、床で作業するかの三択でQOLっぽい作業時間を過ごす空間がない。コメダで作業する姿勢を家でも取れるようにしたいイメージ。やはりベンチソファだと思うんだよな。僕のユースケースだとソファだけでなく机も欲しいことに気がついたのが今週末の成果。</p><p>あとは壁が寂しいことにも気がついた。なんか怖くないすっきりとした絵とか飾ればいいんだろうな。めんどいので誰かに決めてほしい。ああいうのってどこで売ってるんでしょうね。</p></p></div><div class=post-footer><time>February 12, 2024</time></div></article><article><h2><a href=https://blog.nfurudono.com/posts/fav-racket-features/>推し言語機能 Racket編</a></h2><div><p><p>この記事は<a href=https://adventar.org/calendars/8634>GMOペパボエンジニア Advent Calendar 2023 🎅会場</a>の19日の記事です！</p><p>昨日はyagijinさんのReactやってる人向けのSwiftUI入門でした。
Swiftに興味があるReact信者の僕のために書いてくれたのかと錯覚しました。これを期にSwift UI入門しようと思います。
Swift UIは双方向バインディングを採用しているとのことなので、Vueとの類似もありそうですね。</p><p>Reactを書いている時間は癒しの時間です。ところでReactは関数型言語からインスパイアされた機能が多いですよね。今日の記事はそんな関数型言語の中でも僕の好きなRacket言語の記事です。僕が一推しするRacketの言語機能を紹介します。</p><h2><a href=#%e5%89%8d%e6%9b%b8%e3%81%8d id=前書き class=anchor aria-hidden=true>前書き</a></h2><p>好きなRacket言語の言語機能を紹介します。ざっくりとした紹介なので、ここでの知識を人に話したりプログラミングで活用する前に、節々で参照する公式ドキュメントを参照してもらえると嬉しいです。</p><ul><li>契約</li><li>named let</li><li>動的束縛</li></ul><h2><a href=#%e5%a5%91%e7%b4%84 id=契約 class=anchor aria-hidden=true>契約</a></h2><p>ここでいう契約とは、関数の入出力の性質を関数定義の際に宣言しておくことで、関数を呼び出しを実行する際に入出力の値を検証し、違反していた場合にエラーを投げる言語機能のことです。余談ですが、契約と型は対応する概念です。契約の検証は実行時に行いますが、型検査はコンパイル時に行います。静的に型をつける言語では関数定義の際にその型を宣言することで、関数呼び出しのあるコードの入出力の方を検証し、違反する呼び出しを特定します。
ContractのRacket Guideを貼っておきます。<a href=https://docs.racket-lang.org/guide/contracts.html>https://docs.racket-lang.org/guide/contracts.html</a></p><p>ここでは <a href=https://docs.racket-lang.org/reference/function-contracts.html>https://docs.racket-lang.org/reference/function-contracts.html</a> の例をお借りして説明します。</p><pre><code class=language-racket>&gt; (define/contract (maybe-invert i b)
    (-&gt; integer? boolean? integer?)
    (if b ( -i) i))
&gt; (maybe-invert 1 #t)
-1
&gt; (maybe-invert #f 1)
maybe-invert: contract violation
  expected: integer?
  given: #f
  in: the 1st argument of
      (-&gt; integer? boolean? integer?)
  contract from: (function maybe-invert)
  blaming: top-level
   (assuming the contract is correct)
  at: eval:2:0
</code></pre><p>冒頭の <code>define/contract</code> で始まるS式では、関数定義をしつつ、その関数の契約を宣言します。二つの引数 <code>i</code>, <code>b</code> をとる関数 <code>maybe-invert</code> を定義していて、<code>b</code>がtruthyなら<code>-i</code>を返し<code>b</code>がfalthyなら<code>i</code>を返す関数として<strong>実装</strong>しています。この関数の契約は<code>(-> integer? boolean? integer?)</code> と宣言されています。これは<code>integer?</code>を満たす値と<code>boolean?</code>を満たす値を引数に取り、<code>integer?</code>を満たす値を返す関数である、と読みます。</p><p><code>(maybe-invert 1 #t)</code> という関数呼び出し式では第一引数に <code>1</code>, 第二引数に <code>#t</code> を渡しているので入力に関する契約を満たしていて、返り値は<code>-1</code>になるので出力に関する契約も満たしています。そのためエラーが出ずに何事もなく計算結果の　<code>-1</code>が表示されます。</p><p>一方で、 <code>(maybe-invert #f 1)</code> という関数呼び出しでは引数の順序を間違えて渡しているようです。第一引数にfalseを表す <code>#f</code> を渡しています。<code>#f</code> は <code>integer?</code> を満たさない（そういうふうに <code>integer?</code>が定義されている）のでRacket処理系は契約に違反している旨をエラーとして表示しています。</p><p>こういうのが契約です。ちゃんと確認していませんが、PHPで型注釈を書いた際にも実行時の検査が行われるそうなのでPHPは契約を言語機能としてサポートしているといえそうです。他にはD言語も契約をサポートします。</p><p>入力値のバリデーションはコードを書くときに当たり前に行う作業ですが、それをシステマチックに行うためのフレームワークを言語が提供してくれるのは魅力的だと思っています。また、契約は型システムや漸進的型つけとも密接に関わりがある楽しい概念です。</p><h2><a href=#named-let id=named-let class=anchor aria-hidden=true>named-let</a></h2><p>次はnamed-letです。これについても公式ドキュメントを貼っておきます。<a href=https://docs.racket-lang.org/reference/let.html#%28form._%28%28lib._racket%2Fprivate%2Fletstx-scheme..rkt%29._let%29%29>https://docs.racket-lang.org/reference/let.html#%28form._%28%28lib._racket%2Fprivate%2Fletstx-scheme..rkt%29._let%29%29</a></p><p>RacketやSchemeなどのLisp系言語で勉強しているとwhileやforは習いませんが、再帰を習います。例えば整数のリストを受け取って、その和を返す関数<code>sum</code>を定義するにはこんな感じで書きます。</p><pre><code class=language-racket>&gt; (define (sum lst)
          (if (nil? lst)
              0
              (+ (car lst) (sum (cdr lst)))))
&gt; (sum '(1 2 3 4 5 6 7 8 9 10))
55
</code></pre><p><code>nil?</code>はリストが空を判定し、<code>car</code>はリストの先頭要素をとる関数で、<code>cdr</code>はリストの先頭を除いた部分をとる関数です。先頭の値とそれ以降の和をたすことで、リスト全体の和を得ています。</p><p>このように再帰があればループはかけるのですが、関数を定義してその直後にその関数を呼び出す、そしてその後その関数は使わない、みたいなケースがしばしばあります。そういうときに役立つのがnamed-letです。以下のように再帰関数の定義と関数呼び出しを同時に行うことができます。</p><pre><code class=language-racket>&gt; (let sum ((lst '(1 2 3 4 5 6 7 8 9 10))
       (if (nil? lst)
           0
           (+ (car lst) (sum (cdr lst))))))
55
</code></pre><p>再帰関数を使ってループを書くことでループの中での再代入を避けることができます。そのためループ不変条件を把握するのが楽になります。そしてnamed-letを使うことで、不要な関数定義を省くことができます。スコープにある変数は少ないほど嬉しいです。ここだけで使う再帰関数なんだということが一目でわかります。あと書いてみるとわかるのですが、named-letを書くととても気分がいいです。</p><h2><a href=#%e5%8b%95%e7%9a%84%e6%9d%9f%e7%b8%9b id=動的束縛 class=anchor aria-hidden=true>動的束縛</a></h2><p>最後は動的束縛です。emacs lispの変数束縛は動的だということで有名ですし、最近だとReactのContextが動的束縛っぽいかなと思います。やはり公式ドキュメントのリンクを貼っておきます。<a href=https://docs.racket-lang.org/guide/parameterize.html>https://docs.racket-lang.org/guide/parameterize.html</a></p><p>誤解を恐れながらいうと、環境変数みたいなやつをコードの中で設定できる機能です。公式ドキュメントの例をそのまま貼り付けます。</p><pre><code class=language-racket>&gt; (parameterize ([error-print-width 5])
    (car (expt 10 1024)))
car: contract violation
  expected: pair?
  given: 10...
&gt; (parameterize ([error-print-width 10])
    (car (expt 10 1024)))
car: contract violation
  expected: pair?
  given: 1000000...
</code></pre><p>REPLで2回プログラムを実行しています。<code>(expt x y)</code> は <code>x</code> の <code>y</code> 乗です。それのcarを取ろうとしています（<code>car</code>はリストの先頭要素を返す関数でした）が、<code>(expt x y)</code>の計算結果は数値であってリストでないので<code>car</code>の契約に違反します。そのためエラーメッセージが表示されています。今回フォーカスしたいのは動的束縛です。<code>parameterize</code> で <code>error-print-width</code>の値をそれぞれの実行で <code>5</code> や<code>10</code>に指定しています。その結果表示されるエラーメッセージの幅が5になったり10になったりしています(<code>10...</code> と <code>1000000...</code>)。おそらくエラーメッセージを表示する関数の中で <code>error-print-width</code>が参照されているのでしょう。</p><p>このように関数を呼び出すタイミング側でその振る舞いを変えられるのが動的束縛の旨みです。関数の引数で渡す必要がないので、動的変数を参照する関数と設定する関数の間の関数たちが余分な引数を取らなくても良いわけです。</p><p>グローバル変数を使ってもこのような引数を介さない設定はできますが、動的束縛を使う方が衛生的です。例えば一つのプログラムの中でグローバル変数の値を変えたい場合、グローバル変数の値を書き換えることになります。これは悪名高い可変なグローバル変数を使うことを意味します。可変なグローバル変数は無関係に見えるプログラムの実行順序がクリティカルにプログラムの振る舞いを左右するのでよくないです。</p><p>一方で動的束縛では関数呼び出しごとに値を設定するため実行順序のことは気にしなくて良いです。値を設定した呼び出しの範囲下ではそれが反映されるし、その範囲外ではその設定は無効化されます。このように衛生的に、かつ疲れない形で広い範囲で参照する値を設定できることがグローバル変数と比較した際のメリットだと思います。</p><h3><a href=#%e3%82%a8%e3%83%95%e3%82%a7%e3%82%af%e3%83%88%e3%83%8f%e3%83%b3%e3%83%89%e3%83%a9%e3%81%a8%e3%82%a8%e3%83%95%e3%82%a7%e3%82%af%e3%83%88%e3%82%b7%e3%82%b9%e3%83%86%e3%83%a0 id=エフェクトハンドラとエフェクトシステム class=anchor aria-hidden=true>エフェクトハンドラとエフェクトシステム</a></h3><p>動的束縛される変数を参照する場合、呼び出し側の不慮の事故によって変数の定義もれでプログラムが正常に動作しないかもしれません。環境変数を設定し忘れるとアプリケーションが動かないのと同じです。こういう事故は実行する前、例えばコンパイルしたり型検査のタイミングで気がつけると嬉しいですよね。</p><p>Racketでこの課題を解決できるかは知らないのですが、エフェクトハンドラとエフェクトシステムを使えば型検査の中で解決できます！
その説明をしたい気持ちが溢れているのですが、そろそろ日を跨ぎそうなので興味がある方は僕に声をかけてくれると嬉しいです。</p><h2><a href=#%e3%81%82%e3%81%a8%e3%81%8c%e3%81%8d id=あとがき class=anchor aria-hidden=true>あとがき</a></h2><p>プログラミング言語の言語機能、いいですよね。言語設計者が思う表現のベストプラクティスが詰まっていて触れるたびに嬉しくなります。</p><p>明日のアドベントカレンダーは冷静沈着なTepiさんがTextのJetpack Composeで画像表示した話を書く予定とのことです。
Jetpack Composeは名前しか聞いたことがないので、新しい概念を見られそうで楽しみです！</p><p>それでは良いクリスマスを！</p></p></div><div class=post-footer><time>December 19, 2023</time></div></article><article><h2><a href=https://blog.nfurudono.com/daily/2023-10-28/>2023-10-28</a></h2><div><p><p>ジャンププラスの表示がどなっているか気になって開発者ツールでみたらなんかすごかった。アプリケーションのストレージにページをバラバラにしてパッチワークみたいにしたデータがあって、恐らくそれをいい感じに繋ぎ合わせて表示する感じで<a href=https://developer.mozilla.org/ja/docs/Web/HTML/Element/canvas>canvas要素</a>を使っているみたい。スクレイピングとかで漫画を引っこ抜かれないための仕組みなんだろうし、パッとわかるものではないだろうけど気になる。はてなのGigaViewrが使われているとのこと。ヒントとか開発話みたいなものが聞けないかなと思って<a href=https://developer.hatenastaff.com/entry/2022/06/15/173000>ポッドキャスト</a>を聞いている。</p></p></div><div class=post-footer><time>October 28, 2023</time></div></article><article><h2><a href=https://blog.nfurudono.com/daily/2023-10-27/>2023-10-27</a></h2><div><p><p><code>https</code> とかで通信をするときはローカルにインストールされているCA証明書を参照する。
ubuntuの場合 <code>/etc/ssl/certs/ca-certificates.crt</code> がそれで、適当に名前を変えるとhttpsでcurlできなくなる。</p><pre><code>🐧 curl https://pepabo.com -vvv
*   Trying 13.225.183.31:443...
* Connected to pepabo.com (13.225.183.31) port 443 (#0)
* ALPN, offering h2
* ALPN, offering http/1.1
* error setting certificate file: /etc/ssl/certs/ca-certificates.crt
* Closing connection 0
curl: (77) error setting certificate file: /etc/ssl/certs/ca-certificates.crt
</code></pre></p></div><div class=post-footer><time>October 27, 2023</time></div></article><article><h2><a href=https://blog.nfurudono.com/posts/2023-09/>2023-09振り返り</a></h2><div><p><p>今月はインカレの運営準備と仕事を頑張った。またカレーとボルダリングを始めた。</p><p>インカレでは人に仕事を回す仕事でしっかりキャパオーバーした経験をできた。おかげで価値観を少し変えることができて、瞬殺できるタスクはすぐに瞬殺するのが楽だと思えるようになったし、瞬殺できない仕事もなんとか小さくしようともがけるようになった。この辺りは仕事でも意識しているところで、二つのサンプルがうまいこと僕の中で補い合って学びを得る機械になってくれた形だと思う。どちらもちゃんとした人たちが一緒に仕事をしてくれてフィードバックもくれる環境だから実現しているのだと思う。感謝だし、この環境に身をおけた運と自分を褒めてあげたい。</p><p>カレーもオリエンテーリングと職場の人たちが相補的に絡み合って好きになり始めた。ボルダリングもそうか。今の僕は職場とオリエン界隈の二つのコミュニティに支えられて生活を営んでいるみたいだ。充実している。いいこと。</p><p>ここまではいわゆるソフトスキルみたいな仕事をする上での能力とか趣味の話だったけど、純粋な技術の話でいうとWebアプリケーション開発のレイヤが低めのところが（どのくらいかわからないけど）強くなった。Rackみたいな構成とかDNSの話（間接参照は偉大だ）、アーキテクチャの成長のさせ方とかを新たに腹落ちさせた。</p><p>10月は趣味を深めつつ、ソフトスキルっぽい面ではきっちり仕上げるところを重視する。ガッとやる。技術はネットワークとかを深められると嬉しい。趣味は今のを深めていく。ボルダリングは週2回いけるといいなと思う。</p></p></div><div class=post-footer><time>October 2, 2023</time></div></article><article><h2><a href=https://blog.nfurudono.com/posts/generate-slides-from-template/>GASでスライド生成</a></h2><div><p><p>Google Slidesで作成したテンプレートファイルに文字列を置換する形でスライドを生成するスクリプトをChat GPTに書いてもらったのでメモ。</p><pre><code class=language-aa>+--------------------------------+
|                                |
|  {{氏名}}                      |
|                                |
|                                |
|     {{住所}}                   |
+--------------------------------+
</code></pre><p>みたいなスライドを作って、</p><pre><code class=language-csv>氏名,住所
佐藤太郎,日本のどこか
田中一郎,東京のどこか
</code></pre><p>みたいなスプレッドシートでスクリプトを実行すると以下のようなスライドをテンプレのあるスライドに追記する。</p><pre><code class=language-aa>+--------------------------------+
|                                |
|  佐藤太郎                      |
|                                |
|                                |
|     日本のどこか               |
+--------------------------------+

+--------------------------------+
|                                |
|  田中一郎                      |
|                                |
|                                |
|     東京のどこか               |
+--------------------------------+
</code></pre><p>スクリプトは以下。</p><pre><code class=language-gas>function createSlidesFromSheet() {
  var slideId = 'ここにスライドのIDを入れる'
  var sheet = SpreadsheetApp.getActiveSpreadsheet().getActiveSheet();
  var data = sheet.getDataRange().getValues();
  
  var slide = SlidesApp.openById(slideId);
  var templateSlide = slide.getSlides()[0]; // テンプレートとして使う最初のスライドを取得
  
  var headers = data[0]; // ヘッダー行を取得

  // データ行をループ
  for (var i = 1; i &lt; data.length; i++) {
    var row = data[i];
    var newSlide = slide.appendSlide(templateSlide); // テンプレートスライドをコピー
    
    var shapes = newSlide.getShapes();
    for (var j = 0; j &lt; shapes.length; j++) {
      var shape = shapes[j];
      var text = shape.getText().asString();
      
      // スプレッドシートのヘッダーを参照して、対応するデータでプレースホルダーを置き換える
      for (var k = 0; k &lt; headers.length; k++) {
        var placeholder = '{{' + headers[k] + '}}';
        text = text.replace(placeholder, row[k]);
      }
      
      shape.getText().setText(text);
    }
  }
}

</code></pre></p></div><div class=post-footer><time>October 1, 2023</time></div></article><article><h2><a href=https://blog.nfurudono.com/daily/2023-09-09/>2023-09-09</a></h2><div><p><h2><a href=#%e8%a8%ad%e5%ae%9a%e3%83%95%e3%82%a1%e3%82%a4%e3%83%ab%e3%81%afjson%e6%b4%be id=設定ファイルはjson派 class=anchor aria-hidden=true>設定ファイルはjson派</a></h2><p>tomlもyamlも難しいので、みんなjsonを書けばいいのにと思う。
Goとか静的型付け言語とかが流行って、読みやすさの意義が重要視されている時代なはずなのに、設定ファイルは書きやすさとか、見栄えの良さが重視されていそうなフォーマットが人気なのが解せない。
jsonがナウいんじゃないかと思うし、好みとしてもjsonがいいなと思う。</p><p>jsonは誤解することが一番少なそうだし、みんな何が嫌なんだろう。編集がちょっとたいへんとか？
そんなに設定ファイルを編集している時点で大変なことになっているのだから、それは妥当な大変さ何じゃないかと思うのだけど。</p></p></div><div class=post-footer><time>September 9, 2023</time></div></article><article><h2><a href=https://blog.nfurudono.com/posts/contract-programming/>契約と型検査</a></h2><div><p><p>プログラミングの型検査・契約・テストについて書きます。お酒を飲みながら書きました。注意は払ったつもりですが、変なところがあるかもしれません。</p><ul><li>契約とは何か<ul><li>例を含める</li></ul></li><li>どんな嬉しさがあるか</li><li>型検査との兼ね合い</li></ul><h2><a href=#%e5%a5%91%e7%b4%84%e3%81%a8%e3%81%af%e4%bd%95%e3%81%8b id=契約とは何か class=anchor aria-hidden=true>契約とは何か</a></h2><p>契約 (contract) とはプラグラムの関数の入出力に関する規約のことです。例えば整数の割り算をする <code>div</code> 関数は、二つの整数を受け取って商を返す関数だとしましょう。このとき、入力の二つの値は</p><ol><li>どちらも整数</li><li>二つ目の整数は0ではない</li></ol><p>ことが求められます。また、整数の割り算を行なっているので、<code>div(a,b)</code> の値は例えば</p><ol><li><code>a</code> の絶対値以下であること</li></ol><p>が求められます（もっと細かい要求をしても良いでしょうが）。箇条書きで示したような <code>div</code> 関数について求められる性質のことを契約とよぶことが多いです。</p><p>ここまでで例を示しました。例のことは忘れて一旦抽象的な定義を試みましょう。契約は関数を呼び出す側と呼ばれる定義の間の約束事です。関数を<strong>正しく</strong>呼べば<strong>正しい結果</strong>を返すことを規定します。どんな呼び出しが正しくて、正しい呼び出しをされたと仮定とした上でどんな結果が正しいかを規定するのが<strong>契約</strong>です。</p><p>先ほどの例を考えると、 <code>div</code> 関数の第二引数に0を渡すのは呼び出し側の契約違反で、<code>div(168,4)</code> の結果が42にならないのは関数定義の契約違反です。契約は、関数呼び出しにおける呼び出し側と定義側との間の規約を表明し、検査します。</p><p>多くの言語でコードを書く際は、関数の冒頭で引数のチェックをして、呼び出し側の責任を追及するスタイルでコードを書くことになりがちです。言語によっては組み込みの機能でいい感じに契約を書いて、実行時に検査できます。
D言語とかRacketがいい例です。</p><p>例えばRacketだと、モジュールでエクスポートする関数を表明する箇所で、関数の契約を書きます。完全に雰囲気ですが、おそらくこんな感じで書くんじゃないかったかと思います。正確にはRacket GuideかRacket Referenceをご覧ください。</p><pre><code class=language-racket>#lang racket

(export
  (div (-&gt; (and int (lambda (x) (&lt; 0 x) )) int  int)))

...

(define (div a b)
  (/ a b))
</code></pre><h2><a href=#%e5%a5%91%e7%b4%84%e3%81%ae%e5%ac%89%e3%81%97%e3%81%95 id=契約の嬉しさ class=anchor aria-hidden=true>契約の嬉しさ</a></h2><p>契約を書いておくと何が嬉しいでしょうか。問題の切り分けが楽になることが嬉しいですね。<a href=https://dl.acm.org/doi/10.1145/3371133>Blame shifting</a>ができます。みなさん人生で一回は <code>Segmentation fault</code> とか <code>Null pointer exception</code> とか <code>car: cannot apply for nil</code> みたなエラーに遭遇したことがあるかと思います。これらのエラーは契約をちゃんと関数に書いていないから起きるはずで、まともなライブラリを使っていればあまりみないはずです。これらのエラーが出たときには割と深く絶望して、どの関数が悪さをしているか探す旅が始まります。</p><p>もし真面目に契約を書いていれば関数が許さないnilを受け取った時点で呼び出し側に責任があることを即座にエラーを起こしたり、変な結果を返しそうになったら返す直前に同様にエラーを起こします。</p><p>これが契約の嬉しさです。反対に、関数を動かして契約違反で怒られない限り、その契約を実装が遵守していることが保証されます。これもまた契約の嬉しさの一つです。契約はプロダクション環境で生きているドキュメントとして機能します。</p><p>テストとの違いは、契約は実行時に検査をすることが大きいでしょう。テストはテストを走らせるときにしか検証を行いませんが、契約は実行時にも検査を行います。プロダクション環境で関数を呼び出すときにも契約は検査されるのです。</p><h2><a href=#%e5%9e%8b%e6%a4%9c%e6%9f%bb%e3%81%a8%e3%81%ae%e5%85%bc%e3%81%ad%e5%90%88%e3%81%84 id=型検査との兼ね合い class=anchor aria-hidden=true>型検査との兼ね合い</a></h2><p>契約はいいものであることがわかったと思います。関数定義の性質を保証して、何かあれば<strong>すぐに</strong>検出し、何もなければ、すべてのそれまでの実行で違反したケースがないことを保証します。</p><p>この観点で見たときに、型検査はテストよりも契約に近しい存在だと言えるでしょう。型検査は、コンパイルのたびに型制約が満たされていることを検証します。健全な（まともな）型システムでは、型検査をパスしたプログラムは実行時に型エラーを起こさないことが保証されます
（この保証がある型システムのことを健全だというので順番は逆ですが）。型検査では、関数の入力として渡される値が、関数が期待する条件を満たすことを検査しますし、関数が返す値が宣言にあっていることも検査します。契約と対比させると、契約は実行時に検査を行う一方で、型検査はコンパイル時に行うという感じです。</p><p>逆にいうと、契約は型検査で静的にやろうとする検査を実行時まで遅延したものです。実行時には任意の計算をできるので表現力は契約の方が高いです。例えば引数の値が10と20の間である、みたいなことを検査するのは型検査では大変ですが、契約ならちょちょいのちょいです。</p><p>じゃあ契約だけでいいじゃないか、型検査なんてやめてしまえ！という話になるかというと、そういうわけにもいきません。型検査には契約にないよさがあります。</p><p>型検査の良さは静的に検証が済むことにあります。つまり、以下の二つを型検査は満たします</p><ol><li>全ての実行について、検証結果が成立する</li><li>プログラムを実行しないでも検証を行える</li></ol><p>まず一つ目について。契約やテストでは、実行した場合については動作を検証してくれますが、それとは違う値については特に保証をしてくれません。だから境界テストみたいな、人間が上手に動かす技法が使われるのでしょう。型検査では、ある程度検証内容を抽象的にしたり保守的にすることで、全ての実行に対する性質を保証します。
intが返る関数は決してfloatを返さないことを型検査では保証できます。</p><p>抽象化や保守的な検査を行う二つ目の恩恵として、実行しないでも検証できることが挙げられます。本番環境で動かさないとわからなかったり、テスト環境をせっせと用意する必要は、型検査では生じません。</p><h3><a href=#%e3%83%86%e3%82%b9%e3%83%88%e3%81%af%e3%81%84%e3%82%89%e3%81%aa%e3%81%84 id=テストはいらない class=anchor aria-hidden=true>テストはいらない？</a></h3><p>型検査や契約の有用性を主張してきましたが、それでもテストは必要です。実際に色々な具体的なケースで動かすことでわかることは多いでしょう。型検査は動かさないでもわかることを検証して、契約は動かしたらわかることを検証します。テストはプログラムを動かしてみて検証します。型や契約だけではプログラムを動かすことはありません。そこが大きな違いなはずです。</p><p>それでも全ての異常の検知をテストでまかなう必要もないはずです。契約や型検査は保証をする仕組みとして優秀です。基本的な保証は契約や型検査で済ませて、本当に際どいところをテストでカバーする、みたいな役割分担をすると幸せになれるんじゃないでしょうか。</p></p></div><div class=post-footer><time>August 31, 2023</time></div></article><article><h2><a href=https://blog.nfurudono.com/posts/dotfiles-setup/>dotfilesのセットアップスクリプトを書いた</a></h2><div><p><h2><a href=#%e5%8b%95%e6%a9%9f id=動機 class=anchor aria-hidden=true>動機</a></h2><p><a href=https://github.com/naoyafurudono/dotfiles/tree/main>dotfiles</a>をGitHubで管理しているのだが、今までは設定ファイルの管理だけで、インストールは手動で行なっていた。設定ファイルを使いまわせるだけでだいぶ便利なんだけど、コンテナ環境の中で作業したくなると、手動インストールに耐えられなくなる。そこで重い腰を上げてセットアップを自動化した。</p><h2><a href=#%e3%82%84%e3%81%a3%e3%81%9f%e3%81%93%e3%81%a8 id=やったこと class=anchor aria-hidden=true>やったこと</a></h2><h3><a href=#cli%e7%92%b0%e5%a2%83%e3%81%ae%e3%82%bb%e3%83%83%e3%83%88%e3%82%a2%e3%83%83%e3%83%97%e3%82%92%e7%b0%a1%e5%8d%98%e3%81%ab%e3%81%97%e3%81%9f id=cli環境のセットアップを簡単にした class=anchor aria-hidden=true>CLI環境のセットアップを簡単にした</a></h3><p><code>git</code> のインストールと以下の実行でok。
nvimとかfishとかcargoとかが入る。</p><pre><code class=language-sh>git clone https://github.com/naoyafurudono/dotfiles.git
bash dotfiles/setup.sh
</code></pre><h3><a href=#%e3%81%95%e3%82%89%e3%81%ab%e5%8b%95%e4%bd%9c%e7%a2%ba%e8%aa%8d%e3%81%ae%e3%81%9f%e3%82%81%e3%81%aedocker%e3%82%92%e7%94%a8%e3%81%84%e3%81%9f%e3%83%86%e3%82%b9%e3%83%88%e3%82%82%e6%9b%b8%e3%81%84%e3%81%9f id=さらに動作確認のためのdockerを用いたテストも書いた class=anchor aria-hidden=true>さらに動作確認のためのDockerを用いたテストも書いた</a></h3><p><a href=https://github.com/naoyafurudono/dotfiles/tree/main#test>test</a></p><p>arm環境かつubuntuだけでしか動かしていないが、dockerコンテナでセットアップスクリプトを動かして、正常に終了するかを確認するテストを書いた。</p><h2><a href=#%e6%b0%97%e3%81%ab%e3%81%aa%e3%82%8a%e3%81%94%e3%81%a8 id=気になりごと class=anchor aria-hidden=true>気になりごと</a></h2><p>この手のセットアップスクリプトのテストって、世の中ではどのようにテストしているんだろう。以下の難しさがテストを大変にしている気がする。</p><ul><li>環境依存な部分をうまく吸収する必要があること</li><li>インストール失敗の判定が難しいこと</li></ul></p></div><div class=post-footer><time>August 17, 2023</time></div></article><article><h2><a href=https://blog.nfurudono.com/daily/2023-07-29/>2023-07-29</a></h2><div><p><p>ARM64でいろんなサイズの整数の足し算をする方法を整理する。サイズごとに演算が用意されているわけではなく、レジスタの指定方法（x,wの使い分け）や、レジスタのコンテンツをいい感じにすることで、
byte, half, word, double wordの足し算を実現する（と思ってよさそう）。</p><ul><li>レジスタどうしの足し算では、destinationとその他の二つのsourceレジスタのサイズが同じじゃないといけない。結果のサイズがdouble wordならXnを使えばいいし、word以下ならWnを使う。</li><li>レジスタのコンテンツをいい感じにする方法は二つありそう<ul><li>適当なマスクとandを取る</li><li>専用の命令を使う。二種類観測した。<ul><li><a href="https://developer.arm.com/-/media/Arm%20Developer%20Community/PDF/Learn%20the%20Architecture/Armv8-A%20Instruction%20Set%20Architecture.pdf?revision=ebf53406-04fd-4c67-a485-1b329febfb3e">Armv8-A Instruction Set Architecture</a>が優しい。7.4節Extension and saturationに説明がある</li><li>一つ目は拡張命令を使う方法。符号{あり,なし}と拡張前のサイズについて、それぞれ定義された拡張命令を使うと、destinationレジスタにsourceレジスタを拡張したビット列がセットされる。</li><li>二つ目は足し算で追加の引数として拡張方法を指定する方法。拡張命令と似たような感じのenumが定義されていて、それをadd命令のsourceレジスタの後にしていすると第二sourceレジスタを指定した方法で拡張した上で足し算する。</li></ul></li></ul></li></ul><h2><a href=#%e3%81%94%e9%a3%af id=ご飯 class=anchor aria-hidden=true>ご飯</a></h2><p>朝はお茶漬けを久しぶりに食べた。朝にお米を食べようと思うと、やっぱりお茶漬けがいい。子供の頃に抱いた感覚が長持ちしている。一時期パンに手を出したこともあったけど、なかなか難しい。食パンは口の中の水分を持っていくので惣菜とかが一緒にないとちょっと難しい。小倉トーストとかは好きなので、全くダメというわけではないと思うのだけど。</p></p></div><div class=post-footer><time>July 29, 2023</time></div></article><article><h2><a href=https://blog.nfurudono.com/daily/2023-07-22/>2023-07-22</a></h2><div><p><h2><a href=#%e3%81%b5%e3%81%ab%e3%82%83%e3%81%a3%e3%81%a8%e3%81%97%e3%81%a6%e3%82%8b id=ふにゃっとしてる class=anchor aria-hidden=true>ふにゃっとしてる</a></h2><p>コンパイラの実装で、次はポインタ算術をやる。演算子がオーバーローディングされているので型検査が必要。今は環境とかのデータ構造を設計する気力がなくて、パソコンを前にふにゃっとしている。お昼ご飯食べたら考える。</p><p>興味本位でコンパイルしたプログラムの実行速度を測ってみた。時間計算量が試数時間なfibの実装（あのみんな大好きなナイーブなやつ）で、
fib(40)を計算してみた。自作コンパイラだとuser時間が1.3secくらいなのに対して、
gccのO3でuser時間が0.3secくらいだった。
O3を指定しないと（多分O2）0.5secくらい。
Inliningとかは効かないだろうし、ループ周りでの最適化もできないはず。スタックマシンではなくレジスタマシンとして動かすことで（無駄なpush/popを排除することで）
O2くらいの速さになってる感じかな。
O3では何が早くなってるんだろう。気が向いたら調べるか、実装するかしたい。</p><h2><a href=#%e3%81%8c%e3%82%93%e3%81%b0%e3%81%a3%e3%81%9f id=がんばった class=anchor aria-hidden=true>がんばった</a></h2><p>お昼を食べて買い物に行ったあと、型検査器を実装した。がんばった。
strcmpがboolを返すと思い込むやつをやって時間を溶かした。ランニングをしてオーバーロードに取り組む。今はintもポインタも64bitにしているけど、abiをみたらintは32bitっぽいので合わせる。オーバーロードは楽しそうだけどintを32bitにするのが面倒。
ASTに型を行き渡らせたので難しくはないはず。</p><p>買い物ではズボンを買いに行った。涼しい長ズボンが欲しかったので。初めて買う感じのやつを変えて満足している。サンダルも欲しかったけど、僕の期待が矛盾していることに気がついたので断念。来年は期待を変えられることを願って今年はスニーカを履き続ける。</p><h2><a href=#%e5%8b%95%e7%9a%84%e6%9d%9f%e7%b8%9b%e3%81%8c%e6%ac%b2%e3%81%97%e3%81%84 id=動的束縛が欲しい class=anchor aria-hidden=true>動的束縛が欲しい</a></h2><p>Cとかその辺の関数型言語を使っていると欲しくなる言語機能第1位は動的束縛だという説を提唱したい。代数的エフェクトほどのことを普段使いに人類は求めているとは僕には思えなくて
（普段使いと言ったのは、凝った仕組みを作る場合はのぞきたい気持ちの表れ）<a href=https://docs.racket-lang.org/guide/parameterize.html>動的束縛</a>が欲しいんじゃないだろうか。オブジェクト指向でインスタンス変数を使うのもこの用途が多いんじゃないかと勝手に思っているんだけどどうだろう。</p><p>とにかく、動的束縛が欲しい。動的束縛はいいぞの会を結成するまである。</p><h2><a href=#%e3%82%ad%e3%83%bc%e3%83%9c%e3%83%bc%e3%83%89%e3%81%ae%e4%b8%8d%e8%aa%bf id=キーボードの不調 class=anchor aria-hidden=true>キーボードの不調</a></h2><p>Uを叩くとメチって音がする。髪の毛でも入り込んでしまったかもしれない。割とストレス。</p></p></div><div class=post-footer><time>July 22, 2023</time></div></article><article><h2><a href=https://blog.nfurudono.com/daily/2023-07-21/>2023-07-21</a></h2><div><p><h2><a href=#%e8%87%aa%e4%bd%9cc%e3%82%b3%e3%83%b3%e3%83%91%e3%82%a4%e3%83%a9%e3%81%ae%e9%80%b2%e6%8d%97 id=自作cコンパイラの進捗 class=anchor aria-hidden=true>自作Cコンパイラの進捗</a></h2><p><a href=https://github.com/naoyafurudono/comp>https://github.com/naoyafurudono/comp</a></p><p>早いもので作り始めてから2週間たったみたい。もっとサクサク進むと思っていたのだけど、しばらく楽しめそう。</p><p>自作CコンパイラでCのプログラムの一部をコンパイルできるようになった。これまでは変数宣言をできなかったので型宣言のあるmain関数を読めなかったが、
intだけ許容するようになったので、初めてCのプログラムをコンパイラが受け付けたことになる。</p><p>こんなコードをコンパイルすると、</p><pre><code class=language-c>int main()
{ 
  int a; int b; int i;
  a=0; b=1; i=0;
  while(i &lt; 10)
  { 
    int t; 
    t=a+b; a=b; b=t; 
    i=i+1; 
  }
  return a;
}
</code></pre><p>こんなアセンブリを吐く。
SSAみたいな中間表現を挟んでレジスタ割り付けを真面目にやるのはいつがいいんだろうか。</p><pre><code class=language-arm64>.globl _main
.text
.balign 4
_main:
    stp x29, x30, [SP, #-16]!
    mov x29, SP
    sub SP, SP, #32
    mov x0, #-16
    str x0, [SP, #-16]!
    mov x0, #0
    str x0, [SP, #-16]!
    ldr x0, [SP], #16
    ldr x1, [SP], #16
    str x0, [x29, x1]
    str x0, [SP, #-16]!
    mov x0, #-24
    str x0, [SP, #-16]!
    mov x0, #1
    str x0, [SP, #-16]!
    ldr x0, [SP], #16
    ldr x1, [SP], #16
    str x0, [x29, x1]
    str x0, [SP, #-16]!
    mov x0, #-32
    str x0, [SP, #-16]!
    mov x0, #0
    str x0, [SP, #-16]!
    ldr x0, [SP], #16
    ldr x1, [SP], #16
    str x0, [x29, x1]
    str x0, [SP, #-16]!
.L0:
    mov x1, -32
    ldr x0, [x29, x1]
    str x0, [SP, #-16]!
    mov x0, #10
    str x0, [SP, #-16]!
    ldr x1, [SP], #16
    ldr x0, [SP], #16
    cmp x0, x1
    cset x0, lt
    str x0, [SP, #-16]!
    ldr x0, [SP], #16
    cbz x0, .L1
    mov x0, #-40
    str x0, [SP, #-16]!
    mov x1, -16
    ldr x0, [x29, x1]
    str x0, [SP, #-16]!
    mov x1, -24
    ldr x0, [x29, x1]
    str x0, [SP, #-16]!
    ldr x1, [SP], #16
    ldr x0, [SP], #16
    add x0, x0, x1
    str x0, [SP, #-16]!
    ldr x0, [SP], #16
    ldr x1, [SP], #16
    str x0, [x29, x1]
    str x0, [SP, #-16]!
    mov x0, #-16
    str x0, [SP, #-16]!
    mov x1, -24
    ldr x0, [x29, x1]
    str x0, [SP, #-16]!
    ldr x0, [SP], #16
    ldr x1, [SP], #16
    str x0, [x29, x1]
    str x0, [SP, #-16]!
    mov x0, #-24
    str x0, [SP, #-16]!
    mov x1, -40
    ldr x0, [x29, x1]
    str x0, [SP, #-16]!
    ldr x0, [SP], #16
    ldr x1, [SP], #16
    str x0, [x29, x1]
    str x0, [SP, #-16]!
    mov x0, #-32
    str x0, [SP, #-16]!
    mov x1, -32
    ldr x0, [x29, x1]
    str x0, [SP, #-16]!
    mov x0, #1
    str x0, [SP, #-16]!
    ldr x1, [SP], #16
    ldr x0, [SP], #16
    add x0, x0, x1
    str x0, [SP, #-16]!
    ldr x0, [SP], #16
    ldr x1, [SP], #16
    str x0, [x29, x1]
    str x0, [SP, #-16]!
    b .L0
.L1:
    mov x1, -16
    ldr x0, [x29, x1]
    str x0, [SP, #-16]!
    ldr x0, [SP], #16
    mov SP, x29
    ldp x29, x30, [SP], #16
    ret
    mov SP, x29
    ldp x29, x30, [SP], #16
    ret
</code></pre></p></div><div class=post-footer><time>July 21, 2023</time></div></article><article><h2><a href=https://blog.nfurudono.com/daily/2023-07-19/>2023-07-19</a></h2><div><p><p><a href=https://github.com/naoyafurudono/naoyafurudono.github.io>実装しているCコンパイラ</a>
で関数定義をできるようになった🎉。今までも既存のコンパイラで作ったオブジェクトファイルとリンクすれば呼び出すことはできていたが、自分で定義した関数がある程度ちゃんと呼べるようになった。</p><p>まだ型が<code>long</code>しかないので道は長い。</p><h2><a href=#fzf%e3%82%92%e4%bd%bf%e3%81%a3%e3%81%9f%e3%81%82%e3%82%8c%e3%81%93%e3%82%8c id=fzfを使ったあれこれ class=anchor aria-hidden=true>fzfを使ったあれこれ</a></h2><p><a href=https://github.com/atweiden/fzf-extras>https://github.com/atweiden/fzf-extras</a> ここが良さげ。</p></p></div><div class=post-footer><time>July 19, 2023</time></div></article><article><h2><a href=https://blog.nfurudono.com/daily/2023-07-17/>2023-07-17</a></h2><div><p><p>Cコンパイラをarm macで実装しているのだけど、<code>a=b=0; return b;"</code>みたいなコードがセグメント違反で落ちる。
lldbで調べてみると、main関数は正しい値を<code>w0</code>にセットして<code>ret</code>できていそうなんだけどその後の動的リンクされたコードでエラーが発生しているみたい。設定する値を変えるとエラーにならずに実行が終了する。謎である。</p><p>ABIを守っていないのが悪さをしているかも。</p><h2><a href=#%e4%b8%89%e9%80%a3%e4%bc%91 id=三連休 class=anchor aria-hidden=true>三連休</a></h2><p>土曜日はパソコンしてた。お昼頃に連絡が来ていたことに気がついて、翌日の約束をした。</p><p>勢いで日曜日は丹沢に行くことになって、卒業ぶりに会った友達と2時間くらいの登山をしてきた。コースタイムが4時間だったのでいいペースだった。最近登山をしておらずペースタイム通りの時間でいく想定をしてしまっており、思ったよりもあっさりと終わってしまった。友達の靴が下山した後の道で壊れてしまったのでサンダルを貸して歩くことに。風呂に入ってからはま寿司で3時間くらいお茶を飲んで帰宅した。</p><p>日曜日は海の日なので海を目指して部活の後輩と走った。天王洲アイルが海の近くだったのでそこまで行ったのだが、思ったよりも海っぽくなかったのが残念。久しぶりに走ったので走り始めがだいぶ辛かった。</p><p>久しぶりの人と会うと時間の流れを感じる。</p></p></div><div class=post-footer><time>July 17, 2023</time></div></article><article><h2><a href=https://blog.nfurudono.com/posts/arm64/>arm64のメモ</a></h2><div><p><p><a href=https://github.com/naoyafurudono/comp>Cコンパイラを実装する</a>ためにarm64のことを調べている。この記事はそのメモ。</p><h2><a href=#%e5%85%ac%e5%bc%8f%e3%83%89%e3%82%ad%e3%83%a5%e3%83%a1%e3%83%b3%e3%83%88 id=公式ドキュメント class=anchor aria-hidden=true>公式ドキュメント</a></h2><p>よくあるソフトウェアのライブラリについているドキュメントとは毛色が違う。</p><ul><li><a href=https://developer.arm.com/documentation/den0024/a/An-Introduction-to-the-ARMv8-Instruction-Sets>Armv8-A Instruction Set Architecture</a>が優しい<ul><li><a href="https://developer.arm.com/-/media/Arm%20Developer%20Community/PDF/Learn%20the%20Architecture/Armv8-A%20Instruction%20Set%20Architecture.pdf?revision=ebf53406-04fd-4c67-a485-1b329febfb3e">PDF版もある</a>。空白多めのシングルカラム39ページなのでサクッと読める。最初に読んでおくと幸せになれたかも。</li></ul></li><li><a href=https://github.com/ARM-software/abi-aa/releases/download/2023Q1/aapcs64.pdf>Procedure Call Standard for the Arm® 64-bit Architecture (AArch64) (pdf)</a>がCコンパイラを実装するときに気になる細かいことをコンパクトにまとめてそうな印象。</li><li>上のドキュメントを含む<a href=https://github.com/ARM-software/abi-aa/releases>公式のリンク集がある</a></li></ul><h2><a href=#%e3%83%84%e3%83%bc%e3%83%ab id=ツール class=anchor aria-hidden=true>ツール</a></h2><p>Arm macを使っている人の話です。</p><ul><li>既存コンパイラがはくアセンブリを覗く方法<ul><li>アセンブリをはく: <code>gcc -O0 -S</code></li><li>ディスアセンブル: <code>otool -vVt</code></li></ul></li><li>デバッガで調査する<ul><li>lldbが使える</li><li>エラー箇所の特定に便利</li><li>ドキュメント<ul><li><a href=http://www.den.t.u-tokyo.ac.jp/ad_prog/debug/>入門記事（東大の講義ページ）</a>
何もわからんくなったら{ここに立ち返る|ここから始める}のが良さそう</li><li><a href=https://lldb.llvm.org/use/tutorial.html>公式チュートリアル</a>: ちょっと読んだ。真面目に勉強するなら導入に良さそう</li></ul></li></ul></li></ul><h2><a href=#%e6%84%9f%e6%83%b3 id=感想 class=anchor aria-hidden=true>感想</a></h2><p>アセンブリ命令って割と体系的になってなくてやばいイメージがあったけど、
arm64は秩序がある程度あるように感じている。まだ深淵を覗けていないだけかもしれないが。汎用レジスタの名前が簡単なことが大きいかもしれない。</p></p></div><div class=post-footer><time>July 15, 2023</time></div></article><article><h2><a href=https://blog.nfurudono.com/daily/2023-07-08/>2023-07-08</a></h2><div><p><h2><a href=#%e3%83%8e%e3%83%bc%e3%83%88%e3%83%91%e3%82%bd%e3%82%b3%e3%83%b3%e3%81%ae%e6%81%a9%e6%81%b5 id=ノートパソコンの恩恵 class=anchor aria-hidden=true>ノートパソコンの恩恵</a></h2><p>椅子に座るほどの元気がなくてもパソコン座れるので楽しい。気軽にコーディングできる。</p><h2><a href=#c%e3%82%b3%e3%83%b3%e3%83%91%e3%82%a4%e3%83%a9%e3%81%ae%e9%80%94%e4%b8%ad%e7%b5%8c%e9%81%8e id=cコンパイラの途中経過 class=anchor aria-hidden=true>Cコンパイラの途中経過</a></h2><p>cコンパイラ実装するやつは、今からローカル変数の定義に入るところ。ここまでで、四則演算と比較をコンパイルできるようになった。
armでやっているのだが今のところそんなにx86と違わない。
push/popでスタックポインタがarmだと16byte境界にしか設定できないとか、割り算がシンプルだとかくらいの違いしか観測していない。</p><p>そういえばenumは値だった。変数名みたいにコンパイラがよしなにするやつというイメージが強くて戸惑ってしまった。今回初めてcファイルを頭を使って分割した。定義と宣言の違いを認識して活用する日強がある。</p><p>パーサ前はサクッとできて、コード生成も一応形にはしたのだが、生成したアセンブリをアセンブルして実行するとセグフォで落ちる。
x29にSPをmovするだめみたい。x29以外にしたらどうだろうと思い、x9を使ってみたらセグフォのタイミングが変わった。ちゃんと追ってないので明日起きたら追ってみよう。</p><p>とりあえず、armのマニュアルを落とした。めちゃ長いけど良さげ。ソフトウェアと違って、ライブラリが無い分こういうふうに一つのでかいドキュメントが提供されるのはなんかそうなんだろうな、という感じがする。Web版よりも検索しやすいのはいいこと。今日はこれくらいにしよう。</p><p>ちなみに今はラフロイグ10年を飲んでいる。いいでしょ。</p><h2><a href=#%e6%9c%80%e8%bf%91%e6%9c%ac%e3%82%92%e8%aa%ad%e3%82%80%e9%87%8f%e3%81%8c%e6%b8%9b%e3%81%a3%e3%81%a6%e3%81%84%e3%82%8b id=最近本を読む量が減っている class=anchor aria-hidden=true>最近本を読む量が減っている</a></h2><p>動画を見たり手を動かすことが増えた。あとは仕事でドキュメントを読む時間が増えて、活字が安定供給されているのが影響しているかも。</p><p>とはいえ仕事で読むドキュメントは、読み物としてはそんなに面白く無いことが多い。その分手を動かしてものを作るのが楽しいからいいのだけど、小説を読む楽しみとか、心に響く論文を読む感覚が足りない。小説とか論文とかに飽きてきたのはあるのかもしれない。残念ながら深掘りできる人間ではなかったのか。広く学ぶ好奇心とかがあるわけでもないのだけど。</p><h2><a href=#%e3%83%a6%e3%83%bc%e3%83%95%e3%82%a9%e3%82%92%e7%ac%ac%e4%ba%8c%e3%82%b7%e3%83%bc%e3%82%ba%e3%83%b3%e3%81%be%e3%81%a7%e8%a6%8b%e7%b5%82%e3%81%88%e3%81%9f id=ユーフォを第二シーズンまで見終えた class=anchor aria-hidden=true>ユーフォを第二シーズンまで見終えた</a></h2><p>話題になっていたのは当時から認識していたが、ずっとみていなかったユーフォを見た。特に第一シーズンが好きで、上手くなりたい、のあたりが響いている。僕がある程度まじめに考えて方向性を決めるときには、上手くなりたいが奥底に合ったなと再認識させられた。</p><p>頑張っているときはわからないけど、少し環境が変わると上手くなっていたことがわかる。加えて、そのときになって周りから、それが上手い人というラベルを貼られることに気がつくし、振り返ると上手くなったなと気がつく。上手くなりたいと憧れた、あの頃の自分からすると今の自分は割といい線行ってるんじゃないかと思う側面がある。全部が全部上手くなってるわけじゃないけど。</p><p>この頃は、上手くなった先に何があるのかということをちらほら考える。幸せがあると思っていたのだが、実際のところはどうなんだろうか。今は体力と好奇心と自尊心がボトルネックになって、ボトルネックになってることがそれらを削っていくんじゃないかと思う。また、自分が上手くなるのにかかる時間が実感を通して認識できたことで、自分の限界を認識するようになるのだろう（僕はまだ認識してない。アカデミアのスターにも総理大臣にも、経済界のドンにも縁があればなれると思ってる。巡り合わせに依ると思ってる時点で擦れているのかもしれないけど）。</p><p>僕はアニメを見て、アニメの感想ではなく内省をアウトプットしたくなってしまうので自分から進んでアニメの話をしたくならない。聞かせるのは悪いなという気持ちとなんか恥ずかしい気持ちがある。日付が変わってしまいそうなのでこのくらいで。ところでフロムザバレルは甘い。干し芋っぽい風味がする。</p><h2><a href=#%e9%9b%91%e8%ab%87 id=雑談 class=anchor aria-hidden=true>雑談</a></h2><p>明日はランニングしよう。午前中に走ってみる。</p></p></div><div class=post-footer><time>July 8, 2023</time></div></article><article><h2><a href=https://blog.nfurudono.com/daily/2023-07-02/>2023-07-02</a></h2><div><p><h2><a href=#%e6%9c%ab%e5%b0%be%e4%bd%8d%e7%bd%ae id=末尾位置 class=anchor aria-hidden=true>末尾位置</a></h2><p>末尾位置での関数呼び出しは、継続渡し形式ではcaleeに渡す継続をcallerが大きくしないで、
callerのcallerから渡されたものをそのまま渡す点で特徴的だ。レジスタマシンではcallerのスタック領域をcalleeが上書きして使うことに対応するのだろう。こういうcall命令はどのくらい実用されているのだろうか。</p><p><a href=https://www.sigbus.info/compilerbook>https://www.sigbus.info/compilerbook</a> これを読んでいる。</p><h2><a href=#%e6%b0%b4%e7%ad%92 id=水筒 class=anchor aria-hidden=true>水筒</a></h2><p>高校の化学の授業でナトリウムをどうやって保存するべきかと先生が問いを投げて、追い討ちをかけるようにそのまま先生が水筒ですか、と言ったのをたまに思い出す。確か灯油とかに放り込んでおくのが定石だった気がする。</p><p>今日は水筒を買った。会社で水をもっと飲みやすくなる。水筒にはお茶もコーヒーも入れないつもり。レジで「ご自宅用ですか？」と聞かれたのが印象的。プレゼントか否かを暗に問われたのだと思ってそうですと言ったのだが正しく意図を汲み取れていたのだろうか。家で水筒使うことなかなかなさそうなので明には嘘をついてしまった。</p><p>意図が自明ではない発言にはその背景を添えて欲しいし、自分も添えるように気をつけよう。</p><h2><a href=#%e5%a0%b1%e9%85%ac%e4%b8%bb%e7%be%a9%e3%82%92%e8%b6%85%e3%81%88%e3%81%a6 id=報酬主義を超えて class=anchor aria-hidden=true>報酬主義を超えて</a></h2><p>報酬主義を超えてを読み始めた。思ったよりも面白い。ある程度、当たり前の主張をさも常識を疑って得られた結論みたいな書き方をするけど、それでも僕の立脚する価値観を疑うようなことも書いてありそうなので期待している。</p></p></div><div class=post-footer><time>July 2, 2023</time></div></article><article><h2><a href=https://blog.nfurudono.com/daily/2023-07-01/>2023-07-01</a></h2><div><p><h2><a href=#envsubst%e3%82%92%e7%9f%a5%e3%81%a3%e3%81%9f id=envsubstを知った class=anchor aria-hidden=true><code>envsubst</code>を知った</a></h2><p><code>envsubst</code>を使うと標準入力の環境変数の参照っぽいところに環境変数の値を埋め込んだテキストを吐ける。
readmeにコマンドのヘルプメッセージを載せたいときに便利。例: <a href=https://github.com/naoyafurudono/tools/tree/main/cl>https://github.com/naoyafurudono/tools/tree/main/cl</a></p><h2><a href=#git-ls-files id=git-ls-files class=anchor aria-hidden=true><code>git ls-files</code></a></h2><p>gitで管理しているファイルのパスが得られる。
git grepみたいに管理対象だけに興味があるときに便利そう。
fzfとの相性が良さげ。</p></p></div><div class=post-footer><time>July 1, 2023</time></div></article><article><h2><a href=https://blog.nfurudono.com/daily/2023-06-30/>2023-06-30</a></h2><div><p><h2><a href=#gitigrnore%e3%81%ae%e5%8f%8d%e6%98%a0 id=gitigrnoreの反映 class=anchor aria-hidden=true>.gitigrnoreの反映</a></h2><p>すでにgit管理されているファイルをgitignoreでマッチするようにしても、管理から外れない。外すためには以下のようにすると良い。</p><pre><code class=language-sh>git rm -r --cached .
git add .
git commit -m 'update with .gitignore'
</code></pre></p></div><div class=post-footer><time>June 30, 2023</time></div></article><article><h2><a href=https://blog.nfurudono.com/daily/2023-06-29/>2023-06-29</a></h2><div><p><h2><a href=#crateio%e3%83%87%e3%83%93%e3%83%a5%e3%83%bc id=crateioデビュー class=anchor aria-hidden=true>crate.ioデビュー</a></h2><p>crate.ioに初めてコードを登録した。<code>cargo install</code> で入るから便利。ちょっとしたCLIツール書く体験がなかなか良い。
copilotが面倒なことやってくれる。</p><h2><a href=#easy-cp%e3%82%92%e4%bd%9c%e3%81%a3%e3%81%9f id=easy-cpを作った class=anchor aria-hidden=true>easy-cpを作った</a></h2><p><a href=https://crates.io/crates/easy-cp><img src=https://img.shields.io/crates/v/easy-cp.svg alt=crates.io></a></p><p>Railsとか書いてると深いところに元からあるファイルをコピーしたいことがちょいちょいある。そのときに長いパスを2回打ちたくないので作った。</p></p></div><div class=post-footer><time>June 29, 2023</time></div></article><article><h2><a href=https://blog.nfurudono.com/daily/2023-06-24/>2023-06-24</a></h2><div><p><p>macのタイムゾーンの設定が狂っていて、今日の投稿がこれと前回の二つに分かれてしまった。</p><p>今日はmacの設定と、以降に伴って壊れたちょっとしたCLIツールの修正した。昔Rustで雑に書いたもので、エラー処理が辛そうだったので少し勉強して改善した。
anyhowを使ってみたい気持ちが湧いたけど、まずは基本的なところからということでトレイトオブジェクトを使うことにした。<code>type Result&lt;T> = std::Result&lt;T, dyn Error></code>みたいな感じにすることで、いろんなエラーを孕んだresultに<code>?</code>を使うことができて幸せ。</p><p>一箇所ムムッとなったのが、クロージャの中で<code>?</code>を使う箇所。<code>dyn Error</code>の気持ちで書いていたら、推論器はもっと具体的な型を推論していたみたいで、二つ目のエラー型の式に対して<code>?</code>したら型エラーになってしまった。こういうときはアノテーションをつければ良い。
Rustの型推論の割り切り方に慣れていない。</p></p></div><div class=post-footer><time>June 24, 2023</time></div></article><article><h2><a href=https://blog.nfurudono.com/daily/2023-06-23/>2023-06-23</a></h2><div><p><h2><a href=#%e7%92%b0%e5%a2%83%e6%a7%8b%e7%af%89 id=環境構築 class=anchor aria-hidden=true>環境構築</a></h2><p>macを買って環境構築をしているのでメモしていく。</p><ul><li>capslock -> eisu toggle<ul><li>システム環境設定 > キーボード > テキスト入力 > 入力ソース > Caps LockキーでABC入力モードに切り替える</li><li>最近のmacは組み込みの設定で変更できるようになった</li></ul></li><li>1Password<ul><li><a href=https://support.1password.com/secret-key/>最新のドキュメント</a>を参考にしてsecret keyを探し出す</li></ul></li><li>CLIツール: 以下の順で入れると良い。気が向いたらインストールスクリプトを書こう<ul><li>brew</li><li>fish</li><li>nvim</li><li>.config</li><li>その他</li></ul></li><li>gitでsshを使うための設定: この投稿のおまけを参考に<ul><li>鍵を生成</li><li>githubに公開鍵を登録</li><li>.ssh/configを書く</li></ul></li></ul><h3><a href=#%e3%81%8a%e3%81%be%e3%81%91 id=おまけ class=anchor aria-hidden=true>おまけ</a></h3><h4><a href=#ssh-keygen%e3%82%92%e4%be%bf%e5%88%a9%e3%81%ab id=ssh-keygenを便利に class=anchor aria-hidden=true>ssh-keygenを便利に</a></h4><p>個人メモ：<a href=https://github.com/naoyafurudono/dotfiles/blob/main/fish/functions/_ssh-keygen.fish>dotiflilesに書いてある</a>のでコピペは不要。</p><pre><code class=language-fish># for fish
function _ssh-keygen
  set name $argv[1]
  mkdir -p &quot;$HOME/.ssh/$name&quot;
  ssh-keygen -t ed25519 -f &quot;$HOME/.ssh/$name/id_ed25519&quot;
  chmod 600 &quot;$HOME/.ssh/$name/id_ed25519&quot;
end
</code></pre><pre><code class=language-bash>#!/bin/bash

name=$1
mkdir -p &quot;$HOME/.ssh/$name&quot;
ssh-keygen -t ed25519 -f &quot;$HOME/.ssh/$name/id_ed25519&quot;
chmod 600 &quot;$HOME/.ssh/$name/id_ed25519&quot;
</code></pre><h4><a href=#sshconfig%e3%81%ae%e4%be%8b id=sshconfigの例 class=anchor aria-hidden=true>.ssh/configの例</a></h4><pre><code class=language-config>Host github.com
  User git
  IdentityFile /Users/naoyafurudono/.ssh/github/id_ed25519
</code></pre><h3><a href=#%e3%81%be%e3%81%a8%e3%82%81 id=まとめ class=anchor aria-hidden=true>まとめ</a></h3><p>Terraformでローカル環境の管理とかできないだろうか？</p></p></div><div class=post-footer><time>June 23, 2023</time></div></article><article><h2><a href=https://blog.nfurudono.com/daily/2023-06-10/>2023-06-10</a></h2><div><p><h2><a href=#%e3%81%93%e3%81%ae%e3%81%82%e3%81%84%e3%81%a0%e9%87%8e%e5%b4%8e%e3%81%be%e3%81%a9%e3%81%ae%e3%82%bf%e3%82%a4%e3%82%bf%e3%83%b3%e3%82%92%e8%aa%ad%e3%82%93%e3%81%a0 id=このあいだ野崎まどのタイタンを読んだ class=anchor aria-hidden=true>このあいだ野崎まどのタイタンを読んだ。</a></h2><p>共感できるところが多かったし、なるほどなと思うところもあった。なにより読んでて楽しかったので読んでよかった。</p><p>野崎まどの本を読むのは、野崎まど劇場を友達に借りたのが最初だった気がする。かれこれ10年くらい前の話かも知れない。</p><h2><a href=#%e5%a4%a9%e6%b0%97%e4%ba%88%e5%a0%b1%e3%82%92%e7%a2%ba%e8%aa%8d%e3%81%97%e3%81%9f%e3%81%84 id=天気予報を確認したい class=anchor aria-hidden=true>天気予報を確認したい</a></h2><p>天気予報を確認したいのだけど、テレビを見たり朝スマホを確認する習慣がないし作る気もないので、なにか方法が必要。ちょうどラズパイが手に入ったので、毎朝どこかから引っ張ってきた天気予報を喋ってもらおうかと考えている。</p><p>読み上げは、voicevoxがいろいろいい感じなので試してみるつもり。ドキュメントがあまり充実してなさそうなのがたまにきず。やってみた系のブログ記事が有ったのでメモ <a href=https://ponkichi.blog/raspberry-voicevox/>https://ponkichi.blog/raspberry-voicevox/</a> 。</p><p>天気予報はどこから取ってくるのがいいんだろう。とりあえず、傘が必要かどうかを知りたい。</p><h2><a href=#%e3%83%aa%e3%83%b3%e3%82%ab%e3%81%ae%e8%a9%b1%e3%82%92%e3%81%8d%e3%81%84%e3%81%9f id=リンカの話をきいた class=anchor aria-hidden=true>リンカの話をきいた</a></h2><p>CAMPHER-が主催した植山類さんの講演でyoutube配信があったので視聴した <a href="https://www.youtube.com/live/WP8eaOL1UTE?feature=share">(youtube)</a>。リンカの話はよく知らなかったので楽しかった。「『CSの大体の問題は間接参照で解決する』という言葉がある」という発言がなかなか面白かった。使いたくなるときに我慢して使わずに乗り越えられたら幸せになったりするだろうか。</p></p></div><div class=post-footer><time>June 10, 2023</time></div></article><article><h2><a href=https://blog.nfurudono.com/daily/2023-05-13/>2023-05-13</a></h2><div><p><h2><a href=#%e4%bb%8a%e6%97%a5%e3%81%afrust%e3%82%92%e5%b0%91%e3%81%97%e5%8b%89%e5%bc%b7%e3%81%97%e3%81%a6%e3%81%84%e3%82%8b id=今日はrustを少し勉強している class=anchor aria-hidden=true>今日はRustを少し勉強している</a></h2><p>もともと<code>bash</code>で書いていたスクリプトを拡張したくなって、普段ならPythonで書くところを今日は新しいことをしてみようということでRustをつかってみることにした。</p><h3><a href=#%e8%8b%a6%e5%8a%b4%e8%a9%b1%e3%81%97 id=苦労話し class=anchor aria-hidden=true>苦労話し</a></h3><p>Rustはまったく初めてと言うわけではなくて、ちらちらドキュメントを読んだり、ノリで学校の課題をRustで書いてみたり（痛い目にあった）したことがある。所有権のあたりで苦労はあまりしなかった（というかPythonっぽくヒープを贅沢に使うコードを書いた）のだが、<code>Result</code> / <code>Option</code>の変換で発狂しかけた（メソッドが定義されていることに思いをはせられずに自作してしまった）。</p><p>あまり苦労しなかったと言いつつ、所有権のあたりで困りはしている。参照を受け取るコンストラクタに、その場で作ったオブジェクトを渡したいときに、一旦変数に束縛しないと、渡すオブジェクトが即死してしまっていけない問題が面倒。名前をつけるまでもない、式が体をを表しているような値にまで名前をつかないといけないのはしんどい。コンストラクタが所有権を奪うようにすればよいのだろうか。いらないから参照にしたのだよな&mldr;。</p><h3><a href=#%e3%81%a8%e3%81%af%e3%81%84%e3%81%88%e6%a5%bd%e3%81%97%e3%81%84 id=とはいえ楽しい class=anchor aria-hidden=true>とはいえ楽しい</a></h3><p>今ではそこそこなれてきて、代数的データ型とまともな型検査器がついたPythonくらいの書き方はできるようになった。
Rustのライブラリがイケイケに作られていて（エラー処理周りは辛いと感じるけど）、プログラムを書いていて楽しい。<a href=https://github.com/naoyafurudono/naoyafurudono.github.io/commit/5dffad6d10406fa83c4d9dd8eaa91a3c769a553f>すごく汚く書いてしまった</a>。当面の目標はまともにかけるようになることかな？ちょっとしたCLIでは大差ないのかもしれないけど。</p><p>ブログのGitHubのプログラミング言語構成比がカオスなことになってきた。</p><h2><a href=#%e8%83%83%e8%85%b8%e7%82%8e%e3%81%ab%e3%81%a4%e3%81%84%e3%81%a6 id=胃腸炎について class=anchor aria-hidden=true>胃腸炎について</a></h2><p>ここ何日か胃腸炎でつらい。今日はだいぶ回復して、Rustを勉強できるくらいになったけど、まだつらみを感じる。とはいえ三食たべても大丈夫な体に戻りはしたので問題なし。何日か会社に行けなかったのがなかなか悲しい。</p><p>今日は以前もらい忘れた診断書を書いていただいた。前回の診療に対して診断書を出してもらうことはなんだか難しそうで、もう一度診察していただくことになってしまった。自分の中では治ったと思っていたけど、見ていただいたらまだ治っていないとのことだったし、今はそう感じる（流されやすい性格なのか？）ので、忠告していただけてよかったと思うことにしている。</p><h2><a href=#%e9%a3%9f%e5%99%a8%e3%82%92%e8%b2%b7%e3%81%a3%e3%81%9f id=食器を買った class=anchor aria-hidden=true>食器を買った</a></h2><p>病院の帰り道で食器のフリマ的なことを日本料理屋さんがやっていた。普段使っている食器を入れ替えるのかなにかで、安く売り出してくださっていたようだ。胃腸炎になるまえに、会社のランチで「おいしそうな自炊の写真はくろっぽい器が大切」とのアドバイスを頂いていたことを覚えていたので、これは運命だと思い食器を購入した。黒っぽい器はどんぶりしか出会えなかったけど、それがなかなかいい感じだし、白っぽい器もいい感じのにいくつか巡り会えたのでほくほくしている。</p><p>あとはおいしそうなご飯をつくればよい。</p><h3><a href=#%e8%bf%bd%e8%a8%98 id=追記 class=anchor aria-hidden=true>追記</a></h3><p>夕飯につかってみた。いい感じ。味噌汁のお椀（蓋付き）が小さいやつで、フリーズドライの味噌汁一杯分しか入らないやつ（褒めてる）。感動している。</p><h2><a href=#%e3%82%ad%e3%83%ab%e3%83%a9%e3%82%ad%e3%83%ab%e3%81%8c%e3%81%8a%e3%82%82%e3%81%97%e3%82%8d%e3%81%84 id=キルラキルがおもしろい class=anchor aria-hidden=true>キルラキルがおもしろい</a></h2><p><a href=https://www.amazon.co.jp/%E3%82%AD%E3%83%AB%E3%83%A9%E3%82%AD%E3%83%AB/dp/B074BH9KHP>（アマプラ）</a>。グレンラガンの監督？が制作しているらしい。ノリが楽しい。</p></p></div><div class=post-footer><time>May 13, 2023</time></div></article><article><h2><a href=https://blog.nfurudono.com/daily/2023-04-16/>2023-04-16</a></h2><div><p><h2><a href=#chatgpt%e3%81%a8%e3%81%ae%e6%88%af%e3%82%8c id=chatgptとの戯れ class=anchor aria-hidden=true>ChatGPTとの戯れ</a></h2><p>午前中はChatGPTとかであそんでいた。ブログを書いていたおかげで、AIに食わせる自分の書いた文書に困らないのが嬉しい。</p><p>文書から自分の人柄を表現してもらって、それをもとにSNSで使えるアイコンを生成しようとしたのだけどうまくいかない。人柄の表現はそれっぽいのができるのだけど、表現が抽象的になってしまうので、そのままアイコン画像を生成につかうと小学生のときによんだ漫画にでてきそうな怪しくて怖い宗教っぽい画像がでてきてしまう。</p><p>インターネット上でのキャラクタに合わせたアイコンを提案してもらえたら楽しくないだろうか？</p><p>ちなみに生成できた画像はこんな感じ。改善のしようはいくらでもありそう。</p><ul><li><a href="https://oaidalleapiprodscus.blob.core.windows.net/private/org-xQP57b3U1YCgKl3FkhN2XI41/user-mXCl5fkO3Gm1oJYHtAnd1z1w/img-am8DtfXkLwkb82PJLtboEYz4.png?st=2023-04-16T01%3A57%3A47Z&amp;se=2023-04-16T03%3A57%3A47Z&amp;sp=r&amp;sv=2021-08-06&amp;sr=b&amp;rscd=inline&amp;rsct=image/png&amp;skoid=6aaadede-4fb3-4698-a8f6-684d7786b067&amp;sktid=a48cca56-e6da-484e-a814-9c849652bcb3&amp;skt=2023-04-16T00%3A43%3A02Z&amp;ske=2023-04-17T00%3A43%3A02Z&amp;sks=b&amp;skv=2021-08-06&amp;sig=k1Euf2aYTGl6%2BZbspqrNm19QbjWJOyBDPs7oIIktD/M%3D">なのはな</a></li><li><a href="https://oaidalleapiprodscus.blob.core.windows.net/private/org-xQP57b3U1YCgKl3FkhN2XI41/user-mXCl5fkO3Gm1oJYHtAnd1z1w/img-mkZrhNkERo7FVfLk1ZUywR4l.png?st=2023-04-16T01%3A57%3A47Z&amp;se=2023-04-16T03%3A57%3A47Z&amp;sp=r&amp;sv=2021-08-06&amp;sr=b&amp;rscd=inline&amp;rsct=image/png&amp;skoid=6aaadede-4fb3-4698-a8f6-684d7786b067&amp;sktid=a48cca56-e6da-484e-a814-9c849652bcb3&amp;skt=2023-04-16T00%3A43%3A02Z&amp;ske=2023-04-17T00%3A43%3A02Z&amp;sks=b&amp;skv=2021-08-06&amp;sig=59/1pmbAT2IXIngoC8YCR6zVilcukdaR6HX1sk/7FMU%3D">怖い1</a></li><li><a href="https://oaidalleapiprodscus.blob.core.windows.net/private/org-xQP57b3U1YCgKl3FkhN2XI41/user-mXCl5fkO3Gm1oJYHtAnd1z1w/img-7RPKZb7ryg1362RTOtBoVHne.png?st=2023-04-16T01%3A57%3A47Z&amp;se=2023-04-16T03%3A57%3A47Z&amp;sp=r&amp;sv=2021-08-06&amp;sr=b&amp;rscd=inline&amp;rsct=image/png&amp;skoid=6aaadede-4fb3-4698-a8f6-684d7786b067&amp;sktid=a48cca56-e6da-484e-a814-9c849652bcb3&amp;skt=2023-04-16T00%3A43%3A02Z&amp;ske=2023-04-17T00%3A43%3A02Z&amp;sks=b&amp;skv=2021-08-06&amp;sig=vDR0HyEykfekM245SzlfslloOf1yypcGYsr2tEO/R3c%3D">怖い2</a></li></ul><p>DALL-Eで生成したもので、<a href=https://openai.com/blog/dall-e-now-available-in-beta>権利の問題はなさそう (2023年4月16日閲覧)</a>:</p><blockquote><p>Starting today, users get full usage rights to commercialize the images they create with DALL·E, including the right to reprint, sell, and merchandise. This includes images they generated during the research preview.</p></blockquote><h2><a href=#%e9%9b%bb%e5%ad%90%e6%9b%b8%e7%b1%8d%e3%81%b8%e3%81%ae%e7%a7%bb%e8%a1%8c id=電子書籍への移行 class=anchor aria-hidden=true>電子書籍への移行</a></h2><p>本腰を入れて文書を読むときは印刷して読みたい。なので長いWebドキュメントを読むときは少し辛いし、論文を読むときは（本腰を入れて読むなら）印刷する。本はたいてい物理の書籍を買っていた。印刷するのが面倒だし、書き込みを残しやすいので。</p><p>ただ就職して出社するようになって、移動中に文書を読みたい機会が増えた。そんななかで本を持ち運ぶのは大変で、その日に読みうる範囲だけを持ち運びたくなった。そういう経緯でPDFみたいな印刷しやすい形式で購入できる場合は積極的に電子書籍を買うようになってきた。本のサイズが小さければこれまでと変わらず物理で買ってしまうのだが、面積が大きかったり鈍器の形をしているものは電子書籍を買う。</p><p>書き込みが残らなくなる問題は解決できていないが、書き込みたくなるほどまじめの読むことは少ないし、そこまで腰を吸えられるのは結局家の中のはずだ。今の生活ではそんなに困らないだろう。余談だが、EoPLを物理でもっていないのは数少ない書き込みが大切な機会を逸しているように思える。</p><h2><a href=#sns%e3%81%8c%e3%81%82%e3%81%be%e3%82%8a%e5%be%97%e6%84%8f%e3%81%a7%e3%81%aa%e3%81%84%e4%bb%b6 id=snsがあまり得意でない件 class=anchor aria-hidden=true>SNSがあまり得意でない件</a></h2><p>SNSで情報発信するのがあまり得意ではない。もともと会話があまり得意ではなくて、インスタントに情報を発するのが苦手なのだと思う。なにか考えてから言葉にするのにある程度時間がかかるし、言葉にしてから吟味したくなってしまいもする。</p><p>お酒が入ると吟味したい気持ちがどこかにいってしまうからしゃべる量が増えるのだろう。</p><p>話を戻そう。SNSは思ったことをパッと書いてそのまま発信することを重視したようなUIをしているように思う。たぶんそういうところで苦手意識を持っている。とはいえ情報発信の場としてSNSがメジャーなのは間違いないだろうし、ここみたいなブログはほとんどの人にみられないだろう。ブログを更新したときにSNSにリンクを投稿すると良い気もするが、それはそれでSNSの苦手な部分がブログ投稿に侵食してきそうで嫌な感じもする。悩ましい。</p></p></div><div class=post-footer><time>April 16, 2023</time></div></article><article><h2><a href=https://blog.nfurudono.com/daily/2023-04-10/>2023-04-10</a></h2><div><p><p>この頃「詳解システム・パフォーマンス」を読んでいる。チューニングをする機会はないのでツールの説明は読み飛ばしているが、それに入る前の基礎的な概念を勉強している。学部の授業でやった理論的な基礎から復習して、もう少し具体的な実装とか最近のアーキテクチャのこととかまで勉強できている気がする。</p><p>今からファイルシステムの章を読み始める。</p></p></div><div class=post-footer><time>April 10, 2023</time></div></article><article><h2><a href=https://blog.nfurudono.com/daily/2023-04-06/>2023-04-06</a></h2><div><p><h2><a href=#suica%e3%81%ae%e5%87%a6%e7%90%86%e6%96%b9%e5%bc%8f%e3%81%8c%e5%a4%89%e3%82%8f%e3%82%8b%e3%82%89%e3%81%97%e3%81%84 id=suicaの処理方式が変わるらしい class=anchor aria-hidden=true>Suicaの処理方式が変わるらしい。</a></h2><p>今まではレイテンシを減らすために改札をくぐった際の処理をローカルで行い、その後まったり同期する、みたいな方式をとっているという記事をみた記憶がある。</p><p>これからそのように凝ったことはしないで、改札機はクライアント、処理は中央のサーバで行うそうだ。時代が変わったのでそれでもいけるとか。なかなか驚きだ。どんなパフォーマンスチューニングやUXまわりの工夫がされているのだろうか。
Suicaの話は何回聞いてもロマンがあると感じる。運用開始が楽しみだ。</p><h3><a href=#%e5%8f%82%e8%80%83%e8%a8%98%e4%ba%8b id=参考記事 class=anchor aria-hidden=true>参考記事</a></h3><ul><li><a href=https://www.itmedia.co.jp/news/articles/2304/05/news131.html>なぜ？　「Suica」がサーバ型に移行する理由　25年近く稼働する“安全神話”の象徴に何が</a></li><li><a href=https://www.itmedia.co.jp/mobile/articles/2304/04/news155.html>“エリアをまたいだ乗車”実現なるか？　「Suica」の改札システムが順次リニューアル　2026年度完了予定</a><ul><li>今回の話</li></ul></li><li><a href=https://www.jstage.jst.go.jp/article/ieiej/31/6/31_408/_pdf/-char/en>Suicaシステムの概要</a> (2011, pdf)</li><li><a href=https://www.jreast.co.jp/youran/pdf/2019-2020/jre_youran_group_p69-74.pdf>IT・Suica事業</a><ul><li>これまでの話</li></ul></li></ul><h2><a href=#fitbit%e3%82%92%e5%86%8d%e9%96%8b%e3%81%97%e3%81%9f id=fitbitを再開した class=anchor aria-hidden=true>Fitbitを再開した</a></h2><p>昔Fitbitを使っていたのだけど、日々の記録が安定していておもしろくなかったから一年ほどでやめてしまった。最近通知を腕で受け取りたいとか、ランニングのときにつける時計を変えたいみたいな欲求がでてきて探してみると、
Fitbitが良さげだったので再開することにした。<a href=https://amzn.to/3UdqtL4>Charge5</a>を使っている。必要十分プラスアルファくらいの機能でいい感じ。ただSlack返信機能を誤作動させてしまったので対策したい。ぱっといじった感じでは無効化する設定を見つけられなかった。あとは腕時計をつけなれてなくてうっとうしく感じるのが欠点。</p><p>それ以外はばっちり。ランニングの記録もとれるし、通知もしっかり気がつける。ディスプレイの常時点灯を時間をしていして有効にできるので時計としても完璧につかえる。</p></p></div><div class=post-footer><time>April 6, 2023</time></div></article><article><h2><a href=https://blog.nfurudono.com/daily/2023-04-02/>2023-04-02</a></h2><div><p><p>CPythonの開発者向けドキュメントがとてもよい。今は<a href=https://devguide.python.org/internals/compiler/>コンパイラの構成に関する部分</a>を読んでいる。抽象構文木の扱いやメモリ管理の方針など、コンパイラ開発の方針を説明している。ドラゴンブックとかからは得られない、開発手法の知識を得られて幸せ。</p><p>好きな言語にドキュメントがたくさんあることは本当に嬉しい。</p></p></div><div class=post-footer><time>April 2, 2023</time></div></article><article><h2><a href=https://blog.nfurudono.com/daily/2023-03-31/>2023-03-31</a></h2><div><p><p>東大の田浦先生が公開されている<a href=https://doss.eidos.ic.i.u-tokyo.ac.jp/>大規模ソフトウェアを探る</a>がとてもよかった。
GDBを使って大きなソフトウェアの振る舞いを理解する方法を学べる。
2年ほど前に、こういう資料が喉から手が出るほどほしいと感じていた記憶がある。</p><p>今日はこのあと研究のことを少し考え、後輩とお酒を飲む。どちらも楽しみだ。</p><p>午前中には入社や書類を仕事をした。
Macのターミナルが重い。今まで使っていた研究室のでも重かったし、新しく使い始めたものでも重い。原因を調査中。アプリを起動するのも重いし、コマンド実行が終了してプロンプトが返るまでのレイテンシもある。</p></p></div><div class=post-footer><time>March 31, 2023</time></div></article><article><h2><a href=https://blog.nfurudono.com/daily/2023-03-19/>2023-03-19</a></h2><div><p><p>最近AIが流行っていて、精度がすごいと話題で、生活が多かれ少なかれ変わっていくのだろうなという感じがする。ああいう機械学習ベースのAIは学習で直感を鍛えて、それに基づく出力をするものだと僕は解釈している。人間が頭を使うときには直感を論理とか議論で検証して、主張の穴を見つけて改善するサイクルを回すはずだ。今の機械学習っぽいAIは直感で得た主張を論理で解釈しないだろう（<a href=https://www.nec.com/en/global/rd/technologies/201807/index.html>NECがそういうことを考えていそう</a>。それができればAIはもっとつよくなるはずだし、そういうAIを見てみたい。</p><p>実現するためにはAIの入出力に使う「言語」に解釈を入れることと、それをもとにして論証を行うことが必要だろう。今のAIは抽象構文木を操作の対象にしていて、それを意味を解釈するようにしたらいいんじゃないかという想像だ。</p><p>今ある論理が世の中の事象を扱うのに十分かはわからないし、多分結構不足しているはずだ。機械学習AIのための論理体系の研究とかあったら楽しいだろう。NIIとかでやってないだろうか？</p><h2><a href=#big-peat%e3%81%8c%e3%81%99%e3%81%94%e3%81%8f%e3%81%8a%e3%81%84%e3%81%97%e3%81%84 id=big-peatがすごくおいしい class=anchor aria-hidden=true>Big Peatがすごくおいしい</a></h2><p>おととい届いた<a href=https://bigpeat.com/>Big Peat</a>がとてもおいしい。明日の研究室飲み会にもっていこう。ちょうど二年くらい前に部活の先輩に勧めていただいたのだが、懐具合の問題で飲めずにいた。少し無理してでも飲んでおいたほうが良かったかと思うくらいには好き。ストレートで飲んでもおいしいし、ハイボールにしてもおいしい。天才か？
ぼくはスコッチウイスキー？が好きなのかもしれない。</p><p>学部2年のころ、確率論基礎の試験の前日にウイスキーを飲む会に誘っていただいたとき、ラフロイグ・ロアを味見させていただいて半分感動したのを覚えている。あのころは二十歳になりたてでお酒のおいしさは今よりも分かっていなかったのだが、それでもいいかんじなことは分かった。それからラフロイグ・ロアには縁がなかったのだが今気になっている。数量限定なようで、毎年11月ころに発売されそうな雰囲気がある。今もアマゾンで売ってるが、転売価格に見えるので時期がくるまで我慢しよう。</p><p>ちなみにBig Peatと一緒に勧めていただいたジョニーウォーカーのグリーンラベルはすでに飲んでいて、 やはり好きな感じだった。</p></p></div><div class=post-footer><time>March 19, 2023</time></div></article><article><h2><a href=https://blog.nfurudono.com/posts/window-manager/>使い勝手の良いデスクトップ向けウィンドウマネージャが欲しい</a></h2><div><p><p>使い勝手のよいウィンドウマネージャがWindowsとかMacに搭載されることはないだろう。使うアプリケーションやブラウザ、入力デバイスやその使い方によって使い勝手が大きく変わるだろうから。
OSが決め打ちで提供できるものでは無いんじゃないかと思う。なので自分でまじめに使い勝手の良いものを考える必要がある。</p><p>先日オリエンテーリングのインカレの配信のお手伝いをしたのだが、そこで使っていたスイッチャがなかなかデスクトップでのウィンドウマネージャの機能として魅力的に感じた。</p><p>スイッチャにはいろんなウィンドウ（カメラからの入力や、図、合成用のテロップなど）が接続されていて、すべてが画面の下部に控えめに表示される。それらを見ながらスイッチャのオペレータが放送するためのウィンドウを選択、合成する。放送されるウィンドウは画面上部に大きく表示される。放送されるウィンドウの右に同じサイズでプレビューウィンドウも表示される。これらの違いは放送されるか否かだけで、合成のテストとかに使える。</p><p>これを実現するためには操作用のデバイス（このデバイスをスイッチャというようだ）と、大きなモニタが必要だ。</p><p>デスクトップのウィンドウマネージャでもスイッチャのように</p><ul><li>すべてのウィンドウを表示しておいて</li><li>本番+alphaくらいのウィンドウをメインエリアに表示する</li></ul><p>と便利な気がする。単純にはいかないだろうけど、いい線行きそうだ。</p><p>懸念事項は以下の通り:</p><ul><li>ウィンドウの個数が多くなりそう</li><li>ウィンドウサイズが固定ではない（アスペクト比）</li><li>ウィンドウの動的な生成とその配置方法が非自明</li></ul></p></div><div class=post-footer><time>March 16, 2023</time></div></article><article><h2><a href=https://blog.nfurudono.com/posts/effect-handlers-without-continuation/>エフェクトハンドラの良さと実用性について</a></h2><div><p><p>エフェクトハンドラで継続や代数的エフェクトを扱う必要性は一ミリもなくて、実用的にそれらが欲しくなることはないか、あるいは限られていてそこまで一般的な機能を提供する必要はないんじゃないかと感じている。</p><p>このあたりを議論するために</p><ol><li>エフェクトハンドラの嬉しさ</li><li>意味論の歴史的経緯</li><li>改善ポイント</li></ol><p>を考える。</p><p>なお、この記事はとくに裏付けもなく書いている。気が向いたら裏付けをしようと思っているが、この記事の目的は僕の考えの整理であって、世に主張をしたいわけではない。</p><p>記事の内容は不正確なことを留意されたい。</p><h2><a href=#%e3%82%a8%e3%83%95%e3%82%a7%e3%82%af%e3%83%88%e3%83%8f%e3%83%b3%e3%83%89%e3%83%a9%e3%81%ae%e5%ac%89%e3%81%97%e3%81%95 id=エフェクトハンドラの嬉しさ class=anchor aria-hidden=true>エフェクトハンドラの嬉しさ</a></h2><p>エフェクトハンドラが実際的 (practical) なプログラミング言語でエンドユーザに使わせたくなるのは</p><ul><li>エフェクトシステムと相性のよい意味論</li><li>動的束縛</li></ul><p>を提供したいからではないだろうか。エフェクトハンドラを言語に入れれば、それで表現できる操作は自動的にエフェクトシステムで追跡できるし、ハンドラを用いることでエフェクトをローカルに使えるのは特筆するべきだろう。汎用性とlocal reasoningのしやすさはエフェクトハンドラのもつ良い性質だと思う。</p><p>エフェクトハンドラで実現できる動的束縛はとても使い勝手が良い上に、エフェクトシステムで追跡することで使い勝手が上がりそうだ。動的束縛のためだけのエフェクトシステムではなく、もう少し凝ったことができるエフェクトシステムがつくとなお幸せだろうから、エフェクトハンドラみたいな抽象度の比較的高いフレームワークで実現するのは幸せなんじゃないかと感じる。</p><h2><a href=#%e6%84%8f%e5%91%b3%e8%ab%96%e3%81%ae%e6%ad%b4%e5%8f%b2%e7%9a%84%e7%b5%8c%e7%b7%af id=意味論の歴史的経緯 class=anchor aria-hidden=true>意味論の歴史的経緯</a></h2><p>エフェクトハンドラと呼ばずに &ldquo;algebraic effects&rdquo; とか &ldquo;algebraic effects and handlers&rdquo;
とか呼ぶ流派、時代がある。歴史的には</p><ul><li>algebraic effects</li><li>algebraic effects and handlers</li><li>effect handlers</li></ul><p>みたいな流れで登場したはずだ。最初はハンドラはなくて、モナドとかの話をするような人たちが副作用にモナドではない別の表現を与えようとしたんだったか。ここでいうモナドはモナド則とかを真面目に考えるような数学のモナド。代数的エフェクトもその流れの中に（このころは）あったはず。そもそも代数的エフェクトの代数とは、操作が（0だか1こ以上）あって、それらに等式制約を課す。それを満たすようなモデルを持つのが代数 (algebra) である、みたいな世界だっと思う。群とか環は代数だけど、体は代数じゃないみたいな話を聞いたことがある。そういうのりの代数として、エフェクトを表現したらモナドの合成みたいなことを考えるときに幸せだ、という主張がことの発端だった気がする。</p><p>ここまでは数学とかモデル理論？とかの話によっていて、あまりプログラミング言語っぽい雰囲気がしない。ハンドラとか継続が入ってきた経緯はしらないが、多分、プログラミング言語に代数的エフェクトを入れるにあたって、モナドのbindやreturnみたいなものを定義するように、エフェクトに意味を与える仕組みとしてハンドラが考えられたんじゃないかと思う。このあたりは論文をまじめに読めば分かるはず。これが確か2014年くらいのこと。</p><p>2000年くらいだったかから考えられていたエフェクトシステムとの相性に目をつけたからか知らないが、「代数的エフェクトとハンドラ」を取り入れた言語が2014年ころに登場し始める。2017年くらいにでてくる印象がある。
EffやKokaはこのへんな気がする。このあたりで、エフェクトが代数的であることはとくに気にされなくなっていき、エフェクトシステムと例外ハンドラがうまいこと組み合わさる限定継続演算子くらいの気持ちで代数的エフェクトとそのハンドラが捉えられて、やがて代数的ではないことが気になる人々がエフェクトハンドラと呼ぶようになったのではないかと思っている。</p><h2><a href=#%e6%94%b9%e5%96%84%e3%83%9d%e3%82%a4%e3%83%b3%e3%83%88 id=改善ポイント class=anchor aria-hidden=true>改善ポイント</a></h2><p>限定継続は本当に必要だろうか。もっとやさしい概念を提供するのにとどめるのはいかがだろうか。ワンショット継続とかに限定する言語もあるが、それは正しい方向性だろうか。</p><p>僕たちがほしかったものは、local reasoningしやすいエフェクトシステムとそれで健全に管理できる意味論なんじゃないかと思う。エフェクトハンドラはその条件を満たすけど、もっと使い心地のよい意味論があるはずだと思う。</p><h2><a href=#%e3%81%82%e3%81%a8%e3%81%8c%e3%81%8d id=あとがき class=anchor aria-hidden=true>あとがき</a></h2><p>最後の文をメモしたくてこの記事を書いた。それ以外は文脈である。</p></p></div><div class=post-footer><time>March 16, 2023</time></div></article><article><h2><a href=https://blog.nfurudono.com/posts/gcp-cred/>Google Cloudの認証を必要とするアプリケーション開発について</a></h2><div><p><p>Google Cloudの認証・認可はきめ細かくちゃんとしている感じがして、扱うのが難しいと感じていた。少し調べたら<a href=https://cloud.google.com/docs/authentication/client-libraries#adc>Application Default Credentials with client libraries</a>の説明を見つけて腹に落ちた。これを抑えた上で、<a href=https://cloud.google.com/docs/authentication/provide-credentials-adc#how_to_provide_credentials_to_adc>それぞれの実行環境でどのようにcredentialをセットアップするか</a>を見ると、プロセスの権限が半分くらいわかる。ここまでで、サービスアカウントがどのようにプロセスに付与されるかを理解できるはずだ。</p><p>次に、それぞれのサービスアカウントがどのようなリソースへのアクセスをもつか、それをどうやって設定するかを確認すれば認証・認可を自由に管理できるんじゃないかと思う。<a href=https://cloud.google.com/docs/authentication/application-default-credentials#personal>How Application Default Credentials works</a>が良い水先案内に見える。</p><p>このあたりは知識がないと本当に挙動がわけわからないので分かりやすいところにドキュメントを置いといたり、積極的にエラーメッセージで教えてほしい。
Google Cloudを使う上での義務教育だと感じた。</p></p></div><div class=post-footer><time>March 14, 2023</time></div></article><article><h2><a href=https://blog.nfurudono.com/posts/linux-keys/>Linux (gnome) でよくやる設定</a></h2><div><p><p>GNOMEというかLinuxというかでよくやる設定を列挙する。キーボード系が多いと思う。</p><h3><a href=#gnome-terminal-%e3%81%a7ctrl-shift-tab%e3%82%92%e6%9c%89%e5%8a%b9%e3%81%ab%e3%81%99%e3%82%8b id=gnome-terminal-でctrl-shift-tabを有効にする class=anchor aria-hidden=true>gnome-terminal で<code>ctrl-(shift-)?tab</code>を有効にする</a></h3><p>以下を実行</p><pre><code class=language-sh>gsettings set org.gnome.Terminal.Legacy.Keybindings:/org/gnome/terminal/legacy/keybindings/ next-tab '&lt;Primary&gt;Tab'
gsettings set org.gnome.Terminal.Legacy.Keybindings:/org/gnome/terminal/legacy/keybindings/ prev-tab '&lt;Primary&gt;&lt;Shift&gt;Tab'
</code></pre><p>参考: <a href=https://askubuntu.com/questions/133384/keyboard-shortcut-gnome-terminal-ctrl-tab-and-ctrl-shift-tab-in-12-04>https://askubuntu.com/questions/133384/keyboard-shortcut-gnome-terminal-ctrl-tab-and-ctrl-shift-tab-in-12-04</a></p><h3><a href=#capslock%e3%81%a7%e8%8b%b1%e6%95%b0%e5%a4%89%e6%8f%9b id=capslockで英数変換 class=anchor aria-hidden=true><code>capslock</code>で英数変換</a></h3><p><a href=https://github.com/k0kubun/xremap><code>xremap</code></a>や<a href=https://github.com/mooz/xkeysnail><code>xkeysnail</code></a>を使うどちらもそんなに使い心地は変わらないと思う。今は<code>xkeysnail</code>を使っている。</p><h3><a href=#xkeysnail%e3%82%92systemd%e3%81%ab%e8%b5%b7%e5%8b%95%e3%81%97%e3%81%a6%e3%82%82%e3%82%89%e3%81%86 id=xkeysnailをsystemdに起動してもらう class=anchor aria-hidden=true><code>xkeysnail</code>をsystemdに起動してもらう</a></h3><p>課題が2つある:</p><ul><li><code>xkeysnail</code>が<code>uinput</code>を必要とすること<ul><li><code>sudo</code>が必要とreadmeに書かれているのはこれが理由</li></ul></li><li><code>xkeysnail</code>をsystemdに登録すること<ul><li><code>sudo</code>つけられない/等価なことはできない？</li></ul></li></ul><p>以下のように解決する</p><ol><li>必要な権限を自分に与える<ol><li>sudoなしで<code>xkesynail</code>を実行できるようになる</li></ol></li><li>systemdに登録して、ログインくらいのタイミングで有効にする</li></ol><h4><a href=#%e6%a8%a9%e9%99%90%e3%82%92%e4%b8%8e%e3%81%88%e3%82%8b id=権限を与える class=anchor aria-hidden=true>権限を与える</a></h4><p>これの通りにやればよい: <a href=https://github.com/mooz/xkeysnail/issues/64#issuecomment-600380800>https://github.com/mooz/xkeysnail/issues/64#issuecomment-600380800</a></p><h4><a href=#systemd%e3%81%ab%e7%99%bb%e9%8c%b2%e3%81%99%e3%82%8b id=systemdに登録する class=anchor aria-hidden=true>systemdに登録する</a></h4><ol><li>設定ファイルを書く <a href=https://github.com/naoyafurudono/configs/blob/main/systemd/user/xkeysnail.service>https://github.com/naoyafurudono/configs/blob/main/systemd/user/xkeysnail.service</a></li><li><code>~/.config/systemd/user/</code>におく<ol><li>バイナリをおく: 上の例では<code>~/.local/bin</code>においてあることを想定している</li></ol></li><li>systemdに登録する: <code>systemctl --user enable --now xkeynail</code><ol><li><code>enable</code>で登録、<code>--now</code>で今実行</li></ol></li></ol><p>もしうごかなかったら<code>jounalctl -r</code>でsystemdのログをみる。</p><h3><a href=#%e8%b5%b7%e5%8b%95%e6%99%82%e3%81%abmozc%e3%81%ae%e6%97%a5%e6%9c%ac%e8%aa%9e%e5%85%a5%e5%8a%9b%e3%82%92%e6%9c%89%e5%8a%b9%e3%81%ab%e3%81%99%e3%82%8b id=起動時にmozcの日本語入力を有効にする class=anchor aria-hidden=true>起動時に<code>mozc</code>の日本語入力を有効にする</a></h3><p><a href=https://github.com/naoyafurudono/configs/blob/main/mozc/ibus_config.textproto>https://github.com/naoyafurudono/configs/blob/main/mozc/ibus_config.textproto</a>を<code>~/.config/mozc/</code>におく。</p><p>参考: <a href=https://blog.nfurudono.com/posts/mozc-default-engine/>https://blog.nfurudono.com/posts/mozc-default-engine/</a></p></p></div><div class=post-footer><time>February 28, 2023</time></div></article><article><h2><a href=https://blog.nfurudono.com/daily/2023-02-27/>2023-02-27</a></h2><div><p><p>Gentooが入った。基本的に待っているだけではあるのだけど、それがなかなか大変。パッケージを一瞬でインストールできる幸せに気がついた。割とすぐにUbuntuに戻るかもしれない。今はnodejsとtexliveをコンパイルしている。未だかつてなくCPUが仕事をしている。かわいそうに。とはいえportageに触れるのはなかなか楽しい。</p><p>mozcの設定はこのブログのメモに助けられた。過去の自分に感謝。</p><p>(追伸) Gentooを入れるためにssdを付け替えたのだけど、そのときにじゃまで外したCPUクーラーがうまくはまっていなかった。このPCはまともな冷却なしでもろもろをビルドしていたのだ。本当にかわいそうなことをしてしまった。ずっとうるさかったのでさっさと気がつくべきだった。今はこれまでがうそのように静か。</p></p></div><div class=post-footer><time>February 27, 2023</time></div></article><article><h2><a href=https://blog.nfurudono.com/daily/2023-02-26/>2023-02-26</a></h2><div><p><p>Golangをすごく久しぶりに書いた結果、構造体の要素がコピーされることを忘れておりデバッグに時間を溶かした（コピーした構造体のフィールドを書き換えて、コピー元に変化が起きると思い込んでいた）。最近はPythonやTSか、関数型言語ばかり書いていて、Cっぽい構造体の扱いをしていなかったので忘れてしまっていたのだろう。忘れていたけど、CやGoのように構造体の要素をコピーする意味論は好き。直感的というか、明示的にポインタを表現することが好きなのだろうか。</p></p></div><div class=post-footer><time>February 26, 2023</time></div></article><article><h2><a href=https://blog.nfurudono.com/posts/my-pc/>PCの構成メモ</a></h2><div><p><p>PCを自作して使っているのだけど、どんなパーツを使ったか忘れて後でなにか買い足すときに互換性があるかわからなくてこまる。今回調査してメモしておく。</p><ul><li>CPU: Core i5 12400</li><li>マザーボード: GIGABYTE B660M DS3H AX DDR4 [Rev.1.x]</li><li>RAM: <a href=https://amzn.to/3ZdyVLF>DDR4-3200 (2933・2666対応) (PC4-25600) W4U3200CM-8GR</a></li><li>SSD: WDS500G3X0E<ul><li>M.2 NVMe 内蔵SSD / 500GB / PCIe Gen4x4 / WD BLACK SN770 NVMe SSDシリーズ</li></ul></li><li>ケース: <a href=https://amzn.to/3ZxnLlp>Thermaltake Versa H17 ミニタワー型PCケース CS7096 CA-1J1-00S1NN-00</a></li><li>電源: <a href=https://amzn.to/3Z0HhXp>XPG PYLON パイロン 450W PC電源ユニット [ 80PLUS Bronze認証取得 ] PYLON450B-BKCJP</a></li></ul><p>Ubuntuを入れて使っているけど特に不満はない。不満はないのだが、この間Gentooのことを教えてもらって面白そうなので使ってみようと思っている。</p><p>余談だが、このPCは親に就活で必要だろうからといって渡してもらったお金で組んだのだった。自由に使えと言ってもらったが、きっとスーツとかを想定していたのだろう。幸いなことにスーツは買わずに済んでいるので（兄のお下がりがまだ着れる）、ずっと気になっていた自作PCに手を出すのに使ったのだった。少し後ろめたい気持ちがないでもなかったが、Linuxとか触るの楽しいことが分かって仕事でもこの手のものを触りたいと思えたし、面接の話のネタにもなったので結果オーライだろう。学校とか本で学ぶOS周りの技術をそのまま試せるのが僕には嬉しかったのだろう。Windowsでは厳しいし、Macもどこか違っているので。</p></p></div><div class=post-footer><time>February 23, 2023</time></div></article></div><footer class=footer-mobile><div class=social-icons><a class=social-icon href=https://twitter.com/furudono2 target=_blank rel=noopener title=Twitter><svg width="28" height="28" viewBox="0 0 28 28" fill="#ababab" xmlns:xlink="https://www.w3.org/1999/xlink"><path d="M8.991284 24.971612c10.189152.0 15.761088-8.441388 15.761088-15.761088C24.752372 8.970656 24.747512 8.731868 24.736496 8.494376 25.818008 7.712564 26.758256 6.737 27.5 5.62622c-.992628.440856-2.060748.738072-3.181248.871992 1.14372-.685584 2.02176-1.770768 2.435832-3.064176-1.070496.6345-2.25558 1.095984-3.517344 1.344492-1.010772-1.076652-2.450412-1.75014-4.043412-1.75014-3.059424.0-5.540292 2.480868-5.540292 5.539104.0.434808.0487079999999995.857412.14364 1.26306C9.19346 9.599108 5.11106 7.39472 2.3792 4.04294c-.476172.818424-.750168 1.769688-.750168 2.784132.0 1.921968.97794 3.61854 2.464992 4.61106C3.185528 11.41016 2.331788 11.160464 1.585184 10.745096 1.583888 10.768208 1.583888 10.791428 1.583888 10.815728c0 2.683152 1.909764 4.922856 4.4442 5.43078C5.562932 16.373084 5.07326 16.44134 4.56782 16.44134 4.210988 16.44134 3.863876 16.406024 3.526484 16.34144c.70524 2.200824 2.750112 3.802356 5.174928 3.8475-1.896264 1.485756-4.284576 2.37114-6.879924 2.37114C1.374476 22.56008.93362 22.534592.5 22.4834c2.451708 1.571076 5.362524 2.488212 8.491284 2.488212"/></svg>
</a><a class=social-icon href=https://www.instagram.com/donofuru/ target=_blank rel=noopener title=Instagram><svg width="28" height="28" viewBox="0 0 28 28" fill="#ababab" xmlns:xlink="https://www.w3.org/1999/xlink"><path d="M14.0000238 2.00378571c3.2579524.0 3.6664762.0138095300000001 4.946.0721904800000002C20.222881 2.13421429 21.0949286 2.33702381 21.8579762 2.63359524 22.6468333 2.94011905 23.3158333 3.35030952 23.9827857 4.01721429 24.6496905 4.68416667 25.059881 5.35316667 25.3664524 6.14202381 25.6629762 6.90507143 25.8657857 7.77711905 25.9240238 9.05397619 25.9824048 10.3335 25.9962143 10.7420238 25.9962143 14.0000238 25.9962143 17.2579762 25.9824048 17.6665 25.9240238 18.9460238 25.8657857 20.222881 25.6629762 21.0949286 25.3664524 21.8579762 25.059881 22.6468333 24.6496905 23.3158333 23.9827857 23.9827857 23.3158333 24.6496905 22.6468333 25.059881 21.8579762 25.3664524 21.0949286 25.6629762 20.222881 25.8657857 18.9460238 25.9240238 17.6665 25.9824048 17.2579762 25.9962143 14.0000238 25.9962143 10.7420238 25.9962143 10.3335 25.9824048 9.05397619 25.9240238 7.77711905 25.8657857 6.90507143 25.6629762 6.14202381 25.3664524 5.35316667 25.059881 4.68416667 24.6496905 4.01721429 23.9827857c-.66690477-.6669524-1.07709524-1.3359524-1.38361905-2.1248095-.29657143-.7630476-.49938095-1.6350952-.55761905-2.9119524C2.01759524 17.6665 2.00378571 17.2579762 2.00378571 14.0000238 2.00378571 10.7420238 2.01759524 10.3335 2.07597619 9.05397619 2.13421429 7.77711905 2.33702381 6.90507143 2.63359524 6.14202381c.30652381-.78885714.71671428-1.45785714 1.38361905-2.12480952.66695238-.66690477 1.33595238-1.07709524 2.12480952-1.38361905C6.90507143 2.33702381 7.77711905 2.13421429 9.05397619 2.07597619 10.3335 2.01759524 10.7420238 2.00378571 14.0000238 2.00378571zm0 2.16147619C10.796881 4.1652619 10.4174524 4.1775 9.1525 4.23521429 7.98288095 4.28854762 7.34769048 4.48397619 6.92497619 4.6482619 6.36502381 4.86588095 5.96540476 5.12583333 5.54564286 5.54564286c-.41980953.4197619-.67976191.81938095-.89738096 1.37933333-.16428571.42271429-.35971428 1.05790476-.41304761 2.22752381C4.1775 10.4174524 4.1652619 10.796881 4.1652619 14.0000238 4.1652619 17.203119 4.1775 17.5825476 4.23521429 18.8475 4.28854762 20.017119 4.48397619 20.6523095 4.6482619 21.0750238 4.86588095 21.6349762 5.12588095 22.0345952 5.54564286 22.4543571 5.96540476 22.8741667 6.36502381 23.134119 6.92497619 23.3517381 7.34769048 23.5160238 7.98288095 23.7114524 9.1525 23.7647857 10.4173095 23.8225 10.7966429 23.8347381 14.0000238 23.8347381 17.2033571 23.8347381 17.5827381 23.8225 18.8475 23.7647857 20.017119 23.7114524 20.6523095 23.5160238 21.0750238 23.3517381 21.6349762 23.134119 22.0345952 22.8741667 22.4543571 22.4543571 22.8741667 22.0345952 23.134119 21.6349762 23.3517381 21.0750238 23.5160238 20.6523095 23.7114524 20.017119 23.7647857 18.8475 23.8225 17.5825476 23.8347381 17.203119 23.8347381 14.0000238 23.8347381 10.796881 23.8225 10.4174524 23.7647857 9.1525 23.7114524 7.98288095 23.5160238 7.34769048 23.3517381 6.92497619 23.134119 6.36502381 22.8741667 5.96540476 22.4543571 5.54564286 22.0345952 5.12583333 21.6349762 4.86588095 21.0750238 4.6482619 20.6523095 4.48397619 20.017119 4.28854762 18.8475 4.23521429 17.5825476 4.1775 17.203119 4.1652619 14.0000238 4.1652619zm0 13.8334762c2.2084286.0 3.9987143-1.7902857 3.9987143-3.9987143.0-2.2084762-1.7902857-3.9987619-3.9987143-3.9987619-2.2084762.0-3.9987619 1.7902857-3.9987619 3.9987619.0 2.2084286 1.7902857 3.9987143 3.9987619 3.9987143zm0-10.15895239c3.4021905.0 6.1601905 2.75799999 6.1601905 6.16023809.0 3.4021905-2.758 6.1601905-6.1601905 6.1601905-3.4022381.0-6.16023809-2.758-6.16023809-6.1601905.0-3.4022381 2.75799999-6.16023809 6.16023809-6.16023809zm7.8431429-.24338095c0 .79504762-.644523800000002 1.43952381-1.4395715 1.43952381C19.6085952 9.03592857 18.9640714 8.39145238 18.9640714 7.59640476S19.6085952 6.15683333 20.4035952 6.15683333c.795047699999998.0 1.4395715.64452381 1.4395715 1.43957143z"/></svg>
</a><a class=social-icon href=https://www.linkedin.com/in/naoya-furudono target=_blank rel=noopener title=LinkedIn><svg width="28" height="28" viewBox="0 0 28 28" fill="#ababab" xmlns:xlink="https://www.w3.org/1999/xlink"><path d="M2 3.654102c0-.95502059.79442509-1.73012354 1.77383592-1.73012354H24.2261641C25.2058917 1.92397846 26 2.69908141 26 3.654102V24.3462148C26 25.3015521 25.2058917 26.0760215 24.2261641 26.0760215H3.77383592C2.79442509 26.0760215 2 25.3015521 2 24.3465315V3.65378524 3.654102zM9.27526132 22.1415901V11.2356668H5.65030092V22.1415901H9.27557808 9.27526132zM7.46341463 9.74691162c1.2638581.0 2.05068103-.83750395 2.05068103-1.88406715C9.49033893 6.79252455 8.72727273 5.97846056 7.48748812 5.97846056c-1.24073487.0-2.05099778.81406399-2.05099778 1.88438391.0 1.0465632.78650618 1.88406715 2.00316756 1.88406715h.02343998H7.46341463zM11.2815965 22.1415901h3.6246436v-6.089642C14.9062401 15.7263225 14.9299968 15.4000634 15.0256573 15.1675641c.261957499999999-.6515679.8584099-1.3259423 1.8599936-1.3259423 1.3113716.0 1.836237 1 1.836237 2.4662654v5.8337029h3.6246436V15.8885017c0-3.349699-1.7880899-4.9084574-4.172949-4.9084574-1.9553373.0-2.814064 1.0928097-3.2910991 1.8371872H14.9065569v-1.581248H11.2819132C11.3291099 12.2591067 11.2815965 22.1419069 11.2815965 22.1419069V22.1415901z"/></svg>
</a><a class=social-icon href=https://github.com/naoyafurudono target=_blank rel=noopener title=GitHub><svg width="28" height="28" viewBox="0 0 28 28" fill="#ababab" xmlns:xlink="https://www.w3.org/1999/xlink"><path d="M13.9988029 1.32087331C6.82105037 1.32087331 1 7.14112562 1 14.3212723c0 5.7436386 3.72454649 10.6157955 8.89038951 12.3348169C10.5408085 26.7757983 10.7778323 26.374374 10.7778323 26.0296121 10.7778323 25.7215609 10.7666595 24.9035493 10.760275 23.8189856 7.14426471 24.6042767 6.38131925 22.0760223 6.38131925 22.0760223c-.59136253-1.5019491-1.44369072-1.9017772-1.44369072-1.9017772C3.75729765 19.3682044 5.02701126 19.3841656 5.02701126 19.3841656 6.33183953 19.4759425 7.01817121 20.7241085 7.01817121 20.7241085c1.15958133 1.9863716 3.04300319 1.4125664 3.78360289 1.0797753.1181129-.8395592.4540962-1.4125663.8251942-1.7373768C8.74038491 19.7385043 5.70536235 18.6228163 5.70536235 13.6413251c0-1.4189508.50676816-2.5801283 1.33834679-3.4883207C6.90963504 9.82420367 6.46351945 8.50181809 7.17139875 6.71256734c0 0 1.09094816-.34955032 3.57451115 1.33276037C11.78259 7.75642995 12.8950858 7.61277914 14.000399 7.60719272 15.1049142 7.61277914 16.2166119 7.75642995 17.2548881 8.04532771c2.4819669-1.68231069 3.571319-1.33276037 3.571319-1.33276037C21.5356825 8.50181809 21.0895669 9.82420367 20.9562909 10.1530044 21.7894656 11.0611968 22.2922435 12.2223743 22.2922435 13.6413251c0 4.9942601-3.039811 6.0931889-5.935173 6.4148071.4660671.401424200000001.8818564 1.194696.8818564 2.4077473C17.2389269 24.2012564 17.2229657 25.603448 17.2229657 26.0296121 17.2229657 26.3775663 17.4575954 26.7821827 18.116793 26.6552912 23.2786458 24.9322794 27 20.0633148 27 14.3212723 27 7.14112562 21.1789496 1.32087331 13.9988029 1.32087331"/></svg></a></div><div class=footer-mobile-links><p><a href=https://github.com/naoyafurudono/naoyafurudono.github.io target=_blank rel=noopener>Source of
this site</a></p><span class=divider-bar>|</span><p><a href=https://gohugo.io target=_blank rel=noopener></a></p><p>©2025 Naoya Furudono</p></div><script src=https://blog.nfurudono.com/js/main.min.a7205ef73b078c8daed6fe1b0826e8ba229ffabbb69d299d9446cf41f2c7d8aa.js integrity="sha256-pyBe9zsHjI2u1v4bCCbouiKf+ru2nSmdlEbPQfLH2Ko=" crossorigin=anonymous></script><a target=_blank rel="noopener noreferrer" href=https://github.com/naoyafurudono/naoyafurudono.github.io/actions><img src=https://github.com/naoyafurudono/naoyafurudono.github.io/actions/workflows/gh-pages.yml/badge.svg alt="github pages deploy status" style=max-width:100%></a><p><a href="https://www.amazon.jp/hz/wishlist/ls/1JBRXP4JZZ21T?ref_=wl_share">欲しい本リスト</a></p><p><a href="https://www.amazon.jp/hz/wishlist/ls/3TT5GR81VZPHP?ref_=wl_share">欲しいものリスト</a></p></footer></body></html>