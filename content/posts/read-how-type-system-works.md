---
title: "「型システムのしくみ」を読む"
date: 2025-05-03T00:19:26+09:00
author: "Naoya Furudono"
draft: true
tags:
    - "daily"
    - "PL"
    - "tech"
    - "book"
---

# 第一章 型システムとは

- 型システムはプログラムの ok ng を判定する
- 誰がok ngを決めるのだろうか
- 未定義動作
  - JSでのnull検査
    - そのコスト
  - C, C++の未定義動作の利点とその意味
    - 理論的な未定義動作と実際的な未定義動作
- 未定義動作への対処としての堅安全性
  - 型検査が通ったら未定義動作に陥らない
- TaPLでの健全性。プログラムの操作的意味論をもとにした保存と進行(健全ならstuckしない)
- 本書での型安全性とは、「 _望ましくなさそうな動作_ を _無理のない範囲_」 で 検出すること
- MLは健全性を意識した型システムを採用している
- TSはそうでもない。健全性を問題にしていない
  - JSはstuckしないので
  - JSの意味論がやばい: 1 + true は何になると思いますか？に正解して嬉しい人はいないはず。たまたまJSの意味論を決めた人と同じ気持ちだっただけ。正解はないはず。
  - 普通はそんなものに解釈を定義しない。そんなプログラムはまともなプログラムではない、と思うのが正しいはず
  - そういう意味で「望ましくなさそうな動作」を望ましくないと検出したい
- 無理があるとは？
  - 以下の関数が型エラーになるか否かを判定するのは無理がある

```js
console.log(((<P = NP>) ? 1 : "hello") + 1)
````

こういうのは諦めて、型エラーだとしてしまう型検査器を実装する。
「無理がある」は主観なので、TSコンパイラが受け入れるプログラムであっても僕たちが大変だから「無理がある」とするのはあり

```ts
function foo(x: number | undefined): string {
  return (x === undefined) ? "undefined" : (x+1).toString()
}
```

```
checker: code -> bool
```

chckerが ok というような言語のことを、そのchckerの対象言語という？
_それとも、codeの全体のことをcheckerの対象言語という？_: 多分こっち

対象言語が単純なうちは、型検査器を定義・実装するのも簡単なはず。

## 付録

- 言語とは何か
- 型検査の手前
