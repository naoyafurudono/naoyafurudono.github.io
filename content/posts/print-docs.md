---
title: "軽いドキュメントを印刷するためのツールが欲しい"
date: 2023-02-24T17:48:57+09:00
author: "Naoya Furudono"
draft: false
tags: [
    "idea"
    ,"tool"
]
---

さくっと書いた文書を印刷したいことがある。
ビジネスライクな手紙とか、その日のTODOリストなんかがそうだ。
LaTeXやMadokoを使うのは大げさな感じがして、諦めて手書きするか、Google Docsで済ませることが多い。
とはいえ手紙の書き方を毎回調べたり、フォーマットを調整したり、PCで打ち込んだデータを手書きするのはつらい。

テンプレートと変数の宣言、UIの調整と文書のまともな処理をして印刷（A4）できるものが欲しい。A4のPDFに変換できればよい。
それぞれの文書のソースはマークダウンのちょっとした拡張くらいの文法で書きたい。エディタで編集したいのでGoogle Docsとかはなしで。
テンプレートの作成方法はテキストにこだわらない。いじりやすいと嬉しい。

問題が以下のように分割できるはず。

- テンプレート作成
- ソースの文法
    - Markdown拡張
- テンプレートへのソースの埋め込み
- PDFへの変換

HTML/CSSやlatexを勉強してMadokoでくっつければなんとかできる気はするが、大変そうだしあまり楽しくない。
文書作成ツールを自作するか？とりあえず、HTML/CSSで手紙を表現できるようになるところから始めるのが良さそうか。
自作マークダウン拡張（というより処理系）はまれに欲しくなるのでやっても良いだろう。Hugoもそんなに快適じゃないし、Madokoはいじりにくいので。

- 自分でコードをいじりやすいこと
- メタな文書処理がしやすいこと
    - 識別子や文書の変数への束縛、正規表現やCFGベースのテキスト置換など
    - この辺はMadokoが強い
- そういえばMadokoはPDFの生成でHTMLを使わずにlatexを使っていたな...

ここまで来て、[Paper CSS](https://github.com/cognitom/paper-css)という良さげなリポジトリを見つけた。
Qitaでこのライブラリを使って[帳票を作る例が解説されている](https://qiita.com/cognitom/items/d39d5f19054c8c8fd592)。

まだそれぞれをあまり読んでいないのであとで確認する。
このあたりの技術に合うように出力することにして、それを生成するマークダウンエンジンを用意すればok?

やはりしんどい気がする。GUIでなんとかする方法を探すのが楽だろうか。
あらためて考えよう。

## 追記: Google Docs API

[Google Docs API](https://developers.google.com/docs/api/reference/rest?hl=ja)を利用するのはどうだろうか。
APIはあまりリッチではなくて、create, update, pullができるのみ。
文書構造の編集はJSONをごりごりいじることで実現する。
[JSONスキーマが定義されている](https://developers.google.com/docs/api/reference/rest/v1/documents?hl=ja)ので、これを見ながら必要な変換を定義すればよい。

テンプレートをGoogle DocsのGUIで作成して、それをAPIでpullした上で、コンテンツを注入したドキュメントをcreateすれば、やりたかったことを実現できそうだ。
テンプレートの置き換え箇所の指定方法はどうするのが良いだろうか。

`(開始記号)名前(引数リスト)(終了記号)`を文書に埋め込む。これがひとかたまりの文書オブジェクトとして認識されることが必要。
また、これにスタイリングを適用した場合、埋め込み後もそのスタイリングが保たれるようにする。
引数に他の名前が出現しうることに注意する

テンプレに埋め込むテキストを定義する側では、埋め込み内容の定義リストを作成する:

```python
def name(args: list[str]) -> str:
  return f"""\
ここに置換後の文字列を書く。
ここにも埋め込みの出現を許す。
"""
```

埋め込み処理では、JSON形式のテンプレのすべてのテキストについてマクロ展開をすればよい。

## 追記: Web技術で「本」が作れる ...

リブロワークスからCSSで組版するノウハウをまとめた本が[5/12に出るらしい](https://libroworks.co.jp/?p=6956)。
途中までを[オフィシャルが公開している](https://libroworks.co.jp/csskumihan/viewer/#src=/csskumihan/0_frontmatter.html&f=epubcfi(/4!))。
Vivliostyleというソフトを使って、MarkdownとCSSで書籍を作るらしい。
その手のソフトは他にもあるようで、[比較サイト](https://print-css.rocks/lessons)を先の書籍で紹介されていた。

こう思うとmadokoはだいぶ良いものだなと感じる。適用範囲を限定した置換とlatexはなかなか強い。
latexとcssを完全に理解すればmadokoが最高かもしれない。

