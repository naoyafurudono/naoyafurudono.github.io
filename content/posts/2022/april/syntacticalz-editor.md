---
title: 構文エディタ実装の考え
date: 2022-04-16
---

構文エディタとは、文字単位だけでなく抽象構文木単位での編集ができるエディタのこと。
一般のコードでなく、プログラムを編集することは抽象構文木のノードやエッジの編集に対応する。
ならば、そういう単位での編集をエディタが直接サポートすれば楽できるという発想（だと想像する）。

アイデアとしてはそれらしい気がする。でも流行ってるようには見えない。
なんでか？

- 需要が少ない:
  プログラムを新しく書くことは構文エディタの対象外であり、プログラムがあってそれに対する選択が主な操作である。なので構文じゃない編集機能はやはり必要で、そう考えるとそんなに欲しくない。とか？
- 使い勝手が悪い:
  使ったことがないし、具体的な機能を知らないので想像でしかないけど、おそらく思ったようにASTのノードを選択できないのではないか？そもそも選択したい「ASTのノード」が実は存在しないケースがある。`(e1;e2;e3)`のうち、`e1;e2`と`e2;e3`のどちらかは存在しないはず。この辺りの問題は工夫すれば解決できそう。既存の実装はどのくらい工夫しているのだろうか。
- 普通のエディタで十分:
  前の/次のセミコロンまでジャンプとか、かっこまでジャンプとかがあれば済むケースは多い。
- 実装が大変:
  使い勝手を考えるとシンタックスハイライトとかよりは大変そう。抽象構文木をアレンジした概念が必要になりそう。

実装の話は Lisp なら簡単か。かっこを上手に扱う機能が入ればあとは普通のエディタの機能でほとんど構文エディタになる。

逆にシンタックスを弄りやすくして、普通のエディタが構文エディタ的な振る舞いをできるようにするのはどうだろう？Haskellはいい線いってる？文を消す <--> 行を消すの対応をほとんどの言語でしているので多かれ少なかれそういう側面がある。究極的にはどこまでいけるだろうか？
エディタの基本操作は一文字入力/削除か。Vimでできることに広げるとどうだろうか。

関連して、エディタの話の制限を忘れて、言語デザインと使い勝手を考えたい。
ソースコード --> AST --> typed-AST --> 実行結果 くらいの段階がプログラマが交流しうるプログラムの表現だろう（実行結果が入るのは理論的じゃないかもだけど、気持ちとしては入るはず。みんな実行のことを考えてプログラムを書くのだから）。

プログラムの概念は色々あるが、それらは必ず上のどこかの概念として捉えることができる。
プログラムの挙動は実行時のことだし、行数はソースコードのこと。では型は？
typed-ASTかそれよりも前のどこかだ。例えば型アノテーションついていればソースコードの時点でわかるが、付けずに型推論に任せていれば、typed-ASTにまで頭を巡らせないとわからない。

変数の参照はどうだろう。ソースコードなことが望ましい（lexical scope）けどそうじゃない困った言語もある。

いろんな概念があるが、なんにしても、早い段階でわかったほうが嬉しいことが多いだろう。
でも一方でそれをわかあるためにプログラマがコンパイラの代わりをするのは非人道的だ。
型アノテーションは大切だけど型推論を邪魔者扱いする人はいない（いないよね？）。
これ以上具体的なことは言語の意味論によるだろう。HaskellとSchemeを同じ土俵で議論するのは大変そう。

